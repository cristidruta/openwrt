cscope 15 $HOME/code/iot_home_gw/mtk/package/fxagent/src -q 0000001317 0000213936
	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/DataConvert.c

1 
	~<mxml.h
>

2 
	~"sh¬e.h
"

3 
	~"·r£r.h
"

4 
	~<sql™e3.h
>

6 
	#KEY_NAME_MAX_LEN
 30

	)

7 
	#KEY_NAME_PATH_MAX_LEN
 60

	)

9 
g‘AÎjoynKeyName
(*
deviûTy³
, *
mªuçùu»
, *
moduËNumb”
, 
k_šfo
 *
¶©fÜmKeyName
, 
keyNameNumb”
);

10 
g‘CÚfigKeyFromXml
(*
deviûTy³
, *
mªuçùu»
, *
moduËNumb”
, *
devD©aName
, 
k_šfo
 *
cÚfigKeyH—d
);

11 
g‘ObjInfoByDevId
(*
deviûId
, *
š‹rçûName
, *
objeùP©h
, *
ÚlšeStus
);

12 
g‘DevInfoByDevId
(*
deviûId
, *
deviûTy³
, *
mªuçùu»
, *
moduËNumb”
);

13 
g‘DevInfoByObj
(*
š‹rçûName
, *
objeùP©h
, *
deviûId
, *
deviûTy³
);

14 
g‘DevD©aByObj
(*
š‹rçûName
, *
devD©a
);

15 
g‘DevD©aByDevId
(*
deviûId
, *
devD©a
);

16 
£tDevIdByDevSn
(*
deviûId
, *
deviûSn
);

20 
	$g‘ObjInfoByDevId
(*
deviûId
, *
š‹rçûName
, *
objeùP©h
, *
ÚlšeStus
)

23 
sql™e3
 *
db
 = 0;

24 * 
”rmsg
 = 0;

25 
»suÉ
 = 0;

27 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

28 
»t
 = 
	`sql™e3_İ’
(
DEVICE_DATABASE_PATH
, &
db
);

30 if(
»t
 =ğ
SQLITE_OK
)

32 
	`şoudc_debug
("%s[%d]: You havİ’ed‡ sql™e3 d©aba£‚amed deviû.db sucûssfuÎy!", 
__func__
, 
__LINE__
);

34 **
db»suÉ
;

35 *
”rmsg
 = 0;

36 
sqlCmd
[128] = {0};

37 
i
 = 0;

38 
j
 = 0;

39 
Äow
 = 0;

40 
ncŞumn
 = 0;

41 
šdex
 = 0;

43 
	`¢´štf
(
sqlCmd
, (sqlCmd), "£Ëù iÁ”çû, obj·th, STATUS from deviûšfØWHERE deviûid = '%s'", 
deviûId
 );

44 
	`şoudc_debug
("%s[%d]: sqÈcmd = %s", 
__func__
, 
__LINE__
, 
sqlCmd
);

45 
»t
 = 
	`sql™e3_g‘_bË
(
db
, 
sqlCmd
, &
db»suÉ
, &
Äow
, &
ncŞumn
, &
”rmsg
);

46 
	`şoudc_debug
("%s[%d]: qu”y„esuÉ:‚row = %d,‚cŞumÀğ%d", 
__func__
, 
__LINE__
, 
Äow
, 
ncŞumn
);

47 if(
»t
 =ğ
SQLITE_OK
)

49 
	`şoudc_debug
("%s[%d]: qu”y %˜»cÜds.", 
__func__
, 
__LINE__
, 
Äow
);

50 
šdex
 = 
ncŞumn
;

52 
i
 = 0; i < 
Äow
; i++)

54 
	`şoudc_debug
("%s[%d]: cÚ‹Á iÀrow [%d], index = %d:", 
__func__
, 
__LINE__
, 
i
, 
šdex
);

55 
j
 = 0; j < 
ncŞumn
; j++)

57 
	`şoudc_debug
("%s[%d]: j = %d %s\n", 
__func__
, 
__LINE__
, 
j
, 
db»suÉ
[
šdex
]);

58 
j
)

61 
	`mem£t
(
š‹rçûName
, 0, 
MAX_INTERFACE_LEN
);

62 
	`¡ºıy
(
š‹rçûName
, 
db»suÉ
[
šdex
], 
MAX_INTERFACE_LEN
 - 1);

63 
	`şoudc_debug
("%s[%d]: iÁ”çûNamğ%s", 
__func__
, 
__LINE__
, 
š‹rçûName
);

66 
	`mem£t
(
objeùP©h
, 0, 
MAX_OBJECTPATH_LEN
);

67 
	`¡ºıy
(
objeùP©h
, 
db»suÉ
[
šdex
], 
MAX_OBJECTPATH_LEN
 - 1);

68 
	`şoudc_debug
("%s[%d]: objeùP©h = %s", 
__func__
, 
__LINE__
, 
objeùP©h
);

71 
	`mem£t
(
ÚlšeStus
, 0, 
MAX_ONLINESTATUS_LEN
);

72 
	`¡ºıy
(
ÚlšeStus
, 
db»suÉ
[
šdex
], 
MAX_ONLINESTATUS_LEN
 - 1);

73 
	`şoudc_debug
("%s[%d]: oÆšeStu ğ%s", 
__func__
, 
__LINE__
, 
ÚlšeStus
);

78 
šdex
++;

84 
	`şoudc_debug
("%s[%d]: qu”y faed", 
__func__
, 
__LINE__
);

85 
	`årštf
(
¡d”r
,"E¼Ü: %s\n", 
	`sql™e3_”rmsg
(
db
));

86 
	`sql™e3_ä“
(
”rmsg
);

89 
	`sql™e3_ä“_bË
(
db»suÉ
);

93 
	`şoudc_”rÜ
("%s[%d]: %s", 
__func__
, 
__LINE__
, 
DEVICE_DATABASE_PATH
);

94 
	`årštf
(
¡d”r
,"çedØİ’hi db fe: %s\n", 
	`sql™e3_”rmsg
(
db
));

95 
	`sql™e3_ä“
(
”rmsg
);

99 
	`sql™e3_şo£
(
db
);

100 
db
 = 0;

102 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

104 
	}
}

107 
	$g‘DevInfoByDevId
(*
deviûId
, *
deviûTy³
, *
mªuçùu»
, *
moduËNumb”
)

110 
sql™e3
 *
db
 = 0;

111 * 
”rmsg
 = 0;

112 
»suÉ
 = 0;

114 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

115 
»t
 = 
	`sql™e3_İ’
(
DEVICE_DATABASE_PATH
, &
db
);

117 if(
»t
 =ğ
SQLITE_OK
)

119 
	`şoudc_debug
("%s[%d]: You havİ’ed‡ sql™e3 d©aba£‚amed deviû.db sucûssfuÎy!", 
__func__
, 
__LINE__
);

121 **
db»suÉ
;

122 *
”rmsg
 = 0;

123 
sqlCmd
[128] = {0};

124 
i
 = 0;

125 
j
 = 0;

126 
Äow
 = 0;

127 
ncŞumn
 = 0;

128 
šdex
 = 0;

130 
	`¢´štf
(
sqlCmd
, (sqlCmd), "£Ëù deviûty³, mªuçùu», moduËnumb” from deviûšfØWHERE deviûid = '%s'", 
deviûId
 );

131 
	`şoudc_debug
("%s[%d]: sqÈcmd = %s", 
__func__
, 
__LINE__
, 
sqlCmd
);

132 
»t
 = 
	`sql™e3_g‘_bË
(
db
, 
sqlCmd
, &
db»suÉ
, &
Äow
, &
ncŞumn
, &
”rmsg
);

133 
	`şoudc_debug
("%s[%d]: qu”y„esuÉ:‚row = %d,‚cŞumÀğ%d", 
__func__
, 
__LINE__
, 
Äow
, 
ncŞumn
);

134 if(
»t
 =ğ
SQLITE_OK
)

136 
	`şoudc_debug
("%s[%d]: qu”y %˜»cÜds.", 
__func__
, 
__LINE__
, 
Äow
);

137 
šdex
 = 
ncŞumn
;

139 
i
 = 0; i < 
Äow
; i++)

141 
	`şoudc_debug
("%s[%d]: cÚ‹Á iÀrow [%d], index = %d:", 
__func__
, 
__LINE__
, 
i
, 
šdex
);

142 
j
 = 0; j < 
ncŞumn
; j++)

144 
	`şoudc_debug
("%s[%d]: j = %d %s\n", 
__func__
, 
__LINE__
, 
j
, 
db»suÉ
[
šdex
]);

145 
j
)

148 
	`mem£t
(
deviûTy³
, 0, 
MAX_DEVICETYPE_LEN
);

149 
	`¡ºıy
(
deviûTy³
, 
db»suÉ
[
šdex
], 
MAX_DEVICETYPE_LEN
 - 1);

150 
	`şoudc_debug
("%s[%d]: deviûTy³ = %s", 
__func__
, 
__LINE__
, 
deviûTy³
);

153 
	`mem£t
(
mªuçùu»
, 0, 
MAX_MANUFACTURE_LEN
);

154 
	`¡ºıy
(
mªuçùu»
, 
db»suÉ
[
šdex
], 
MAX_MANUFACTURE_LEN
 - 1);

155 
	`şoudc_debug
("%s[%d]: mªuçùu» = %s", 
__func__
, 
__LINE__
, 
mªuçùu»
);

157 
	`mem£t
(
moduËNumb”
, 0, 
MAX_MODULENUMBER_LEN
);

158 
	`¡ºıy
(
moduËNumb”
, 
db»suÉ
[
šdex
], 
MAX_MODULENUMBER_LEN
 - 1);

159 
	`şoudc_debug
("%s[%d]: moduËNumb” = %s", 
__func__
, 
__LINE__
, 
moduËNumb”
);

163 
šdex
++;

169 
	`şoudc_debug
("%s[%d]: qu”y faed", 
__func__
, 
__LINE__
);

170 
	`årštf
(
¡d”r
,"E¼Ü: %s\n", 
	`sql™e3_”rmsg
(
db
));

171 
	`sql™e3_ä“
(
”rmsg
);

173 
	`sql™e3_ä“_bË
(
db»suÉ
);

177 
	`şoudc_”rÜ
("%s[%d]: %s", 
__func__
, 
__LINE__
, 
DEVICE_DATABASE_PATH
);

178 
	`årštf
(
¡d”r
,"çedØİ’hi db fe: %s\n", 
	`sql™e3_”rmsg
(
db
));

179 
	`sql™e3_ä“
(
”rmsg
);

183 
	`sql™e3_şo£
(
db
);

184 
db
 = 0;

186 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

189 
	}
}

192 
	$g‘DevInfoByObj
(*
š‹rçûName
, *
objeùP©h
, *
deviûId
, *
deviûTy³
)

195 
sql™e3
 *
db
 = 0;

196 * 
”rmsg
 = 0;

197 
»suÉ
 = 0;

199 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

200 
»t
 = 
	`sql™e3_İ’
(
DEVICE_DATABASE_PATH
, &
db
);

202 if(
»t
 =ğ
SQLITE_OK
)

204 
	`şoudc_debug
("%s[%d]: You havİ’ed‡ sql™e3 d©aba£‚amed deviû.db sucûssfuÎy!", 
__func__
, 
__LINE__
);

206 **
db»suÉ
;

207 *
”rmsg
 = 0;

208 
sqlCmd
[128] = {0};

209 
i
 = 0;

210 
j
 = 0;

211 
Äow
 = 0;

212 
ncŞumn
 = 0;

213 
šdex
 = 0;

215 
	`¢´štf
(
sqlCmd
, (sqlCmd), "£Ëù deviûid, deviûTy³ from deviûšfØWHERE iÁ”çû = '%s'", 
š‹rçûName
);

216 
	`şoudc_debug
("%s[%d]: sqÈcmd = %s", 
__func__
, 
__LINE__
, 
sqlCmd
);

217 
»t
 = 
	`sql™e3_g‘_bË
(
db
, 
sqlCmd
, &
db»suÉ
, &
Äow
, &
ncŞumn
, &
”rmsg
);

218 
	`şoudc_debug
("%s[%d]: qu”y„esuÉ:‚row = %d,‚cŞumÀğ%d", 
__func__
, 
__LINE__
, 
Äow
, 
ncŞumn
);

219 if(
»t
 =ğ
SQLITE_OK
)

221 
	`şoudc_debug
("%s[%d]: qu”y %˜»cÜds.", 
__func__
, 
__LINE__
, 
Äow
);

222 
šdex
 = 
ncŞumn
;

224 
i
 = 0; i < 
Äow
; i++)

226 
	`şoudc_debug
("%s[%d]: cÚ‹Á iÀrow [%d], index = %d:", 
__func__
, 
__LINE__
, 
i
, 
šdex
);

227 
j
 = 0; j < 
ncŞumn
; j++)

229 
	`şoudc_debug
("%s[%d]: j = %d %s\n", 
__func__
, 
__LINE__
, 
j
, 
db»suÉ
[
šdex
]);

230 
j
)

233 
	`mem£t
(
deviûId
, 0, 
MAX_DEVICEID_LEN
);

234 
	`¡ºıy
(
deviûId
, 
db»suÉ
[
šdex
], 
MAX_DEVICEID_LEN
 - 1);

237 
	`mem£t
(
deviûTy³
, 0, 
MAX_DEVICETYPE_LEN
);

238 
	`¡ºıy
(
deviûTy³
, 
db»suÉ
[
šdex
], 
MAX_DEVICETYPE_LEN
 - 1);

243 
šdex
++;

249 
	`şoudc_debug
("%s[%d]: qu”y faed", 
__func__
, 
__LINE__
);

250 
	`årštf
(
¡d”r
,"E¼Ü: %s\n", 
	`sql™e3_”rmsg
(
db
));

251 
	`sql™e3_ä“
(
”rmsg
);

253 
	`sql™e3_ä“_bË
(
db»suÉ
);

257 
	`şoudc_”rÜ
("%s[%d]: %s", 
__func__
, 
__LINE__
, 
DEVICE_DATABASE_PATH
);

258 
	`årštf
(
¡d”r
,"çedØİ’hi db fe: %s\n", 
	`sql™e3_”rmsg
(
db
));

259 
	`sql™e3_ä“
(
”rmsg
);

263 
	`sql™e3_şo£
(
db
);

264 
db
 = 0;

266 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

269 
	}
}

272 
	$g‘DevD©aByObj
(*
š‹rçûName
, *
devD©a
)

275 
sql™e3
 *
db
 = 0;

276 * 
”rmsg
 = 0;

277 
»suÉ
 = 0;

279 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

280 
»t
 = 
	`sql™e3_İ’
(
DEVICE_DATABASE_PATH
, &
db
);

282 if(
»t
 =ğ
SQLITE_OK
)

284 
	`şoudc_debug
("%s[%d]: You havİ’ed‡ sql™e3 d©aba£‚amed deviû.db sucûssfuÎy!", 
__func__
, 
__LINE__
);

286 **
db»suÉ
;

287 *
”rmsg
 = 0;

288 
sqlCmd
[128] = {0};

289 
i
 = 0;

290 
j
 = 0;

291 
Äow
 = 0;

292 
ncŞumn
 = 0;

293 
šdex
 = 0;

295 
	`¢´štf
(
sqlCmd
, (sqlCmd), "£Ëù devD©¨äom deviûšfØWHERE iÁ”çû = '%s'", 
š‹rçûName
);

296 
	`şoudc_debug
("%s[%d]: sqÈcmd = %s", 
__func__
, 
__LINE__
, 
sqlCmd
);

297 
»t
 = 
	`sql™e3_g‘_bË
(
db
, 
sqlCmd
, &
db»suÉ
, &
Äow
, &
ncŞumn
, &
”rmsg
);

298 
	`şoudc_debug
("%s[%d]: qu”y„esuÉ:‚row = %d,‚cŞumÀğ%d", 
__func__
, 
__LINE__
, 
Äow
, 
ncŞumn
);

299 if(
»t
 =ğ
SQLITE_OK
)

301 
	`şoudc_debug
("%s[%d]: qu”y %˜»cÜds.", 
__func__
, 
__LINE__
, 
Äow
);

302 
šdex
 = 
ncŞumn
;

304 
i
 = 0; i < 
Äow
; i++)

306 
	`şoudc_debug
("%s[%d]: cÚ‹Á iÀrow [%d], index = %d:", 
__func__
, 
__LINE__
, 
i
, 
šdex
);

307 
j
 = 0; j < 
ncŞumn
; j++)

309 
	`şoudc_debug
("%s[%d]: j = %d %s\n", 
__func__
, 
__LINE__
, 
j
, 
db»suÉ
[
šdex
]);

310 
j
)

313 
	`mem£t
(
devD©a
, 0, 
MAX_DEVDATA_LEN
);

314 
	`¡ºıy
(
devD©a
, 
db»suÉ
[
šdex
], 
MAX_DEVDATA_LEN
 - 1);

319 
šdex
++;

325 
	`şoudc_debug
("%s[%d]: qu”y faed", 
__func__
, 
__LINE__
);

326 
	`årštf
(
¡d”r
,"E¼Ü: %s\n", 
	`sql™e3_”rmsg
(
db
));

327 
	`sql™e3_ä“
(
”rmsg
);

329 
	`sql™e3_ä“_bË
(
db»suÉ
);

333 
	`şoudc_”rÜ
("%s[%d]: %s", 
__func__
, 
__LINE__
, 
DEVICE_DATABASE_PATH
);

334 
	`årštf
(
¡d”r
,"çedØİ’hi db fe: %s\n", 
	`sql™e3_”rmsg
(
db
));

335 
	`sql™e3_ä“
(
”rmsg
);

339 
	`sql™e3_şo£
(
db
);

340 
db
 = 0;

342 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

344 
	}
}

346 
	$g‘DevD©aByDevId
(*
deviûId
, *
devD©a
)

349 
sql™e3
 *
db
 = 0;

350 * 
”rmsg
 = 0;

351 
»suÉ
 = 0;

353 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

354 
»t
 = 
	`sql™e3_İ’
(
DEVICE_DATABASE_PATH
, &
db
);

356 if(
»t
 =ğ
SQLITE_OK
)

358 
	`şoudc_debug
("%s[%d]: You havİ’ed‡ sql™e3 d©aba£‚amed deviû.db sucûssfuÎy!", 
__func__
, 
__LINE__
);

360 **
db»suÉ
;

361 *
”rmsg
 = 0;

362 
sqlCmd
[128] = {0};

363 
i
 = 0;

364 
j
 = 0;

365 
Äow
 = 0;

366 
ncŞumn
 = 0;

367 
šdex
 = 0;

369 
	`¢´štf
(
sqlCmd
, (sqlCmd), "£Ëù devD©¨äom deviûšfØWHERE deviûid = '%s'", 
deviûId
);

370 
	`şoudc_debug
("%s[%d]: sqÈcmd = %s", 
__func__
, 
__LINE__
, 
sqlCmd
);

371 
»t
 = 
	`sql™e3_g‘_bË
(
db
, 
sqlCmd
, &
db»suÉ
, &
Äow
, &
ncŞumn
, &
”rmsg
);

372 
	`şoudc_debug
("%s[%d]: qu”y„esuÉ:‚row = %d,‚cŞumÀğ%d", 
__func__
, 
__LINE__
, 
Äow
, 
ncŞumn
);

373 if(
»t
 =ğ
SQLITE_OK
)

375 
	`şoudc_debug
("%s[%d]: qu”y %˜»cÜds.", 
__func__
, 
__LINE__
, 
Äow
);

376 
šdex
 = 
ncŞumn
;

378 
i
 = 0; i < 
Äow
; i++)

380 
	`şoudc_debug
("%s[%d]: cÚ‹Á iÀrow [%d], index = %d:", 
__func__
, 
__LINE__
, 
i
, 
šdex
);

381 
j
 = 0; j < 
ncŞumn
; j++)

383 
	`şoudc_debug
("%s[%d]: j = %d %s\n", 
__func__
, 
__LINE__
, 
j
, 
db»suÉ
[
šdex
]);

384 
j
)

387 
	`mem£t
(
devD©a
, 0, 
MAX_DEVDATA_LEN
);

388 
	`¡ºıy
(
devD©a
, 
db»suÉ
[
šdex
], 
MAX_DEVDATA_LEN
 - 1);

393 
šdex
++;

399 
	`şoudc_debug
("%s[%d]: qu”y faed", 
__func__
, 
__LINE__
);

400 
	`årštf
(
¡d”r
,"E¼Ü: %s\n", 
	`sql™e3_”rmsg
(
db
));

401 
	`sql™e3_ä“
(
”rmsg
);

403 
	`sql™e3_ä“_bË
(
db»suÉ
);

407 
	`şoudc_”rÜ
("%s[%d]: %s", 
__func__
, 
__LINE__
, 
DEVICE_DATABASE_PATH
);

408 
	`årštf
(
¡d”r
,"çedØİ’hi db fe: %s\n", 
	`sql™e3_”rmsg
(
db
));

409 
	`sql™e3_ä“
(
”rmsg
);

413 
	`sql™e3_şo£
(
db
);

414 
db
 = 0;

416 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

418 
	}
}

420 
	$£tDevIdByDevSn
(*
deviûId
, *
deviûSn
)

423 
sql™e3
 *
db
 = 0;

424 * 
”rmsg
 = 0;

425 
»suÉ
 = 0;

427 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

428 
»t
 = 
	`sql™e3_İ’
(
DEVICE_DATABASE_PATH
, &
db
);

430 if(
»t
 =ğ
SQLITE_OK
)

432 
	`şoudc_debug
("%s[%d]: You havİ’ed‡ sql™e3 d©aba£‚amed deviû.db sucûssfuÎy!", 
__func__
, 
__LINE__
);

434 *
”rmsg
 = 0;

435 
sqlCmd
[128] = {0};

437 
	`¢´štf
(
sqlCmd
, (sqlCmd), "UPDATE deviûšfØ£ˆdeviûid = '%s' WHERE deviû¢ = '%s'", 
deviûId
, 
deviûSn
 );

438 
	`şoudc_debug
("%s[%d]: sqÈcmd = %s", 
__func__
, 
__LINE__
, 
sqlCmd
);

440 
»t
 = 
	`sql™e3_exec
(
db
, 
sqlCmd
, 
NULL
, NULL, &
”rmsg
);

441 ià(
»t
 !ğ
SQLITE_OK
) {

442 
	`årštf
(
¡d”r
,"upd©bË deviûšfØE¼Ü: %s\n", 
	`sql™e3_”rmsg
(
db
));

443 
	`sql™e3_ä“
(
”rmsg
);

444 
»t
 = -1;

448 
	`şoudc_debug
("%s[%d]: upd©deviûId v®usucûed", 
__func__
, 
__LINE__
);

449 
»t
 = 0;

454 
	`sql™e3_şo£
(
db
);

455 
db
 = 0;

457 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

458  
»t
;

459 
	}
}

462 
	$g‘AÎjoynKeyName
(*
deviûTy³
, *
mªuçùu»
, *
moduËNumb”
, 
k_šfo
 *
¶©fÜmKeyName
, 
keyNameNumb”
)

464 
i
 = 0;

465 
¶©fÜmKeyNameNodeP©h
[
KEY_NAME_PATH_MAX_LEN
] = {0};

466 
FILE
 *
å
 = 
NULL
;

467 
mxml_node_t
 *
Œ“
 = 
NULL
;

468 
mxml_node_t
 *
¶©fÜmkeyNameNode
 = 
NULL
;

470 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

471 
	`şoudc_debug
("%s[%d]: deviûTy³ = %s, mªuçùu» = %s,…ÏtfÜmKeyNameH—d = %p", 
__func__
, 
__LINE__
, 
deviûTy³
, 
mªuçùu»
, 
¶©fÜmKeyName
);

473 
å
 = 
	`fİ’
(
DATA_CONVERT_FILE_PATH
, "r");

474 if(
å
 =ğ
NULL
)

476 
	`şoudc_”rÜ
("%s[%d]: o³À% ”rÜ!", 
__func__
, 
__LINE__
, 
DATA_CONVERT_FILE_PATH
);

481 
	`şoudc_debug
("%s[%d]: o³À% sucûed!", 
__func__
, 
__LINE__
, 
DATA_CONVERT_FILE_PATH
);

484 
Œ“
 = 
	`mxmlLßdFe
(
NULL
, 
å
,
MXML_TEXT_CALLBACK
);

485 
	`fşo£
(
å
);

487 if(
Œ“
 =ğ
NULL
)

489 
	`şoudc_”rÜ
("%s[%d]: Lßd f”rÜ!", 
__func__
, 
__LINE__
);

494 
	`şoudc_debug
("%s[%d]: Lßd fsucûss!", 
__func__
, 
__LINE__
);

497 if(
¶©fÜmKeyName
 !ğ
NULL
)

499 
i
 = 0; i < 
keyNameNumb”
; i ++)

501 
	`¢´štf
(
¶©fÜmKeyNameNodeP©h
, 
KEY_NAME_PATH_MAX_LEN
, "node/%s/%s/%s/%s", 
deviûTy³
, 
mªuçùu»
, 
moduËNumb”
, 
¶©fÜmKeyName
->
İ_k_Çme
);

502 
	`şoudc_debug
("%s[%d]:…ÏtfÜmKeyNameP©h = %s", 
__func__
, 
__LINE__
, 
¶©fÜmKeyNameNodeP©h
);

504 
¶©fÜmkeyNameNode
 = 
	`mxmlFšdP©h
(
Œ“
, 
¶©fÜmKeyNameNodeP©h
);

505 if(
¶©fÜmkeyNameNode
 =ğ
NULL
)

507 
	`şoudc_”rÜ
("%s[%d]: cªnÙ fšdƒËm’ˆ%s\n", 
__func__
, 
__LINE__
, 
¶©fÜmKeyName
->
İ_k_Çme
);

512 
	`şoudc_debug
("%s[%d]: fšdƒËm’ˆ%s\n", 
__func__
, 
__LINE__
, 
¶©fÜmKeyName
->
İ_k_Çme
);

515 
	`¡ºıy
(
¶©fÜmKeyName
->
node_Çme_cÚv”t
, 
	`mxmlEËm’tG‘A‰r
(
¶©fÜmkeyNameNode
,"®ljoyn"), 
MAX_IPK_NAME_LEN
 - 1);

517 
	`mem£t
(
¶©fÜmKeyNameNodeP©h
, 0, (platformKeyNameNodePath));

518 
¶©fÜmKeyName
 =…ÏtfÜmKeyName->
Ãxt
;

521 
	`mxmlD–‘e
(
Œ“
);

522 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

524 
	}
}

526 
	$g‘CÚfigKeyFromXml
(*
deviûTy³
, *
mªuçùu»
, *
moduËNumb”
, *
devD©aName
, 
k_šfo
 *
cÚfigKeyH—d
)

528 
i
 = 0;

529 
FILE
 *
å
 = 
NULL
;

530 
mxml_node_t
 *
Œ“
 = 
NULL
;

531 
mxml_node_t
 *
node
 = 
NULL
;

532 
mxml_node_t
 *
deviûTy³Node
 = 
NULL
;

533 
mxml_node_t
 *
mªuçùu»Node
 = 
NULL
;

534 
mxml_node_t
 *
cÚfigKeyNode
 = 
NULL
;

536 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

538 
å
 = 
	`fİ’
(
DATA_CONVERT_FILE_PATH
, "r");

539 if(
å
 =ğ
NULL
)

541 
	`şoudc_”rÜ
("%s[%d]: o³À% ”rÜ!", 
__func__
, 
__LINE__
, 
DATA_CONVERT_FILE_PATH
);

546 
	`şoudc_debug
("%s[%d]: o³À% sucûed!", 
__func__
, 
__LINE__
, 
DATA_CONVERT_FILE_PATH
);

549 
Œ“
 = 
	`mxmlLßdFe
(
NULL
, 
å
,
MXML_TEXT_CALLBACK
);

550 
	`fşo£
(
å
);

552 if(
Œ“
 =ğ
NULL
)

554 
	`şoudc_”rÜ
("%s[%d]: Lßd f”rÜ!", 
__func__
, 
__LINE__
);

559 
	`şoudc_debug
("%s[%d]: Lßd fsucûss!", 
__func__
, 
__LINE__
);

562 
node
 = 
	`mxmlFšdEËm’t
(
Œ“
,»e, "node", 
NULL
, NULL, 
MXML_DESCEND
);

563 if(
node
 =ğ
NULL
)

565 
	`´štf
("can‚ot findƒlement‚ode!\n");

566 
	`mxmlD–‘e
(
Œ“
);

571 
deviûTy³Node
 = 
	`mxmlFšdEËm’t
(
Œ“
,»e, 
deviûTy³
, 
NULL
, NULL, 
MXML_DESCEND
);

572 if(
deviûTy³Node
 =ğ
NULL
)

574 
	`şoudc_”rÜ
("%s[%d]: cªnÙ fšdy³‚od%s\n", 
__func__
, 
__LINE__
, 
deviûTy³
);

575 
	`mxmlD–‘e
(
Œ“
);

580 
	`şoudc_”rÜ
("%s[%d]: fšdy³‚od%s\n", 
__func__
, 
__LINE__
, 
deviûTy³
);

583 
mªuçùu»Node
 = 
	`mxmlFšdEËm’t
(
deviûTy³Node
, deviûTy³Node, 
mªuçùu»
, 
NULL
, NULL, 
MXML_DESCEND
);

584 if(
mªuçùu»
 =ğ
NULL
)

586 
	`şoudc_”rÜ
("%s[%d]: cªnÙ fšd mªuçùu»‚od%s\n", 
__func__
, 
__LINE__
, 
mªuçùu»
);

587 
	`mxmlD–‘e
(
Œ“
);

592 
	`şoudc_”rÜ
("%s[%d]: fšd mªuçùu»‚od%s\n", 
__func__
, 
__LINE__
, 
mªuçùu»
);

595 
cÚfigKeyNode
 = 
	`mxmlFšdEËm’t
(
mªuçùu»Node
, mªuçùu»Node, 
moduËNumb”
, 
NULL
, NULL, 
MXML_DESCEND
);

596 if(
cÚfigKeyNode
 =ğ
NULL
)

598 
	`şoudc_”rÜ
("%s[%d]: cªnÙ fšd moduËNumb”‚od%s\n", 
__func__
, 
__LINE__
, 
moduËNumb”
);

599 
	`mxmlD–‘e
(
Œ“
);

604 
	`şoudc_”rÜ
("%s[%d]: fšd moduËNumb”‚od%s\n", 
__func__
, 
__LINE__
, 
moduËNumb”
);

607 
mxml_node_t
 *
node_cÚfig
 = 
NULL
;

608 
mxml_node_t
 *
node_d‘a
 = 
NULL
;

610 
node_cÚfig
 = 
	`mxmlFšdEËm’t
(
cÚfigKeyNode
, cÚfigKeyNode, "cÚfigKey", 
NULL
, NULL, 
MXML_DESCEND
);‚ode_config != NULL;

611 
node_cÚfig
 = 
	`mxmlFšdEËm’t
Òode_cÚfig, 
cÚfigKeyNode
, "cÚfigKey", 
NULL
, NULL, 
MXML_DESCEND
))

613 
	`´štf
("node_cÚfig = %p\n", 
node_cÚfig
);

614 
	`´štf
("cÚfigxt: %s\n", 
	`mxmlEËm’tG‘A‰r
(
node_cÚfig
,"name"));

616 if(
	`¡rcmp
(
	`mxmlEËm’tG‘A‰r
(
node_cÚfig
,"name"), "devData") == 0)

618 
	`¡rıy
(
devD©aName
, "devData");

619 
	`´štf
("found devD©a: %s\n", 
devD©aName
);

623 
	`şoudc_g‘_k_Çme
(
cÚfigKeyH—d
, 
	`mxmlEËm’tG‘A‰r
(
node_cÚfig
,"Çme"), 
NULL
);

626 
node_d‘a
 = 
	`mxmlFšdEËm’t
(
node_cÚfig
, 
cÚfigKeyNode
, "d‘a", 
NULL
, NULL, 
MXML_DESCEND
);

627 
node_d‘a
 !ğ
NULL
;

628 
node_d‘a
 = 
	`mxmlFšdEËm’t
Òode_d‘a, 
node_cÚfig
, "d‘a", 
NULL
, NULL, 
MXML_DESCEND
))

630 
	`´štf
("node_d‘a = %p\n", 
node_d‘a
);

631 
	`şoudc_debug
("%s[%d]: d‘axt: %s", 
__func__
, 
__LINE__
, 
	`mxmlEËm’tG‘A‰r
(
node_d‘a
,"name"));

634 
	`´štf
("hello\n");

636 
	`mxmlD–‘e
(
Œ“
);

637 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

639 
	}
}

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/NewConfigClient.cc

18 
	~<®ljoyn/cÚfig/LogModuË.h
>

19 
	~"NewCÚfigCl›Á.h
"

21 
	#CHECK_BREAK
(
x
èià((
¡©us
 = xè!ğ
ER_OK
è{ ; }

	)

23 
usšg
 
Çme¥aû
 
	gajn
;

24 
usšg
 
Çme¥aû
 
	g£rviûs
;

29 
	gNewCÚfigCl›Á
::
NewCÚfigCl›Á
(cÚ¡ * 
š‹rçûName
, 
ajn
::
BusA‰achm’t
& 
bus
) :

30 
	$m_BusA‰achm’t
(&
bus
)

32 
	`QCC_DbgT¿û
(("In NewConfigClient basic Constructor"));

34 
QStus
 
¡©us
 = 
ER_OK
;

36 cÚ¡ 
IÁ”çûDesütiÚ
* 
g‘Içû
 = 
NULL
;

37 
g‘Içû
 = 
m_BusA‰achm’t
->
	`G‘IÁ”çû
(
š‹rçûName
);

38 ià(!
g‘Içû
) {

39 
IÁ”çûDesütiÚ
* 
ü—‹Içû
 = 
NULL
;

40 
¡©us
 = 
m_BusA‰achm’t
->
	`C»©eIÁ”çû
(
š‹rçûName
, 
ü—‹Içû
, 
AJ_IFC_SECURITY_REQUIRED
);

41 ià(
ü—‹Içû
 && 
¡©us
 =ğ
ER_OK
) {

43 
	`CHECK_BREAK
(
ü—‹Içû
->
	`AddM‘hod
("FaùÜyRe£t", 
NULL
, NULL, NULL))

44 
	`CHECK_BREAK
(
ü—‹Içû
->
	`AddMemb”AÂÙ©iÚ
("FaùÜyRe£t", 
Üg
::
ä“desktİ
::
DBus
::
AÂÙ©eNoR•ly
, "true"))

45 
	`CHECK_BREAK
(
ü—‹Içû
->
	`AddM‘hod
("Re¡¬t", 
NULL
, NULL, NULL))

46 
	`CHECK_BREAK
(
ü—‹Içû
->
	`AddMemb”AÂÙ©iÚ
("Re¡¬t", 
Üg
::
ä“desktİ
::
DBus
::
AÂÙ©eNoR•ly
, "true"))

47 
	`CHECK_BREAK
(
ü—‹Içû
->
	`AddM‘hod
("S‘Passcode", "§y", 
NULL
, "daemonRealm,newPasscode", 0))

48 
	`CHECK_BREAK
(
ü—‹Içû
->
	`AddM‘hod
("GetConfigurations", "s", "a{sv}", "languageTag,configData", 0))

49 
	`CHECK_BREAK
(
ü—‹Içû
->
	`AddM‘hod
("Upd©eCÚfigu¿tiÚs", "§{sv}", 
NULL
, "languageTag,configMap", 0))

50 
	`CHECK_BREAK
(
ü—‹Içû
->
	`AddM‘hod
("Re£tCÚfigu¿tiÚs", "§s", 
NULL
, "languageTag,fieldList", 0))

51 
	`CHECK_BREAK
(
ü—‹Içû
->
	`AddPrİ”ty
("V”siÚ", "q", 
PROP_ACCESS_READ
))

52 
ü—‹Içû
->
	`Aùiv©e
();

56 
	`QCC_LogE¼Ü
(
¡©us
, ("ConfigClientInterface could‚ot be created."));

58 
	}
}

60 
QStus
 
	gNewCÚfigCl›Á
::
FaùÜyRe£t
(cÚ¡ * 
busName
, cÚ¡ * 
objeùP©h
, cÚ¡ * 
š‹rçûName
, 
ajn
::
SessiÚId
 
£ssiÚId
)

62 
QCC_DbgT¿û
(("In NewConfigClient FactoryReset"));

64 
QStus
 
	g¡©us
 = 
ER_OK
;

66 cÚ¡ 
IÁ”çûDesütiÚ
* 
	gp_IÁ”çûDesütiÚ
 = 
m_BusA‰achm’t
->
G‘IÁ”çû
(
š‹rçûName
);

67 ià(!
	gp_IÁ”çûDesütiÚ
) {

68  
	gER_FAIL
;

71 
ProxyBusObjeù
* 
	g´oxyBusObj
 = 
Ãw
 ProxyBusObjeù(*
m_BusA‰achm’t
, 
busName
, 
objeùP©h
, 
£ssiÚId
);

72 ià(!
	g´oxyBusObj
) {

73  
	gER_FAIL
;

75 
	g¡©us
 = 
´oxyBusObj
->
AddIÁ”çû
(*
p_IÁ”çûDesütiÚ
);

76 ià(
	g¡©us
 =ğ
ER_OK
) {

77 
¡©us
 = 
´oxyBusObj
->
M‘hodC®l
(
š‹rçûName
, "FaùÜyRe£t", 
NULL
, 0);

79 
d–‘e
 
	g´oxyBusObj
;

80  
	g¡©us
;

83 
QStus
 
	gNewCÚfigCl›Á
::
Re¡¬t
(cÚ¡ * 
busName
, cÚ¡ * 
objeùP©h
, cÚ¡ * 
š‹rçûName
, 
ajn
::
SessiÚId
 
£ssiÚId
)

85 
QCC_DbgT¿û
(("In NewConfigClient Restart"));

86 
QStus
 
	g¡©us
 = 
ER_OK
;

88 cÚ¡ 
IÁ”çûDesütiÚ
* 
	gp_IÁ”çûDesütiÚ
 = 
m_BusA‰achm’t
->
G‘IÁ”çû
(
š‹rçûName
);

89 ià(!
	gp_IÁ”çûDesütiÚ
) {

90  
	gER_FAIL
;

93 
ProxyBusObjeù
* 
	g´oxyBusObj
 = 
Ãw
 ProxyBusObjeù(*
m_BusA‰achm’t
, 
busName
, 
objeùP©h
, 
£ssiÚId
);

94 ià(!
	g´oxyBusObj
) {

95  
	gER_FAIL
;

97 
	g¡©us
 = 
´oxyBusObj
->
AddIÁ”çû
(*
p_IÁ”çûDesütiÚ
);

98 ià(
	g¡©us
 =ğ
ER_OK
) {

99 
¡©us
 = 
´oxyBusObj
->
M‘hodC®l
(
š‹rçûName
, "Re¡¬t", 
NULL
, 0);

101 
d–‘e
 
	g´oxyBusObj
;

102  
	g¡©us
;

105 
QStus
 
	gNewCÚfigCl›Á
::
S‘Passcode
(cÚ¡ * 
busName
, cÚ¡ * 
d«mÚR—lm
, 
size_t
 
ÃwPasscodeSize
,

106 cÚ¡ 
ušt8_t
* 
ÃwPasscode
, cÚ¡ * 
objeùP©h
, cÚ¡ * 
š‹rçûName
, 
ajn
::
SessiÚId
 
£ssiÚId
)

108 
QCC_DbgT¿û
(("In NewConfigClient SetPasscode"));

109 
QStus
 
	g¡©us
 = 
ER_OK
;

111 cÚ¡ 
IÁ”çûDesütiÚ
* 
	gp_IÁ”çûDesütiÚ
 = 
m_BusA‰achm’t
->
G‘IÁ”çû
(
š‹rçûName
);

112 ià(!
	gp_IÁ”çûDesütiÚ
) {

113  
	gER_FAIL
;

116 
ProxyBusObjeù
* 
	g´oxyBusObj
 = 
Ãw
 ProxyBusObjeù(*
m_BusA‰achm’t
, 
busName
, 
objeùP©h
, 
£ssiÚId
);

117 ià(!
	g´oxyBusObj
) {

118  
	gER_FAIL
;

121 
CHECK_BREAK
(
´oxyBusObj
->
AddIÁ”çû
(*
p_IÁ”çûDesütiÚ
))

122 
Mes§ge
 
»¶yMsg
(*
m_BusA‰achm’t
);

123 
MsgArg
 
	g¬gs
[2];

124 
CHECK_BREAK
(
¬gs
[0].
S‘
("s", 
d«mÚR—lm
))

125 
CHECK_BREAK
(
¬gs
[1].
S‘
("ay", 
ÃwPasscodeSize
, 
ÃwPasscode
))

126 
CHECK_BREAK
(
´oxyBusObj
->
M‘hodC®l
(
š‹rçûName
, "S‘Passcode", 
¬gs
, 2, 
»¶yMsg
))

128 
d–‘e
 
	g´oxyBusObj
;

129  
	g¡©us
;

132 
QStus
 
	gNewCÚfigCl›Á
::
G‘CÚfigu¿tiÚs
(cÚ¡ * 
busName
, cÚ¡ * 
ÏnguageTag
, 
CÚfigu¿tiÚs
& 
cÚfigs
,

133 cÚ¡ * 
objeùP©h
, cÚ¡ * 
š‹rçûName
, 
ajn
::
SessiÚId
 
£ssiÚId
)

135 
QCC_DbgT¿û
(("In NewConfigClient GetConfigurations"));

136 
QStus
 
	g¡©us
 = 
ER_OK
;

138 cÚ¡ 
IÁ”çûDesütiÚ
* 
	gp_IÁ”çûDesütiÚ
 = 
m_BusA‰achm’t
->
G‘IÁ”çû
(
š‹rçûName
);

139 ià(!
	gp_IÁ”çûDesütiÚ
) {

140  
	gER_FAIL
;

143 
ProxyBusObjeù
* 
	g´oxyBusObj
 = 
Ãw
 ProxyBusObjeù(*
m_BusA‰achm’t
, 
busName
, 
objeùP©h
, 
£ssiÚId
);

144 ià(!
	g´oxyBusObj
) {

145  
	gER_FAIL
;

148 
CHECK_BREAK
(
´oxyBusObj
->
AddIÁ”çû
(*
p_IÁ”çûDesütiÚ
))

150 
Mes§ge
 
»¶yMsg
(*
m_BusA‰achm’t
);

152 
MsgArg
 
	g¬gs
[1];

153 
CHECK_BREAK
(
¬gs
[0].
S‘
("s", 
ÏnguageTag
))

154 
	g¡©us
 = 
´oxyBusObj
->
M‘hodC®l
(
š‹rçûName
, "G‘CÚfigu¿tiÚs", 
¬gs
, 1, 
»¶yMsg
);

156 ià(
	g¡©us
 =ğ
ER_OK
) {

158 cÚ¡ 
ajn
::
MsgArg
* 
»tuºArgs
 = 0;

159 
size_t
 
	gnumArgs
 = 0;

161 
	g»¶yMsg
->
G‘Args
(
numArgs
, 
»tuºArgs
);

162 ià(
	gnumArgs
 == 1) {

163 
ÏnguageTagNumEËm’ts
;

164 
MsgArg
* 
	g‹mpcÚfigM­DiùEÁr›s
;

165 
CHECK_BREAK
(
»tuºArgs
[0].
G‘
("a{sv}", &
ÏnguageTagNumEËm’ts
, &
‹mpcÚfigM­DiùEÁr›s
))

166 
	gcÚfigs
.
ş—r
();

167 
	gi
 = 0; i < 
	gÏnguageTagNumEËm’ts
; i++) {

168 * 
	g‹mpKey
;

169 
MsgArg
* 
	g‹mpV®ue
;

170 
CHECK_BREAK
(
‹mpcÚfigM­DiùEÁr›s
[
i
].
G‘
("{sv}", &
‹mpKey
, &
‹mpV®ue
))

171 
	gcÚfigs
.
š£¹
(
¡d
::
·œ
<
qcc
::
SŒšg
, 
ajn
::
MsgArg
>(
‹mpKey
, *
‹mpV®ue
));

175 
	g¡©us
 = 
ER_BUS_BAD_VALUE
;

177 } ià(
	g¡©us
 =ğ
ER_BUS_REPLY_IS_ERROR_MESSAGE
) {

178 #ià!
defšed
(
NDEBUG
)

179 
qcc
::
SŒšg
 
”rÜMes§ge
;

180 cÚ¡ * 
	g”rÜName
 = 
»¶yMsg
->
G‘E¼ÜName
(&
”rÜMes§ge
);

182 
QCC_LogE¼Ü
(
¡©us
, ("G‘CÚfigu¿tiÚ ”rÜName:% ”rÜMes§ge: %s", 
”rÜName
 ?ƒ¼ÜNam: "", 
”rÜMes§ge
.
c_¡r
() ?ƒrrorMessage.c_str() : ""));

185 
d–‘e
 
	g´oxyBusObj
;

186  
	g¡©us
;

189 
QStus
 
	gNewCÚfigCl›Á
::
Upd©eCÚfigu¿tiÚs
(cÚ¡ * 
busName
, cÚ¡ * 
ÏnguageTag
, cÚ¡ 
CÚfigu¿tiÚs
& 
cÚfigs
,

190 cÚ¡ * 
objeùP©h
, cÚ¡ * 
š‹rçûName
, 
ajn
::
SessiÚId
 
£ssiÚId
)

192 
QCC_DbgT¿û
(("In NewConfigClient UpdateConfigurations"));

193 
QStus
 
	g¡©us
 = 
ER_OK
;

195 cÚ¡ 
IÁ”çûDesütiÚ
* 
	gp_IÁ”çûDesütiÚ
 = 
m_BusA‰achm’t
->
G‘IÁ”çû
(
š‹rçûName
);

196 ià(!
	gp_IÁ”çûDesütiÚ
) {

197  
	gER_FAIL
;

200 
ProxyBusObjeù
* 
	g´oxyBusObj
 = 
Ãw
 ProxyBusObjeù(*
m_BusA‰achm’t
, 
busName
, 
objeùP©h
, 
£ssiÚId
);

201 ià(!
	g´oxyBusObj
) {

202  
	gER_FAIL
;

205 
CHECK_BREAK
(
´oxyBusObj
->
AddIÁ”çû
(*
p_IÁ”çûDesütiÚ
))

207 
Mes§ge
 
»¶yMsg
(*
m_BusA‰achm’t
);

208 
MsgArg
 
	g¬gs
[2];

209 
CHECK_BREAK
(
¬gs
[0].
S‘
("s", 
ÏnguageTag
))

211 
	g¡d
::
veùÜ
<
MsgArg
> 
‹mpcÚfigM­DiùEÁr›s
(
cÚfigs
.
size
());

212 
	gi
 = 0;

213 
	g¡d
::
m­
<
qcc
::
SŒšg
, 
	gajn
::
MsgArg
>::
cÚ¡_™”©Ü
 
™
 = 
cÚfigs
.
begš
(); 
	g™
 !ğcÚfigs.
’d
(); ++it) {

214 
MsgArg
* 
	g¬g
 = 
Ãw
 MsgArg(
™
->
£cÚd
);

215 
	g¬g
->
S‘OwÃrshFÏgs
(
MsgArg
::
OwnsArgs
, 
Œue
);

216 
CHECK_BREAK
(
‹mpcÚfigM­DiùEÁr›s
[
i
].
S‘
("{sv}", 
™
->
fœ¡
.
c_¡r
(), 
¬g
))

217 
	gi
++;

219 ià(
	g¡©us
 !ğ
ER_OK
) {

223 
CHECK_BREAK
(
¬gs
[1].
S‘
("a{sv}", 
i
, 
‹mpcÚfigM­DiùEÁr›s
.
d©a
()))

224 
	g¡©us
 = 
´oxyBusObj
->
M‘hodC®l
(
š‹rçûName
, "Upd©eCÚfigu¿tiÚs", 
¬gs
, 2, 
»¶yMsg
);

225 ià(
	g¡©us
 =ğ
ER_BUS_REPLY_IS_ERROR_MESSAGE
) {

226 #ià!
defšed
(
NDEBUG
)

227 
qcc
::
SŒšg
 
”rÜMes§ge
;

228 cÚ¡ * 
	g”rÜName
 = 
»¶yMsg
->
G‘E¼ÜName
(&
”rÜMes§ge
);

230 
QCC_LogE¼Ü
(
¡©us
, ("Upd©eCÚfigu¿tiÚ ”rÜName:% ”rÜMes§ge: %s", 
”rÜName
 ?ƒ¼ÜNam: "", 
”rÜMes§ge
.
c_¡r
() ?ƒrrorMessage.c_str() : ""));

233 
d–‘e
 
	g´oxyBusObj
;

234  
	g¡©us
;

237 
QStus
 
	gNewCÚfigCl›Á
::
Re£tCÚfigu¿tiÚs
(cÚ¡ * 
busName
, cÚ¡ * 
ÏnguageTag
,

238 cÚ¡ 
¡d
::
veùÜ
<
qcc
::
SŒšg
>& 
cÚfigNames
, cÚ¡ * 
objeùP©h
, cÚ¡ * 
š‹rçûName
, 
ajn
::
SessiÚId
 
£ssiÚId
)

240 
QCC_DbgT¿û
(("In NewConfigClient ResetConfigurations"));

242 
QStus
 
	g¡©us
 = 
ER_OK
;

243 cÚ¡ 
IÁ”çûDesütiÚ
* 
	gp_IÁ”çûDesütiÚ
 = 
m_BusA‰achm’t
->
G‘IÁ”çû
(
š‹rçûName
);

244 ià(!
	gp_IÁ”çûDesütiÚ
) {

245  
	gER_FAIL
;

248 
ProxyBusObjeù
* 
	g´oxyBusObj
 = 
Ãw
 ProxyBusObjeù(*
m_BusA‰achm’t
, 
busName
, 
objeùP©h
, 
£ssiÚId
);

249 ià(!
	g´oxyBusObj
) {

250  
	gER_FAIL
;

253 
CHECK_BREAK
(
´oxyBusObj
->
AddIÁ”çû
(*
p_IÁ”çûDesütiÚ
))

255 
Mes§ge
 
»¶yMsg
(*
m_BusA‰achm’t
);

256 
MsgArg
 
	g¬gs
[2];

257 
CHECK_BREAK
(
¬gs
[0].
S‘
("s", 
ÏnguageTag
))

258 ià(!(
	gcÚfigNames
.
size
() == 0)) {

259 
¡d
::
veùÜ
<cÚ¡ *> 
‹mpKeys
(
cÚfigNames
.
size
());

261 
	gi
 = 0;

262 
	g¡d
::
veùÜ
<
qcc
::
SŒšg
>::
cÚ¡_™”©Ü
 
™
 = 
cÚfigNames
.
begš
(); 
	g™
 !ğcÚfigNames.
’d
(); ++it) {

263 
	g‹mpKeys
[
i
] = 
™
->
c_¡r
();

264 
	gi
++;

266 
CHECK_BREAK
(
¬gs
[1].
S‘
("as", 
i
, 
‹mpKeys
.
d©a
()))

267 
	g¡©us
 = 
´oxyBusObj
->
M‘hodC®l
(
š‹rçûName
, "Re£tCÚfigu¿tiÚs", 
¬gs
, 2, 
»¶yMsg
);

268 ià(
	g¡©us
 =ğ
ER_BUS_REPLY_IS_ERROR_MESSAGE
) {

269 #ià!
defšed
(
NDEBUG
)

270 
qcc
::
SŒšg
 
”rÜMes§ge
;

271 cÚ¡ * 
	g”rÜName
 = 
»¶yMsg
->
G‘E¼ÜName
(&
”rÜMes§ge
);

273 
QCC_LogE¼Ü
(
¡©us
, ("Re£tCÚfigu¿tiÚ ”rÜName:% ”rÜMes§ge: %s", 
”rÜName
 ?ƒ¼ÜNam: "", 
”rÜMes§ge
.
c_¡r
() ?ƒrrorMessage.c_str() : ""));

276 
	g¡©us
 = 
ER_INVALID_DATA
;

279 
d–‘e
 
	g´oxyBusObj
;

280  
	g¡©us
;

283 
QStus
 
	gNewCÚfigCl›Á
::
G‘V”siÚ
(cÚ¡ * 
busName
, & 
v”siÚ
, cÚ¡ * 
objeùP©h
, cÚ¡ * 
š‹rçûName
, 
ajn
::
SessiÚId
 
£ssiÚId
)

285 
QCC_DbgT¿û
(("In NewConfigClient GetVersion"));

287 
QStus
 
	g¡©us
 = 
ER_OK
;

289 cÚ¡ 
IÁ”çûDesütiÚ
* 
	gp_IÁ”çûDesütiÚ
 = 
m_BusA‰achm’t
->
G‘IÁ”çû
(
š‹rçûName
);

290 ià(!
	gp_IÁ”çûDesütiÚ
) {

291  
	gER_FAIL
;

294 
ProxyBusObjeù
* 
	g´oxyBusObj
 = 
Ãw
 ProxyBusObjeù(*
m_BusA‰achm’t
, 
busName
, 
objeùP©h
, 
£ssiÚId
);

295 ià(!
	g´oxyBusObj
) {

296  
	gER_FAIL
;

299 
MsgArg
 
	g¬g
;

300 
CHECK_BREAK
(
´oxyBusObj
->
AddIÁ”çû
(*
p_IÁ”çûDesütiÚ
))

301 
CHECK_BREAK
(
´oxyBusObj
->
G‘Prİ”ty
(
š‹rçûName
, "V”siÚ", 
¬g
))

302 
	gv”siÚ
 = 
¬g
.
v_v¬ŸÁ
.
v®
->
v_št16
;

304 
d–‘e
 
	g´oxyBusObj
;

305  
	g¡©us
;

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/NewConfigClient.h

20 
	~<m­
>

21 
	~<veùÜ
>

22 
	~<¡ršg
>

23 
	~<¡dšt.h
>

25 
	~<®ljoyn/Mes§ge.h
>

26 
	~<®ljoyn/BusLi¡’”.h
>

27 
	~<®ljoyn/BusObjeù.h
>

28 
	~<®ljoyn/BusA‰achm’t.h
>

29 
	~<®ljoyn/MsgArg.h
>

30 
	~<qcc/SŒšg.h
>

32 
Çme¥aû
 
	gajn
 {

33 
Çme¥aû
 
	g£rviûs
 {

46 şas 
	cNewCÚfigCl›Á
 {

47 
	gpublic
:

51 
¡d
::
	tm­
<
	tqcc
::
	tSŒšg
, 
	tajn
::
	tMsgArg
> 
	tCÚfigu¿tiÚs
;

58 
NewCÚfigCl›Á
(cÚ¡ * 
š‹rçûName
, 
ajn
::
BusA‰achm’t
& 
bus
);

64 ~
NewCÚfigCl›Á
() { }

71 
QStus
 
FaùÜyRe£t
(cÚ¡ * 
busName
, cÚ¡ * 
objeùP©h
, cÚ¡ * 
š‹rçûName
, 
ajn
::
SessiÚId
 
£ssiÚId
 = 0);

78 
QStus
 
Re¡¬t
(cÚ¡ * 
busName
, cÚ¡ * 
objeùP©h
, cÚ¡ * 
š‹rçûName
, 
ajn
::
SessiÚId
 
£ssiÚId
 = 0);

88 
QStus
 
S‘Passcode
(cÚ¡ * 
busName
, cÚ¡ * 
d«mÚR—lm
, 
size_t
 
ÃwPasscodeSize
, cÚ¡ 
ušt8_t
* 
ÃwPasscode
, cÚ¡ * 
objeùP©h
, cÚ¡ * 
š‹rçûName
, 
ajn
::
SessiÚId
 
£ssiÚId
 = 0);

97 
QStus
 
G‘CÚfigu¿tiÚs
(cÚ¡ * 
busName
, cÚ¡ * 
ÏnguageTag
, 
CÚfigu¿tiÚs
& 
cÚfigs
, cÚ¡ * 
objeùP©h
, cÚ¡ * 
š‹rçûName
, 
ajn
::
SessiÚId
 
£ssiÚId
 = 0);

106 
QStus
 
Upd©eCÚfigu¿tiÚs
(cÚ¡ * 
busName
, cÚ¡ * 
ÏnguageTag
, cÚ¡ 
CÚfigu¿tiÚs
& 
cÚfigs
, cÚ¡ * 
objeùP©h
, cÚ¡ * 
š‹rçûName
, 
ajn
::
SessiÚId
 
£ssiÚId
 = 0);

115 
QStus
 
Re£tCÚfigu¿tiÚs
(cÚ¡ * 
busName
, cÚ¡ * 
ÏnguageTag
, cÚ¡ 
¡d
::
veùÜ
<
qcc
::
SŒšg
>& 
cÚfigNames
, cÚ¡ * 
objeùP©h
, cÚ¡ * 
š‹rçûName
, 
ajn
::
SessiÚId
 
£ssiÚId
 = 0);

124 
QStus
 
G‘V”siÚ
(cÚ¡ * 
busName
, & 
v”siÚ
, cÚ¡ * 
objeùP©h
, cÚ¡ * 
š‹rçûName
, 
ajn
::
SessiÚId
 
£ssiÚId
 = 0);

126 
	g´iv©e
:

130 
ajn
::
BusA‰achm’t
* 
m_BusA‰achm’t
;

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/alljoyConfigClient.cc

17 
	~<sigÇl.h
>

18 
	~<£t
>

20 
	~<®ljoyn/cÚfig/CÚfigCl›Á.h
>

21 
	~<®ljoyn/AboutD©a.h
>

22 
	~<®ljoyn/AboutLi¡’”.h
>

23 
	~<®ljoyn/AboutObjeùDesütiÚ.h
>

24 
	~<®ljoyn/AboutProxy.h
>

25 
	~<®ljoyn/AboutIcÚProxy.h
>

26 
	~<®ljoyn/v”siÚ.h
>

27 
	~<®ljoyn/£rviûs_commÚ/LogModuËsNames.h
>

28 
	~"§m¶es_commÚ/S½KeyXLi¡’”.h
"

29 
	~"§m¶es_commÚ/AsyncSessiÚJoš”.h
"

30 
	~"§m¶es_commÚ/SessiÚLi¡’”Im¶.h
"

31 
	~<io¡»am
>

32 
	~<iomª
>

33 
	~<¡ršg.h
>

34 
	~"NewCÚfigCl›Á.h
"

37 
	~<s¡»am
>

38 
	~<®ljoyn/PasswÜdMªag”.h
>

39 
	~<®ljoyn/nÙifiÿtiÚ/NÙifiÿtiÚS”viû.h
>

40 
	~"commÚ/NÙifiÿtiÚReûiv”Te¡Im¶.h
"

45 
	~"·r£r.h
"

46 
	~"sh¬e.h
"

47 
şoudc_£nd_Úlše_buf
(*
devD©a
);

48 
şoudc_g‘_k_Çme
(
k_šfo
 *
li¡_h—d
, *
k_Çme
, *
node_v®ue
);

49 
şoudc_´št_k_Çme_li¡
(
k_šfo
 *
li¡_h—d
);

50 
şoudc_de¡roy_k_Çme
(
k_šfo
 *
li¡_h—d
);

51 
g‘DevInfoByObj
(*
š‹rçûName
, *
objeùP©h
, *
deviûId
, *
deviûTy³
);

52 
g‘DevD©aByObj
(*
š‹rçûName
, *
devD©a
);

55 "C" 
S¹AÎjoynS”viû
();

56 "C" 
StİAÎjoynS”viû
();

57 "C" 
cÚfigCl›ÁMaš
(*
š‹rçûs
, *
m©chObjeùP©h
, 
msgTy³
, *
devD©a
);

58 
HªdËUpd©eCÚfigM‘hod
(cÚ¡ *
š‹rçûs
);

59 
Upd©eCÚfig
(
qcc
::
SŒšg
 cÚ¡& 
busName
, 
id
, cÚ¡ *
š‹rçûName
, cÚ¡ *
objeùP©h
, 
msgTy³
, *
devD©a
);

60 
CheckIfCÚfigIÁ”çûOÆše
(
ajn
::
MsgArg
 
objeùDesütiÚArg
,‡jn::MsgArg 
aboutD©aArg
, *
š‹rçûName
, *
objeùP©h
);

61 
P¬£G‘AboutD©aArg
(
ajn
::
MsgArg
 
aboutD©aArg
, *
devD©a
);

62 
IÁ”e¡eFÜAÎCÚfigIÁ”çûs
(cÚ¡ **
š‹rçûs
);

63 
NÙifiÿtiÚIn™
();

65 
	g»mÙeCÚfigFÏg
 = 0;

66 
	gÿÎbackFšish
 = 0;

67 
	g»t
 = 0;

68 
	gg‘MsgTy³
 = -1;

69 * 
	gbu¢ame
 = 
NULL
;

70 * 
	gobjeùP©h
 = 
NULL
;

71 * 
	gš‹rçûName
 = 
NULL
;

72 *
	gg‘DevD©a
 = 
NULL
;

75 
	mG‘
,

76 
	mS‘
,

77 
	mNÙify


78 }
	tMsgTy³
;

80 
usšg
 
Çme¥aû
 
	gajn
;

81 
usšg
 
Çme¥aû
 
	g£rviûs
;

83 
	#INITIAL_PASSCODE
 "000000"

	)

84 
	#NEW_PASSCODE
 "12345678"

	)

86 
BusA‰achm’t
* 
	gbusA‰achm’t
 = 0;

87 
S½KeyXLi¡’”
* 
	g¤pKeyXLi¡’”
 = 0;

88 
	g¡d
::
£t
<
qcc
::
SŒšg
> 
hªdËdAÂounûm’ts
;

90 vŞ©
sig_©omic_t
 
	gs_š‹¼u±
 = 
çl£
;

91 vŞ©
sig_©omic_t
 
	gs_¡İ³d
 = 
çl£
;

93 
	$SigIÁHªdËr
(
sig
) {

94 
s_š‹¼u±
 = 
Œue
;

95 
	}
}

98 
NÙifiÿtiÚS”viû
* 
	gcÚS”viû
 = 0;

99 
NÙifiÿtiÚReûiv”Te¡Im¶
* 
	gReûiv”
 = 0;

100 vŞ©
sig_©omic_t
 
	gs_š‹¼u±_nÙify
 = 
çl£
;

102 
	$nÙifiÿtiÚCËªup
()

104 
¡d
::
cout
 << "ş—nup(è- s¹" << std::
’dl
;

105 ià(
cÚS”viû
) {

106 
¡d
::
cout
 << "ş—nup(è- cÚS”viû" << std::
’dl
;

107 
cÚS”viû
->
	`shutdown
();

108 
cÚS”viû
 = 
NULL
;

110 ià(
Reûiv”
) {

111 
¡d
::
cout
 << "ş—nup(è- Reûiv”" << std::
’dl
;

112 
d–‘e
 
Reûiv”
;

113 
Reûiv”
 = 
NULL
;

115 
¡d
::
cout
 << "ş—nup(è-ƒnd" << std::
’dl
;

116 
	}
}

122 
	$´štAboutD©a
(
AboutD©a
& 
aboutD©a
, cÚ¡ * 
Ïnguage
)

124 
size_t
 
couÁ
 = 
aboutD©a
.
	`G‘F›lds
();

126 cÚ¡ ** 
f›lds
 = 
Ãw
 cÚ¡ *[
couÁ
];

127 
aboutD©a
.
	`G‘F›lds
(
f›lds
, 
couÁ
);

129 
size_t
 
i
 = 0; i < 
couÁ
; ++i) {

130 
¡d
::
cout
 << "\tKey: " << 
f›lds
[
i
];

132 
MsgArg
* 
tmp
;

133 
aboutD©a
.
	`G‘F›ld
(
f›lds
[
i
], 
tmp
, 
Ïnguage
);

134 
¡d
::
cout
 << "\t";

135 ià(
tmp
->
	`SigÇtu»
() == "s") {

136 cÚ¡ * 
tmp_s
;

137 
tmp
->
	`G‘
("s", &
tmp_s
);

138 
¡d
::
cout
 << 
tmp_s
;

139 } ià(
tmp
->
	`SigÇtu»
() == "as") {

140 
size_t
 
Ïs
;

141 
MsgArg
* 
as_¬g
;

142 
tmp
->
	`G‘
("as", &
Ïs
, &
as_¬g
);

143 
size_t
 
j
 = 0; j < 
Ïs
; ++j) {

144 cÚ¡ * 
tmp_s
;

145 
as_¬g
[
j
].
	`G‘
("s", &
tmp_s
);

146 
¡d
::
cout
 << 
tmp_s
 << " ";

148 } ià(
tmp
->
	`SigÇtu»
() == "ay") {

149 
size_t
 
Ïy
;

150 
ušt8_t
* 
·y
;

151 
tmp
->
	`G‘
("ay", &
Ïy
, &
·y
);

152 
size_t
 
j
 = 0; j < 
Ïy
; ++j) {

153 
¡d
::
cout
 << std::
hex
 << 
¡©ic_ÿ¡
<>(
·y
[
j
]) << " ";

156 
¡d
::
cout
 << "U£¸Defšed V®ue\tSigÇtu»: " << 
tmp
->
	`SigÇtu»
().
	`c_¡r
();

158 
¡d
::
cout
 << std::
’dl
;

160 
d–‘e
 [] 
f›lds
;

161 
¡d
::
cout
 << std::
’dl
;

162 
	}
}

164 
	$´štAÎAboutD©a
(
AboutProxy
& 
aboutProxy
)

166 
MsgArg
 
aArg
;

167 
QStus
 
¡©us
 = 
aboutProxy
.
	`G‘AboutD©a
(
NULL
, 
aArg
);

168 ià(
¡©us
 =ğ
ER_OK
) {

169 
¡d
::
cout
 << "*********************************************************************************" << std::
’dl
;

170 
¡d
::
cout
 << "G‘AboutD©a: (DeçuÉ Lªguage)" << std::
’dl
;

171 
AboutD©a
 
	`aboutD©a
(
aArg
);

172 
	`´štAboutD©a
(
aboutD©a
, 
NULL
);

173 
size_t
 
Ïng_num
;

174 
Ïng_num
 = 
aboutD©a
.
	`G‘SuµÜ‹dLªguages
();

175 
¡d
::
cout
 << "Numb” oàsuµÜ‹d†ªguages: " << 
Ïng_num
 << std::
’dl
;

177 ià(
Ïng_num
 > 1) {

178 cÚ¡ ** 
Ïngs
 = 
Ãw
 cÚ¡ *[
Ïng_num
];

179 
aboutD©a
.
	`G‘SuµÜ‹dLªguages
(
Ïngs
, 
Ïng_num
);

180 * 
deçuÉLªguage
;

181 
aboutD©a
.
	`G‘DeçuÉLªguage
(&
deçuÉLªguage
);

184 
size_t
 
i
 = 0; i < 
Ïng_num
; ++i) {

185 
¡d
::
cout
 << "Ïnguage=" << 
i
 << " " << 
Ïngs
[i] << std::
’dl
;

186 ià(
	`¡rcmp
(
deçuÉLªguage
, 
Ïngs
[
i
]) != 0) {

187 
¡d
::
cout
 << "C®lšg G‘AboutD©a:†ªguage=" << 
Ïngs
[
i
] << std::
’dl
;

188 
¡©us
 = 
aboutProxy
.
	`G‘AboutD©a
(
Ïngs
[
i
], 
aArg
);

189 ià(
ER_OK
 =ğ
¡©us
) {

190 
aboutD©a
.
	`C»©eäomMsgArg
(
aArg
, 
Ïngs
[
i
]);

191 
¡d
::
cout
 << "G‘AboutD©a: (" << 
Ïngs
[
i
] << ")" << std::
’dl
;

192 
	`´štAboutD©a
(
aboutD©a
, 
Ïngs
[
i
]);

194 
¡d
::
cout
 << "G‘AboutD©¨çed " << 
	`QCC_StusText
(
¡©us
è<< std::
’dl
;

198 
d–‘e
 [] 
Ïngs
;

200 
¡d
::
cout
 << "*********************************************************************************" << std::
’dl
;

202 
	}
}

204 
	$š‹¼u±ibËD–ay
(
£cÚds
) {

205 
i
 = 0; !
s_š‹¼u±
 && i < 
£cÚds
; i++) {

206 #ifdeà
_WIN32


207 
	`SË•
(1000);

209 
	`u¦“p
(1000 * 1000);

212 
	}
}

214 şas 
	cMyAboutLi¡’”
 : 
public
 
AboutLi¡’”
 {

215 
	$AÂounûd
(cÚ¡ * 
busName
, 
ušt16_t
 
v”siÚ
, 
SessiÚPÜt
 
pÜt
, cÚ¡ 
MsgArg
& 
objeùDesütiÚArg
, cÚ¡ MsgArg& 
aboutD©aArg
)

217 
¡d
::
cout
<<"GaoJšg EÁ” AÂounûd func"<<¡d::
’dl
;

218 
¡d
::
cout
<<"GaoJšg bu¢amğ"<<
busName
 << ", v”siÚ = " << 
v”siÚ
 << ",…Üˆğ" << 
pÜt
 <<""<<¡d::
’dl
;

220 
QStus
 
¡©us
 = 
ER_OK
;

226 
thisIÁ”çûName
[
MAX_INTERFACE_LEN
] = {0};

227 
thisObjeùP©h
[
MAX_OBJECTPATH_LEN
] = {0};

229 
	`CheckIfCÚfigIÁ”çûOÆše
(
objeùDesütiÚArg
, 
aboutD©aArg
, 
thisIÁ”çûName
, 
thisObjeùP©h
);

232 if(
»mÙeCÚfigFÏg
 == 1)

234 
busA‰achm’t
->
	`EÇbËCÚcu¼’tC®lbacks
();

238 
	#PING_WAIT_TIME
 5000

	)

239 
QStus
 
¡©us
 = 
busA‰achm’t
->
	`Pšg
(
busName
, 5000);

240 ifĞ
ER_OK
 =ğ
¡©us
)

242 
¡d
::
cout
 << "GaoJšg…šg sucûed" << std::
’dl
;

246 
¡d
::
cout
 << "GaoJšg…šg fa" << std::
’dl
;

250 
SessiÚId
 
£ssiÚId
;

251 
SessiÚO±s
 
	`İts
(SessiÚO±s::
TRAFFIC_MESSAGES
, 
çl£
,

252 
SessiÚO±s
::
PROXIMITY_ANY
, 
TRANSPORT_ANY
);

253 
¡©us
 = 
busA‰achm’t
->
	`JošSessiÚ
(
busName
, 
pÜt
, 
NULL
, 
£ssiÚId
, 
İts
);

255 if(
¡©us
 =ğ
ER_OK
)

257 
¡d
::
cout
 << "JošSessiÚ Sucûss, sessiÚId = "<<
£ssiÚId
<<"" << std::
’dl
;

258 
»mÙeCÚfigFÏg
 = 0;

259 
¡d
::
cout
 << "objeùP©h = " << 
objeùP©h
 << std::
’dl
;

260 
¡d
::
cout
 << "š‹rçûNamğ" << 
š‹rçûName
 << std::
’dl
;

261 
	`Upd©eCÚfig
(
busName
, 
£ssiÚId
, 
š‹rçûName
, 
objeùP©h
, 
g‘MsgTy³
, 
g‘DevD©a
);

265 
¡d
::
cout
 << "WARNING - JošSessiÚ faed: " << 
	`QCC_StusText
(
¡©us
è<< std::
’dl
;

270 
¡d
::
cout
 << "GaoJšg Thi ªnounû i nØu£" <<¡d::
’dl
;

274 
¡d
::
cout
<<"GaoJšg Ex™ AÂounûd func"<<¡d::
’dl
;

276 
	}
};

278 
MyAboutLi¡’”
* 
	gaboutLi¡’”
 = 0;

279 
	$Wa™FÜSigIÁ
() {

280 
¡d
::
cout
<<"GaoJšg EÁ” wa™ sigIÁ funø"<<¡d::
’dl
;

281 
s_š‹¼u±
 =ğ
çl£
 && 
s_¡İ³d
 == false) {

282 #ifdeà
_WIN32


283 
	`SË•
(100);

285 
	`u¦“p
(100 * 1000);

288 
¡d
::
cout
<<"GaoJšg Ex™ wa™ sigIÁ funø"<<¡d::
’dl
;

289 
	}
}

291 
	$C»©eBusA‰achm’t
()

293 
QStus
 
¡©us
 = 
ER_OK
;

294 
¡d
::
cout
 << "AÎJoyÀLib¿ry v”siÚ: " << 
ajn
::
	`G‘V”siÚ
(è<< std::
’dl
;

295 
¡d
::
cout
 << "AÎJoyÀLib¿ry bud info: " << 
ajn
::
	`G‘BudInfo
(è<< std::
’dl
;

297 
¡d
::
cout
 << "*********************************************************************************" << std::
’dl
;

298 
¡d
::
cout
 << "PLEASE NOTE THAT AS OF NOW THIS PROGRAM DOES NOT SUPPORT INTERACTION WITH THE ALLJOYN THIN CLIENT BASED CONFIGSAMPLE. SO PLEASE USE THIS PROGRAM ONLY WITH ALLJOYN STANDARD CLIENT BASED CONFIGSERVICESAMPLE" << std::
’dl
;

299 
¡d
::
cout
 << "*********************************************************************************" << std::
’dl
;

306 
	`sigÇl
(
SIGINT
, 
SigIÁHªdËr
);

309 #ifdeà
QCC_USING_BD


310 
PasswÜdMªag”
::
	`S‘C»d’tŸls
("ALLJOYN_PIN_KEYX", "000000");

313 
busA‰achm’t
 = 
Ãw
 
	`BusA‰achm’t
("CloudcCÚfig", 
Œue
);

315 
¡©us
 = 
busA‰achm’t
->
	`S¹
();

316 ià(
¡©us
 =ğ
ER_OK
) {

317 
¡d
::
cout
 << "BusA‰achm’ˆ¡¬‹d." << std::
’dl
;

319 
¡d
::
cout
 << "ERROR - UÇbËØ¡¬ˆBusA‰achm’t. Stus: " << 
	`QCC_StusText
(
¡©us
è<< std::
’dl
;

323 
¡©us
 = 
busA‰achm’t
->
	`CÚÃù
();

324 ià(
ER_OK
 =ğ
¡©us
) {

325 
¡d
::
cout
 << "D«mÚ CÚÃù sucûeded." << std::
’dl
;

327 
¡d
::
cout
 << "ERROR - FaedØcÚÃù d«mÚ. Stus: " << 
	`QCC_StusText
(
¡©us
è<< std::
’dl
;

331 
	}
}

333 
CheckIfCÚfigIÁ”çûOÆše
(
ajn
::
MsgArg
 
objeùDesütiÚArg
,‡jn::MsgArg 
aboutD©aArg
, *
š‹rçûName
, *
objeùP©h
)

335 
QStus
 
	g¡©us
 = 
ER_OK
;

336 *
	gdeviûObjeùP©h
 = 
NULL
;

337 *
	gdeviûIÁ”çûName
 = 
NULL
;

338 
MsgArg
* 
	g‹mpArgs
;

339 
size_t
 
	gobjeùNum
;

340 
	g¡©us
 = 
objeùDesütiÚArg
.
G‘
("a(ßs)", &
objeùNum
, &
‹mpArgs
);

341 
	g¡d
::
cout
 << "GaoJšg objeùNum = " << 
objeùNum
 << 
¡d
::
’dl
;

343 if(
	g¡©us
 !ğ
ER_OK
)

348 
size_t
 
	gi
 = 0; i < 
	gobjeùNum
; i ++)

350 * 
	gobjeùDesütiÚP©h
;

351 
MsgArg
* 
	gš‹rçûEÁ”›s
;

352 
size_t
 
	gš‹rçûNum
;

354 
	g¡©us
 = 
‹mpArgs
[
i
].
G‘
("(ßs)", &
objeùDesütiÚP©h
, &
š‹rçûNum
, &
š‹rçûEÁ”›s
);

355 
	g¡d
::
cout
 << "GaoJšg objeùDesütiÚP©h " << 
i
 << ": " << 
objeùDesütiÚP©h
 << ", it š‹rçûNum = " << 
š‹rçûNum
 << 
¡d
::
’dl
;

357 if(
¡r¡r
(
objeùDesütiÚP©h
, "/CÚfig"è=ğ
NULL
)

359 
¡d
::
cout
 << "NÙ found CÚfigIÁ”çû oÀthi objeùP©h" << std::
’dl
;

363 
mem£t
(
objeùP©h
, 0, 
MAX_OBJECTPATH_LEN
);

364 
	gdeviûObjeùP©h
 = 
objeùDesütiÚP©h
;

365 
¡ºıy
(
objeùP©h
, 
deviûObjeùP©h
, 
MAX_OBJECTPATH_LEN
 - 1);

366 
´štf
("Úlš0 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ objeùP©h = %s\n", 
objeùP©h
);

368 if(
	g¡©us
 !ğ
ER_OK
)

373 
size_t
 
	gi
 = 0; i < 
	gš‹rçûNum
; i ++)

375 * 
	gš‹rçûOfAÂounû
;

376 
	g¡©us
 = 
š‹rçûEÁ”›s
[
i
].
G‘
("s", &
š‹rçûOfAÂounû
);

377 
	g¡d
::
cout
 << "GaoJšg IÁ”çûOfAÂounû " << 
i
 << ": " << 
š‹rçûOfAÂounû
 << 
¡d
::
’dl
;

378 if(
	g¡©us
 !ğ
ER_OK
)

383 if(
¡r¡r
(
š‹rçûOfAÂounû
, "CÚfig"è=ğ
NULL
)

388 
mem£t
(
š‹rçûName
, 0, 
MAX_INTERFACE_LEN
);

389 
	gdeviûIÁ”çûName
 = 
š‹rçûOfAÂounû
;

390 
¡ºıy
(
š‹rçûName
, 
deviûIÁ”çûName
, 
MAX_INTERFACE_LEN
 - 1);

392 
	g¡d
::
£t
<
qcc
::
SŒšg
>::
™”©Ü
 
£¬chI‹¿tÜ
 = 
hªdËdAÂounûm’ts
.
fšd
(qcc::SŒšg(
š‹rçûName
));

393 if(
	g£¬chI‹¿tÜ
 =ğ
hªdËdAÂounûm’ts
.
’d
())

395 
´štf
("Úlš1 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ iÁ”çûNamğ%s\n", 
š‹rçûName
);

396 
	gdevD©a
[
MAX_DEVDATA_LEN
] = {0};

398 
	ghªdËdAÂounûm’ts
.
š£¹
(
š‹rçûName
);

400 
P¬£G‘AboutD©aArg
(
aboutD©aArg
, 
devD©a
);

403 
g‘DevD©aByObj
(
š‹rçûName
, 
devD©a
);

404 
şoudc_£nd_Úlše_buf
(
devD©a
);

411 
	g¡d
::
cout
 << "deviûObjeùP©h = " << 
deviûObjeùP©h
 << ", deviûIÁ”çûNamğ" << 
deviûIÁ”çûName
 << 
¡d
::
’dl
;

420 
P¬£G‘AboutD©aArg
(
ajn
::
MsgArg
 
aboutD©aArg
, *
devD©a
)

422 
	g¡d
::
cout
 << "GaoJšg EÁ” P¬£G‘AboutD©aArg func" << 
¡d
::
’dl
;

423 
QStus
 
	g¡©us
 = 
ER_OK
;

424 
AboutD©a
 
	gaboutD©a
;

425 
MsgArg
* 
	g‹mpCÚŒŞArg2
;

426 
size_t
 
	gÏnguageTagNumEËm’ts
;

428 
	g¡©us
 = 
aboutD©aArg
.
G‘
("a{sv}", &
ÏnguageTagNumEËm’ts
, &
‹mpCÚŒŞArg2
);

429 ià(
	g¡©us
 !ğ
ER_OK
)

431 
¡d
::
cout
 << "Ex™ P¬£G‘AboutD©aArg func" << std::
’dl
;

435 
size_t
 
	gi
 = 0; i < 
	gÏnguageTagNumEËm’ts
; i++)

437 * 
	g‹mpKey
;

438 
MsgArg
* 
	g‹mpV®ue
;

439 
	g¡©us
 = 
‹mpCÚŒŞArg2
[
i
].
G‘
("{sv}", &
‹mpKey
, &
‹mpV®ue
);

440 ià(
	g¡©us
 !ğ
ER_OK
) {

441 
¡d
::
cout
 << "Ex™ P¬£G‘AboutD©aArg func" << std::
’dl
;

446 if(
¡rcmp
(
‹mpKey
, "DevData") == 0)

448 
¡d
::
cout
 << "‹mpKey = " << 
‹mpKey
 << std::
’dl
;

449 
	g¡d
::
cout
 << "‹mpV®uğ" << 
‹mpV®ue
 << 
¡d
::
’dl
;

451 * 
	gv®ue
 = 
NULL
;

452 
	g¡©us
 = 
‹mpV®ue
->
G‘
("s", &
v®ue
);

453 ià(
	g¡©us
 =ğ
ER_OK
) {

454 
´štf
("v®uğ%s\n", 
v®ue
);

458 
´štf
("cannot gethe value\n");

460 
¡ºıy
(
devD©a
, 
v®ue
, 
MAX_DEVDATA_LEN
 - 1);

465 
	g¡d
::
cout
 << "GaoJšg Ex™ P¬£G‘AboutD©aArg func" << 
¡d
::
’dl
;

469 
	$HªdËUpd©eCÚfigM‘hod
(cÚ¡ *
š‹rçûs
)

471 
¡d
::
cout
<<"GaoJšg EÁ” HªdËUpd©eCÚfigM‘hod func"<<¡d::
’dl
;

472 
QStus
 
¡©us
 = 
ER_OK
;

473 
busA‰achm’t
->
	`CªûlWhoIm¶em’ts
(
š‹rçûs
);

474 
¡©us
 = 
busA‰achm’t
->
	`WhoIm¶em’ts
(
š‹rçûs
);

475 ià(
ER_OK
 =ğ
¡©us
) {

476 
¡d
::
cout
 << "WhoIm¶em’t ÿÎed." << std::
’dl
;

478 
¡d
::
cout
 << "ERROR - WhoIm¶em’t ÿÎ FAILED w™h stu " << 
	`QCC_StusText
(
¡©us
è<< std::
’dl
;

481 
¡d
::
cout
<<"GaoJšg Ex™ HªdËUpd©eCÚfigM‘hod func"<<¡d::
’dl
;

483 
	}
}

485 
Upd©eCÚfig
(
qcc
::
SŒšg
 cÚ¡& 
busName
, 
id
, cÚ¡ *
š‹rçûName
, cÚ¡ *
objeùP©h
, 
msgTy³
, *
devD©a
)

487 
MsgTy³
 
	gmsgTy³O±iÚ
;

488 
QStus
 
	g¡©us
 = 
ER_OK
;

490 
	g¡d
::
cout
<<"GaoJšg EÁ” Upd©eCÚfig func"<<
¡d
::
’dl
;

491 
AboutProxy
 
aboutProxy
(*
busA‰achm’t
, 
busName
.
c_¡r
(), 
id
);

493 
MsgArg
 
	gobjArg
;

494 
	gaboutProxy
.
G‘ObjeùDesütiÚ
(
objArg
);

495 
	g¡d
::
cout
 << "AboutProxy.G‘ObjeùDesütiÚs:\n" << 
objArg
.
ToSŒšg
().
c_¡r
(è<< "\n\n" << 
¡d
::
’dl
;

497 
AboutObjeùDesütiÚ
 
	gobjeùDesütiÚ
;

498 
	gobjeùDesütiÚ
.
C»©eFromMsgArg
(
objArg
);

500 
boŞ
 
	gisCÚfigIÁ”çû
 = 
çl£
;

501 ià(!
	gs_š‹¼u±
) {

502 
	gisCÚfigIÁ”çû
 = 
objeùDesütiÚ
.
HasIÁ”çû
(
objeùP©h
, 
š‹rçûName
);

503 ià(
	gisCÚfigIÁ”çû
) {

504 
	g¡d
::
cout
 << "Thgiv’ iÁ”çû '" << 
š‹rçûName
 << "' i found iÀ¨giv’…©h ' " << 
objeùP©h
 << 
¡d
::
’dl
;

506 
	g¡d
::
cout
 << "WARNING - Thgiv’ iÁ”çû '" << 
š‹rçûName
 << "' i nÙ found iÀ¨giv’…©h ' " << 
objeùP©h
 << 
¡d
::
’dl
;

511 
	g£rviûs
::
NewCÚfigCl›Á
* 
ÃwCÚfigCl›Á
 = 
NULL
;

512 ià(!
	gs_š‹¼u±
 && 
	gisCÚfigIÁ”çû
) {

513 
	gÃwCÚfigCl›Á
 = 
Ãw
 
£rviûs
::
NewCÚfigCl›Á
(
š‹rçûName
, *
busA‰achm’t
);

514 ià(!
	gs_š‹¼u±
 && 
	gÃwCÚfigCl›Á
) {

516 
	gmsgTy³
)

518 
	gG‘
:

519 
¡d
::
cout
 << "G‘" << std::
’dl
;

520 
	g¡d
::
cout
 << "nÙ u£d‚ow, sØnØÃedØhªdË ~~" << 
¡d
::
’dl
;

523 
	gS‘
:

524 
¡d
::
cout
 << "£t" << std::
’dl
;

525 ià(!
	gs_š‹¼u±
)

527 if(
	gNULL
 !ğ
devD©a
)

529 ià(!
s_š‹¼u±
) {

530 
¡d
::
cout
 << "\nGošgØÿÎØUpd©eCÚfigu¿tiÚs: key=DevD©¨v®ue=" << 
devD©a
 << std::
’dl
;

531 
	g¡d
::
cout
 << "-------------------------------------------------------------------" << 
¡d
::
’dl
;

532 
	g£rviûs
::
NewCÚfigCl›Á
::
CÚfigu¿tiÚs
 
upd©eCÚfigu¿tiÚs
;

533 
	gupd©eCÚfigu¿tiÚs
.
š£¹
(

534 
¡d
::
·œ
<
qcc
::
SŒšg
, 
ajn
::
MsgArg
>("DevD©a", MsgArg("s", 
devD©a
)));

535 ià((
	g¡©us
 = 
ÃwCÚfigCl›Á
->
Upd©eCÚfigu¿tiÚs
(
busName
.
c_¡r
(), 
NULL
, 
upd©eCÚfigu¿tiÚs
, 
objeùP©h
, 
š‹rçûName
, 
id
)è=ğ
ER_OK
) {

536 
¡d
::
cout
 << "Upd©eCÚfigu¿tiÚ DevD©¨sucûeded" << std::
’dl
;

537 
	g»t
 = 0;

539 
	g¡d
::
cout
 << "WARNING - C®ÈtØUpd©eCÚfigu¿tiÚ DevD©¨çed: " << 
QCC_StusText
(
¡©us
è<< 
¡d
::
’dl
;

540 
	g»t
 = -1;

544 
š‹¼u±ibËD–ay
(3);

551 
	gNÙify
:

552 
¡d
::
cout
 << "NÙify" << std::
’dl
;

556 
¡d
::
cout
 << "UnknowÀmsgTy³" << std::
’dl
;

563 
	g¡©us
 = 
busA‰achm’t
->
L—veSessiÚ
(
id
);

564 
	g¡d
::
cout
 << "L—všg sessiÚ id = " << 
id
 << " w™h " << 
busName
.
c_¡r
(è<< " stus: " << 
QCC_StusText
(
¡©us
è<< 
¡d
::
’dl
;

566 ià(
	gÃwCÚfigCl›Á
) {

567 
d–‘e
 
	gÃwCÚfigCl›Á
;

568 
	gÃwCÚfigCl›Á
 = 
NULL
;

571 
	gs_¡İ³d
 = 
Œue
;

572 
	gÿÎbackFšish
 = 1;

573 
	g¡d
::
cout
<<"GaoJšg Ex™ Upd©eCÚfig func"<<
¡d
::
’dl
;

576 
	$IÁ”e¡eFÜAÎCÚfigIÁ”çûs
(cÚ¡ **
š‹rçûs
)

578 
¡d
::
cout
 << "GaoJšg EÁ” iÁ”e¡ func" << std::
’dl
;

579 
QStus
 
¡©us
 = 
ER_OK
;

581 
¤pKeyXLi¡’”
 = 
Ãw
 
	`S½KeyXLi¡’”
();

582 
¤pKeyXLi¡’”
->
	`£tPassCode
(
INITIAL_PASSCODE
);

584 
¡©us
 = 
busA‰achm’t
->
	`EÇbËP“rSecur™y
("ALLJOYN_SRP_KEYX ALLJOYN_PIN_KEYX ALLJOYN_ECDHE_PSK", 
¤pKeyXLi¡’”
,

585 "/.®ljoyn_key¡Üe/ûÁ¿l.ks", 
Œue
);

587 ià(
ER_OK
 =ğ
¡©us
) {

588 
¡d
::
cout
 << "ER_BUS_SECURITY__ENABLED" << std::
’dl
;

590 
¡d
::
cout
 << "ERROR - ER_BUS_SECURITY_NOT_ENABLED " << 
	`QCC_StusText
(
¡©us
è<< std::
’dl
;

594 
aboutLi¡’”
 = 
Ãw
 
	`MyAboutLi¡’”
();

595 
busA‰achm’t
->
	`Regi¡”AboutLi¡’”
(*
aboutLi¡’”
);

597 
¡©us
 = 
busA‰achm’t
->
	`WhoIm¶em’ts
(
š‹rçûs
, (interfaces) / (interfaces[0]));

598 ià(
ER_OK
 =ğ
¡©us
) {

599 
¡d
::
cout
 << "WhoIm¶em’t ÿÎed." << std::
’dl
;

601 
¡d
::
cout
 << "ERROR - WhoIm¶em’t ÿÎ FAILED w™h stu " << 
	`QCC_StusText
(
¡©us
è<< std::
’dl
;

605 
¡d
::
cout
 << "GaoJšg Ex™ iÁ”e¡ func" << std::
’dl
;

608 
	}
}

611 
	$NÙifiÿtiÚIn™
()

613 
¡d
::
cout
 << "Begš NÙifiÿtiÚ CÚsum” AµliÿtiÚ." << std::
’dl
;

614 
QStus
 
¡©us
 = 
ER_OK
;

615 
¡d
::
¡ršg
 
li¡OfAµs
 = "";

622 
cÚS”viû
 = 
NÙifiÿtiÚS”viû
::
	`g‘In¡ªû
();

623 
Reûiv”
 = 
Ãw
 
	`NÙifiÿtiÚReûiv”Te¡Im¶
(
çl£
);

627 
Reûiv”
->
	`£tAµliÿtiÚs
(
li¡OfAµs
.
	`c_¡r
());

629 
¡©us
 = 
cÚS”viû
->
	`š™Reûive
(
busA‰achm’t
, 
Reûiv”
);

630 ià(
¡©us
 !ğ
ER_OK
) {

631 
¡d
::
cout
 << "Could‚Ù in™Ÿliz»ûiv”." << std::
’dl
;

632 
cÚS”viû
->
	`shutdown
();

633 
cÚS”viû
 = 
NULL
;

634 
d–‘e
 
Reûiv”
;

635 
Reûiv”
 = 
NULL
;

639 
¡d
::
cout
 << "Wa™šg fÜ‚ÙifiÿtiÚs." << std::
’dl
;

641 
	}
}

644 
	$S¹AÎjoynS”viû
()

646 
¡d
::
cout
 << "GaoJšg EÁ” S¹AÎjoynS”viû func" << std::
’dl
;

647 
	`C»©eBusA‰achm’t
();

648 cÚ¡ * 
š‹rçûs
[] = {"*.*.*.Config"};

649 
	`IÁ”e¡eFÜAÎCÚfigIÁ”çûs
(
š‹rçûs
);

650 
	`NÙifiÿtiÚIn™
();

651 
¡d
::
cout
 << "GaoJšg Ex™ S¹AÎjoynS”viû func" << std::
’dl
;

652 
	}
}

654 
	$StİAÎjoynS”viû
()

656 
¡d
::
cout
 << "GaoJšg EÁ” StİAÎjoynS”viû func" << std::
’dl
;

657 cÚ¡ * 
š‹rçûs
[] = {"*.*.*.Config"};

659 
	`nÙifiÿtiÚCËªup
();

661 
busA‰achm’t
->
	`CªûlWhoIm¶em’ts
(
š‹rçûs
, (interfaces) / (interfaces[0]));

662 
busA‰achm’t
->
	`UÄegi¡”AboutLi¡’”
(*
aboutLi¡’”
);

663 
busA‰achm’t
->
	`EÇbËP“rSecur™y
(
NULL
, NULL, NULL, 
Œue
);

665 
d–‘e
 
¤pKeyXLi¡’”
;

666 
d–‘e
 
aboutLi¡’”
;

667 
¤pKeyXLi¡’”
 = 0;

668 
aboutLi¡’”
 = 0;

670 
busA‰achm’t
->
	`Stİ
();

671 
d–‘e
 
busA‰achm’t
;

672 
busA‰achm’t
 = 0;

673 
¡d
::
cout
 << "GaoJšg Ex™ StİAÎjoynS”viû func" << std::
’dl
;

674 
	}
}

677 
	$cÚfigCl›ÁMaš
(*
š‹rçûs
, *
m©chObjeùP©h
, 
msgTy³
, *
devD©a
)

679 
¡d
::
cout
 << "GaoJšg EÁ” cÚfigCl›ÁMaš func" << std::
’dl
;

680 if(
busA‰achm’t
 == 0)

682 
¡d
::
cout
 << "GaoJšg Ex™ cÚfigCl›ÁMaš func" << std::
’dl
;

685 
¡d
::
cout
 <<"busA‰achm’ˆğ" << 
busA‰achm’t
 << ", iÁ”çû ğ" << 
š‹rçûs
 << ", m©chObjeùP©h = " << 
m©chObjeùP©h
 << "" <<¡d::
’dl
;

686 
»mÙeCÚfigFÏg
 = 1;

687 
š‹rçûName
 = 
š‹rçûs
;

688 
objeùP©h
 = 
m©chObjeùP©h
;

689 
g‘MsgTy³
 = 
msgTy³
;

690 
g‘DevD©a
 = 
devD©a
;

692 
	`HªdËUpd©eCÚfigM‘hod
(
š‹rçûs
);

694 
ÿÎbackFšish
 != 1)

696 
	`u¦“p
(100*1000);

698 
s_š‹¼u±
 = 
çl£
;

699 
s_¡İ³d
 = 
çl£
;

700 
ÿÎbackFšish
 = 0;

701 
¡d
::
cout
 << "GaoJšg Ex™ cÚfigCl›ÁMaš func" << std::
’dl
;

702  
»t
;

704 
	}
}

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/cJSON.c

26 
	~<¡ršg.h
>

27 
	~<¡dio.h
>

28 
	~<m©h.h
>

29 
	~<tgm©h.h
>

30 
	~<¡dlib.h
>

31 
	~<æßt.h
>

32 
	~<lim™s.h
>

33 
	~<ùy³.h
>

34 
	~"cJSON.h
"

36 cÚ¡ *
	g•
;

38 cÚ¡ *
	$cJSON_G‘E¼ÜPŒ
(è{ 
•
;
	}
}

40 
	$cJSON_¡rÿ£cmp
(cÚ¡ *
s1
,cÚ¡ *
s2
)

42 ià(!
s1
è (s1==
s2
)?0:1;if (!s2)  1;

43 ; 
	`tŞow”
(*
s1
è=ğtŞow”(*
s2
); ++s1, ++s2) if(*s1 == 0)  0;

44  
	`tŞow”
(*(cÚ¡ *)
s1
è-Şow”(*(cÚ¡ *)
s2
);

45 
	}
}

47 *(*
	gcJSON_m®loc
)(
size_t
 
	gsz
èğ
m®loc
;

48 (*
cJSON_ä“
)(*
±r
èğ
ä“
;

50 * 
	$cJSON_¡rdup
(cÚ¡ * 
¡r
)

52 
size_t
 
Ën
;

53 * 
cİy
;

55 
Ën
 = 
	`¡¾’
(
¡r
) + 1;

56 ià(!(
cİy
 = (*)
	`cJSON_m®loc
(
Ën
)))  0;

57 
	`memıy
(
cİy
,
¡r
,
Ën
);

58  
cİy
;

59 
	}
}

61 
	$cJSON_In™Hooks
(
cJSON_Hooks
* 
hooks
)

63 ià(!
hooks
) {

64 
cJSON_m®loc
 = 
m®loc
;

65 
cJSON_ä“
 = 
ä“
;

69 
cJSON_m®loc
 = (
hooks
->
m®loc_â
)?hooks->m®loc_â:
m®loc
;

70 
cJSON_ä“
 = (
hooks
->
ä“_â
)?hooks->ä“_â:
ä“
;

71 
	}
}

74 
cJSON
 *
	$cJSON_New_I‹m
()

76 
cJSON
* 
node
 = (cJSON*)
	`cJSON_m®loc
((cJSON));

77 ià(
node
è
	`mem£t
Òode,0,(
cJSON
));

78  
node
;

79 
	}
}

82 
	$cJSON_D–‘e
(
cJSON
 *
c
)

84 
cJSON
 *
Ãxt
;

85 
c
)

87 
Ãxt
=
c
->next;

88 ià(!(
c
->
ty³
&
cJSON_IsReã»nû
è&& c->
chd
è
	`cJSON_D–‘e
(c->child);

89 ià(!(
c
->
ty³
&
cJSON_IsReã»nû
è&& c->
v®ue¡ršg
è
	`cJSON_ä“
(c->valuestring);

90 ià(!(
c
->
ty³
&
cJSON_SŒšgIsCÚ¡
è&& c->
¡ršg
è
	`cJSON_ä“
(c->string);

91 
	`cJSON_ä“
(
c
);

92 
c
=
Ãxt
;

94 
	}
}

97 cÚ¡ *
	$·r£_numb”
(
cJSON
 *
™em
,cÚ¡ *
num
)

99 
n
=0,
sign
=1,
sÿË
=0;
subsÿË
=0,
signsubsÿË
=1;

101 ià(*
num
=='-'è
sign
=-1,num++;

102 ià(*
num
=='0')‚um++;

103 ià(*
num
>='1' && *num<='9'èdØ
n
=(n*10.0)+(*num++ -'0'); *num>='0' && *num<='9');

104 ià(*
num
=='.' &&‚um[1]>='0' &&‚um[1]<='9'è{num++; dØ
n
=Ò*10.0)+(*num++ -'0'),
sÿË
--; *num>='0' && *num<='9');}

105 ià(*
num
=='e' || *num=='E')

106 { 
num
++;ià(*num=='+'ènum++; ià(*num=='-'è
signsubsÿË
=-1,num++;

107 *
num
>='0' && *num<='9'è
subsÿË
=(subscale*10)+(*num++ - '0');

110 
n
=
sign
*n*
	`pow
(10.0,(
sÿË
+
subsÿË
*
signsubsÿË
));

112 
™em
->
v®uedoubË
=
n
;

113 
™em
->
v®uešt
=()
n
;

114 
™em
->
ty³
=
cJSON_Numb”
;

115  
num
;

116 
	}
}

118 
	$pow2gt
 (
x
è{ --x; x|=x>>1; x|=x>>2; x|=x>>4; x|=x>>8; x|=x>>16;  x+1; 
	}
}

120 ¡ruù {*
	mbufãr
; 
	mËngth
; 
	moff£t
; } 
	t´štbufãr
;

122 * 
	$’su»
(
´štbufãr
 *
p
,
Ãeded
)

124 *
Ãwbufãr
;
Ãwsize
;

125 ià(!
p
 || !p->
bufãr
)  0;

126 
Ãeded
+=
p
->
off£t
;

127 ià(
Ãeded
<=
p
->
Ëngth
è…->
bufãr
+p->
off£t
;

129 
Ãwsize
=
	`pow2gt
(
Ãeded
);

130 
Ãwbufãr
=(*)
	`cJSON_m®loc
(
Ãwsize
);

131 ià(!
Ãwbufãr
è{
	`cJSON_ä“
(
p
->
bufãr
);p->
Ëngth
=0,p->buffer=0; 0;}

132 ià(
Ãwbufãr
è
	`memıy
Òewbufãr,
p
->
bufãr
,p->
Ëngth
);

133 
	`cJSON_ä“
(
p
->
bufãr
);

134 
p
->
Ëngth
=
Ãwsize
;

135 
p
->
bufãr
=
Ãwbufãr
;

136  
Ãwbufãr
+
p
->
off£t
;

137 
	}
}

139 
	$upd©e
(
´štbufãr
 *
p
)

141 *
¡r
;

142 ià(!
p
 || !p->
bufãr
)  0;

143 
¡r
=
p
->
bufãr
+p->
off£t
;

144  
p
->
off£t
+
	`¡¾’
(
¡r
);

145 
	}
}

148 *
	$´št_numb”
(
cJSON
 *
™em
,
´štbufãr
 *
p
)

150 *
¡r
=0;

151 
d
=
™em
->
v®uedoubË
;

152 ià(
d
==0)

154 ià(
p
è
¡r
=
	`’su»
(p,2);

155 
¡r
=(*)
	`cJSON_m®loc
(2);

156 ià(
¡r
è
	`¡rıy
(str,"0");

158 ià(
	`çbs
((()
™em
->
v®uešt
)-
d
)<=
DBL_EPSILON
 && d<=
INT_MAX
 && d>=
INT_MIN
)

160 ià(
p
è
¡r
=
	`’su»
(p,21);

161 
¡r
=(*)
	`cJSON_m®loc
(21);

162 ià(
¡r
è
	`¥rštf
(¡r,"%d",
™em
->
v®uešt
);

166 ià(
p
è
¡r
=
	`’su»
(p,64);

167 
¡r
=(*)
	`cJSON_m®loc
(64);

168 ià(
¡r
)

170 ià(
	`çbs
(
	`æoÜ
(
d
)-d)<=
DBL_EPSILON
 && fabs(d)<1.0e60)
	`¥rštf
(
¡r
,"%.0f",d);

171 ià(
	`çbs
(
d
)<1.0e-6 || fabs(d)>1.0e9è
	`¥rštf
(
¡r
,"%e",d);

172 
	`¥rštf
(
¡r
,"%f",
d
);

175  
¡r
;

176 
	}
}

178 
	$·r£_hex4
(cÚ¡ *
¡r
)

180 
h
=0;

181 ià(*
¡r
>='0' && *¡r<='9'è
h
+=(*str)-'0'; if (*str>='A' && *str<='F') h+=10+(*str)-'A'; if (*str>='a' && *str<='f') h+=10+(*str)-'a';  0;

182 
h
=h<<4;
¡r
++;

183 ià(*
¡r
>='0' && *¡r<='9'è
h
+=(*str)-'0'; if (*str>='A' && *str<='F') h+=10+(*str)-'A'; if (*str>='a' && *str<='f') h+=10+(*str)-'a';  0;

184 
h
=h<<4;
¡r
++;

185 ià(*
¡r
>='0' && *¡r<='9'è
h
+=(*str)-'0'; if (*str>='A' && *str<='F') h+=10+(*str)-'A'; if (*str>='a' && *str<='f') h+=10+(*str)-'a';  0;

186 
h
=h<<4;
¡r
++;

187 ià(*
¡r
>='0' && *¡r<='9'è
h
+=(*str)-'0'; if (*str>='A' && *str<='F') h+=10+(*str)-'A'; if (*str>='a' && *str<='f') h+=10+(*str)-'a';  0;

188  
h
;

189 
	}
}

192 cÚ¡ 
	gfœ¡By‹M¬k
[7] = { 0x00, 0x00, 0xC0, 0xE0, 0xF0, 0xF8, 0xFC };

193 cÚ¡ *
	$·r£_¡ršg
(
cJSON
 *
™em
,cÚ¡ *
¡r
)

195 cÚ¡ *
±r
=
¡r
+1;*
±r2
;*
out
;
Ën
=0;
uc
,
uc2
;

196 ià(*
¡r
!='\"'è{
•
=str; 0;}

198 *
±r
!='\"' && *±¸&& ++
Ën
) if (*ptr++ == '\\')…tr++;

200 
out
=(*)
	`cJSON_m®loc
(
Ën
+1);

201 ià(!
out
)  0;

203 
±r
=
¡r
+1;
±r2
=
out
;

204 *
±r
!='\"' && *ptr)

206 ià(*
±r
!='\\'è*
±r2
++=*ptr++;

209 
±r
++;

210 *
±r
)

212 'b': *
±r2
++='\b'; ;

213 'f': *
±r2
++='\f'; ;

214 'n': *
±r2
++='\n'; ;

215 'r': *
±r2
++='\r'; ;

216 't': *
±r2
++='\t'; ;

218 
uc
=
	`·r£_hex4
(
±r
+1);ptr+=4;

220 ià((
uc
>=0xDC00 && uc<=0xDFFF) || uc==0) ;

222 ià(
uc
>=0xD800 && uc<=0xDBFF)

224 ià(
±r
[1]!='\\' ||…tr[2]!='u') ;

225 
uc2
=
	`·r£_hex4
(
±r
+3);ptr+=6;

226 ià(
uc2
<0xDC00 || uc2>0xDFFF) ;

227 
uc
=0x10000 + (((uc&0x3FF)<<10è| (
uc2
&0x3FF));

230 
Ën
=4;ià(
uc
<0x80èËn=1;ià(uc<0x800èËn=2;ià(uc<0x10000èËn=3; 
±r2
+=len;

232 
Ën
) {

233 4: *--
±r2
 =((
uc
 | 0x80) & 0xBF); uc >>= 6;

234 3: *--
±r2
 =((
uc
 | 0x80) & 0xBF); uc >>= 6;

235 2: *--
±r2
 =((
uc
 | 0x80) & 0xBF); uc >>= 6;

236 1: *--
±r2
 =(
uc
 | 
fœ¡By‹M¬k
[
Ën
]);

238 
±r2
+=
Ën
;

240 : *
±r2
++=*
±r
; ;

242 
±r
++;

245 *
±r2
=0;

246 ià(*
±r
=='\"')…tr++;

247 
™em
->
v®ue¡ršg
=
out
;

248 
™em
->
ty³
=
cJSON_SŒšg
;

249  
±r
;

250 
	}
}

253 *
	$´št_¡ršg_±r
(cÚ¡ *
¡r
,
´štbufãr
 *
p
)

255 cÚ¡ *
±r
;*
±r2
,*
out
;
Ën
=0,
æag
=0;
tok’
;

257 
±r
=
¡r
;*±r;±r++è
æag
|=((*ptr>0 && *ptr<32)||(*ptr=='\"')||(*ptr=='\\'))?1:0;

258 ià(!
æag
)

260 
Ën
=
±r
-
¡r
;

261 ià(
p
è
out
=
	`’su»
Õ,
Ën
+3);

262 
out
=(*)
	`cJSON_m®loc
(
Ën
+3);

263 ià(!
out
)  0;

264 
±r2
=
out
;*ptr2++='\"';

265 
	`¡rıy
(
±r2
,
¡r
);

266 
±r2
[
Ën
]='\"';

267 
±r2
[
Ën
+1]=0;

268  
out
;

271 ià(!
¡r
)

273 ià(
p
è
out
=
	`’su»
(p,3);

274 
out
=(*)
	`cJSON_m®loc
(3);

275 ià(!
out
)  0;

276 
	`¡rıy
(
out
,"\"\"");

277  
out
;

279 
±r
=
¡r
;(
tok’
=*±rè&& ++
Ën
è{ià(
	`¡rchr
("\"\\\b\f\n\r\t",token))†en++; if (token<32)†en+=5;ptr++;}

281 ià(
p
è
out
=
	`’su»
Õ,
Ën
+3);

282 
out
=(*)
	`cJSON_m®loc
(
Ën
+3);

283 ià(!
out
)  0;

285 
±r2
=
out
;
±r
=
¡r
;

286 *
±r2
++='\"';

287 *
±r
)

289 ià(()*
±r
>31 && *±r!='\"' && *±r!='\\'è*
±r2
++=*ptr++;

292 *
±r2
++='\\';

293 
tok’
=*
±r
++)

295 '\\': *
±r2
++='\\'; ;

296 '\"': *
±r2
++='\"'; ;

297 '\b': *
±r2
++='b'; ;

298 '\f': *
±r2
++='f'; ;

299 '\n': *
±r2
++='n'; ;

300 '\r': *
±r2
++='r'; ;

301 '\t': *
±r2
++='t'; ;

302 : 
	`¥rštf
(
±r2
,"u%04x",
tok’
);ptr2+=5; ;

306 *
±r2
++='\"';*ptr2++=0;

307  
out
;

308 
	}
}

310 *
	$´št_¡ršg
(
cJSON
 *
™em
,
´štbufãr
 *
p
è{ 
	`´št_¡ršg_±r
(™em->
v®ue¡ršg
,p);
	}
}

313 cÚ¡ *
·r£_v®ue
(
cJSON
 *
™em
,cÚ¡ *
v®ue
);

314 *
´št_v®ue
(
cJSON
 *
™em
,
d•th
,
fmt
,
´štbufãr
 *
p
);

315 cÚ¡ *
·r£_¬¿y
(
cJSON
 *
™em
,cÚ¡ *
v®ue
);

316 *
´št_¬¿y
(
cJSON
 *
™em
,
d•th
,
fmt
,
´štbufãr
 *
p
);

317 cÚ¡ *
·r£_objeù
(
cJSON
 *
™em
,cÚ¡ *
v®ue
);

318 *
´št_objeù
(
cJSON
 *
™em
,
d•th
,
fmt
,
´štbufãr
 *
p
);

321 cÚ¡ *
	$sk
(cÚ¡ *
š
è{š && *š && ()*š<=32èš++;  in;
	}
}

324 
cJSON
 *
	$cJSON_P¬£W™hO±s
(cÚ¡ *
v®ue
,cÚ¡ **
»tuº_·r£_’d
,
»quœe_nuÎ_‹rmš©ed
)

326 cÚ¡ *
’d
=0;

327 
cJSON
 *
c
=
	`cJSON_New_I‹m
();

328 
•
=0;

329 ià(!
c
)  0;

331 
’d
=
	`·r£_v®ue
(
c
,
	`sk
(
v®ue
));

332 ià(!
’d
è{
	`cJSON_D–‘e
(
c
); 0;}

335 ià(
»quœe_nuÎ_‹rmš©ed
è{
’d
=
	`sk
Ónd);ià(*’dè{
	`cJSON_D–‘e
(
c
);
•
=end; 0;}}

336 ià(
»tuº_·r£_’d
è*»tuº_·r£_’d=
’d
;

337  
c
;

338 
	}
}

340 
cJSON
 *
	$cJSON_P¬£
(cÚ¡ *
v®ue
è{ 
	`cJSON_P¬£W™hO±s
(v®ue,0,0);
	}
}

343 *
	$cJSON_Pršt
(
cJSON
 *
™em
è{ 
	`´št_v®ue
(™em,0,1,0);
	}
}

344 *
	$cJSON_PrštUnfÜm©‹d
(
cJSON
 *
™em
è{ 
	`´št_v®ue
(™em,0,0,0);
	}
}

346 *
	$cJSON_PrštBufã»d
(
cJSON
 *
™em
,
´ebufãr
,
fmt
)

348 
´štbufãr
 
p
;

349 
p
.
bufãr
=(*)
	`cJSON_m®loc
(
´ebufãr
);

350 
p
.
Ëngth
=
´ebufãr
;

351 
p
.
off£t
=0;

352  
	`´št_v®ue
(
™em
,0,
fmt
,&
p
);

353  
p
.
bufãr
;

354 
	}
}

358 cÚ¡ *
	$·r£_v®ue
(
cJSON
 *
™em
,cÚ¡ *
v®ue
)

360 ià(!
v®ue
)  0;

361 ià(!
	`¡ºcmp
(
v®ue
,"nuÎ",4)è{ 
™em
->
ty³
=
cJSON_NULL
;  value+4; }

362 ià(!
	`¡ºcmp
(
v®ue
,"çl£",5)è{ 
™em
->
ty³
=
cJSON_F®£
;  value+5; }

363 ià(!
	`¡ºcmp
(
v®ue
,"Œue",4)è{ 
™em
->
ty³
=
cJSON_True
; i‹m->
v®uešt
=1;  value+4; }

364 ià(*
v®ue
=='\"'è{  
	`·r£_¡ršg
(
™em
,value); }

365 ià(*
v®ue
=='-' || (*v®ue>='0' && *v®ue<='9')è{  
	`·r£_numb”
(
™em
,value); }

366 ià(*
v®ue
=='['è{  
	`·r£_¬¿y
(
™em
,value); }

367 ià(*
v®ue
=='{'è{  
	`·r£_objeù
(
™em
,value); }

369 
•
=
v®ue
; 0;

370 
	}
}

373 *
	$´št_v®ue
(
cJSON
 *
™em
,
d•th
,
fmt
,
´štbufãr
 *
p
)

375 *
out
=0;

376 ià(!
™em
)  0;

377 ià(
p
)

379 (
™em
->
ty³
)&255)

381 
cJSON_NULL
: {
out
=
	`’su»
(
p
,5); ià(outè
	`¡rıy
(out,"null"); ;}

382 
cJSON_F®£
: {
out
=
	`’su»
(
p
,6); ià(outè
	`¡rıy
(out,"false"); ;}

383 
cJSON_True
: {
out
=
	`’su»
(
p
,5); ià(outè
	`¡rıy
(out,"true"); ;}

384 
cJSON_Numb”
: 
out
=
	`´št_numb”
(
™em
,
p
);;

385 
cJSON_SŒšg
: 
out
=
	`´št_¡ršg
(
™em
,
p
);;

386 
cJSON_A¼ay
: 
out
=
	`´št_¬¿y
(
™em
,
d•th
,
fmt
,
p
);;

387 
cJSON_Objeù
: 
out
=
	`´št_objeù
(
™em
,
d•th
,
fmt
,
p
);;

392 (
™em
->
ty³
)&255)

394 
cJSON_NULL
: 
out
=
	`cJSON_¡rdup
("null"); ;

395 
cJSON_F®£
: 
out
=
	`cJSON_¡rdup
("false");;

396 
cJSON_True
: 
out
=
	`cJSON_¡rdup
("true"); ;

397 
cJSON_Numb”
: 
out
=
	`´št_numb”
(
™em
,0);;

398 
cJSON_SŒšg
: 
out
=
	`´št_¡ršg
(
™em
,0);;

399 
cJSON_A¼ay
: 
out
=
	`´št_¬¿y
(
™em
,
d•th
,
fmt
,0);;

400 
cJSON_Objeù
: 
out
=
	`´št_objeù
(
™em
,
d•th
,
fmt
,0);;

403  
out
;

404 
	}
}

407 cÚ¡ *
	$·r£_¬¿y
(
cJSON
 *
™em
,cÚ¡ *
v®ue
)

409 
cJSON
 *
chd
;

410 ià(*
v®ue
!='['è{
•
=value; 0;}

412 
™em
->
ty³
=
cJSON_A¼ay
;

413 
v®ue
=
	`sk
(value+1);

414 ià(*
v®ue
==']')  value+1;

416 
™em
->
chd
=chd=
	`cJSON_New_I‹m
();

417 ià(!
™em
->
chd
)  0;

418 
v®ue
=
	`sk
(
	`·r£_v®ue
(
chd
,skip(value)));

419 ià(!
v®ue
)  0;

421 *
v®ue
==',')

423 
cJSON
 *
Ãw_™em
;

424 ià(!(
Ãw_™em
=
	`cJSON_New_I‹m
()))  0;

425 
chd
->
Ãxt
=
Ãw_™em
;Ãw_™em->
´ev
=child;child=new_item;

426 
v®ue
=
	`sk
(
	`·r£_v®ue
(
chd
,skip(value+1)));

427 ià(!
v®ue
)  0;

430 ià(*
v®ue
==']')  value+1;

431 
•
=
v®ue
; 0;

432 
	}
}

435 *
	$´št_¬¿y
(
cJSON
 *
™em
,
d•th
,
fmt
,
´štbufãr
 *
p
)

437 **
’Œ›s
;

438 *
out
=0,*
±r
,*
»t
;
Ën
=5;

439 
cJSON
 *
chd
=
™em
->child;

440 
num’Œ›s
=0,
i
=0,
ç
=0;

441 
size_t
 
tm¶’
=0;

444 
chd
è
num’Œ›s
++,chd=chd->
Ãxt
;

446 ià(!
num’Œ›s
)

448 ià(
p
è
out
=
	`’su»
(p,3);

449 
out
=(*)
	`cJSON_m®loc
(3);

450 ià(
out
è
	`¡rıy
(out,"[]");

451  
out
;

454 ià(
p
)

457 
i
=
p
->
off£t
;

458 
±r
=
	`’su»
(
p
,1);ià(!±rè 0; *±r='[';…->
off£t
++;

459 
chd
=
™em
->child;

460 
chd
 && !
ç
)

462 
	`´št_v®ue
(
chd
,
d•th
+1,
fmt
,
p
);

463 
p
->
off£t
=
	`upd©e
(p);

464 ià(
chd
->
Ãxt
è{
Ën
=
fmt
?2:1;
±r
=
	`’su»
(
p
,Ën+1);ià(!±rè 0;*±r++=',';if(fmt)*±r++=' ';*±r=0;p->
off£t
+=len;}

465 
chd
=chd->
Ãxt
;

467 
±r
=
	`’su»
(
p
,2);if (!ptr)  0; *ptr++=']';*ptr=0;

468 
out
=(
p
->
bufãr
)+
i
;

473 
’Œ›s
=(**)
	`cJSON_m®loc
(
num’Œ›s
*(*));

474 ià(!
’Œ›s
)  0;

475 
	`mem£t
(
’Œ›s
,0,
num’Œ›s
*(*));

477 
chd
=
™em
->child;

478 
chd
 && !
ç
)

480 
»t
=
	`´št_v®ue
(
chd
,
d•th
+1,
fmt
,0);

481 
’Œ›s
[
i
++]=
»t
;

482 ià(
»t
è
Ën
+=
	`¡¾’
Ô‘)+2+(
fmt
?1:0); 
ç
=1;

483 
chd
=chd->
Ãxt
;

487 ià(!
ç
è
out
=(*)
	`cJSON_m®loc
(
Ën
);

489 ià(!
out
è
ç
=1;

492 ià(
ç
)

494 
i
=0;i<
num’Œ›s
;i++èià(
’Œ›s
[i]è
	`cJSON_ä“
(entries[i]);

495 
	`cJSON_ä“
(
’Œ›s
);

500 *
out
='[';

501 
±r
=
out
+1;*ptr=0;

502 
i
=0;i<
num’Œ›s
;i++)

504 
tm¶’
=
	`¡¾’
(
’Œ›s
[
i
]);
	`memıy
(
±r
,entries[i],tmplen);ptr+=tmplen;

505 ià(
i
!=
num’Œ›s
-1è{*
±r
++=',';if(
fmt
)*ptr++=' ';*ptr=0;}

506 
	`cJSON_ä“
(
’Œ›s
[
i
]);

508 
	`cJSON_ä“
(
’Œ›s
);

509 *
±r
++=']';*ptr++=0;

511  
out
;

512 
	}
}

515 cÚ¡ *
	$·r£_objeù
(
cJSON
 *
™em
,cÚ¡ *
v®ue
)

517 
cJSON
 *
chd
;

518 ià(*
v®ue
!='{'è{
•
=value; 0;}

520 
™em
->
ty³
=
cJSON_Objeù
;

521 
v®ue
=
	`sk
(value+1);

522 ià(*
v®ue
=='}')  value+1;

524 
™em
->
chd
=chd=
	`cJSON_New_I‹m
();

525 ià(!
™em
->
chd
)  0;

526 
v®ue
=
	`sk
(
	`·r£_¡ršg
(
chd
,skip(value)));

527 ià(!
v®ue
)  0;

528 
chd
->
¡ršg
=chd->
v®ue¡ršg
;child->valuestring=0;

529 ià(*
v®ue
!=':'è{
•
=value; 0;}

530 
v®ue
=
	`sk
(
	`·r£_v®ue
(
chd
,skip(value+1)));

531 ià(!
v®ue
)  0;

533 *
v®ue
==',')

535 
cJSON
 *
Ãw_™em
;

536 ià(!(
Ãw_™em
=
	`cJSON_New_I‹m
()))  0;

537 
chd
->
Ãxt
=
Ãw_™em
;Ãw_™em->
´ev
=child;child=new_item;

538 
v®ue
=
	`sk
(
	`·r£_¡ršg
(
chd
,skip(value+1)));

539 ià(!
v®ue
)  0;

540 
chd
->
¡ršg
=chd->
v®ue¡ršg
;child->valuestring=0;

541 ià(*
v®ue
!=':'è{
•
=value; 0;}

542 
v®ue
=
	`sk
(
	`·r£_v®ue
(
chd
,skip(value+1)));

543 ià(!
v®ue
)  0;

546 ià(*
v®ue
=='}')  value+1;

547 
•
=
v®ue
; 0;

548 
	}
}

551 *
	$´št_objeù
(
cJSON
 *
™em
,
d•th
,
fmt
,
´štbufãr
 *
p
)

553 **
’Œ›s
=0,**
Çmes
=0;

554 *
out
=0,*
±r
,*
»t
,*
¡r
;
Ën
=7,
i
=0,
j
;

555 
cJSON
 *
chd
=
™em
->child;

556 
num’Œ›s
=0,
ç
=0;

557 
size_t
 
tm¶’
=0;

559 
chd
è
num’Œ›s
++,chd=chd->
Ãxt
;

561 ià(!
num’Œ›s
)

563 ià(
p
è
out
=
	`’su»
Õ,
fmt
?
d•th
+4:3);

564 
out
=(*)
	`cJSON_m®loc
(
fmt
?
d•th
+4:3);

565 ià(!
out
)  0;

566 
±r
=
out
;*ptr++='{';

567 ià(
fmt
è{*
±r
++='\n';
i
=0;i<
d•th
-1;i++) *ptr++='\t';}

568 *
±r
++='}';*ptr++=0;

569  
out
;

571 ià(
p
)

574 
i
=
p
->
off£t
;

575 
Ën
=
fmt
?2:1; 
±r
=
	`’su»
(
p
,len+1); if (!ptr)  0;

576 *
±r
++='{'; ià(
fmt
è*±r++='\n'; *±r=0; 
p
->
off£t
+=
Ën
;

577 
chd
=
™em
->chd;
d•th
++;

578 
chd
)

580 ià(
fmt
)

582 
±r
=
	`’su»
(
p
,
d•th
); if (!ptr)  0;

583 
j
=0;j<
d•th
;j++è*
±r
++='\t';

584 
p
->
off£t
+=
d•th
;

586 
	`´št_¡ršg_±r
(
chd
->
¡ršg
,
p
);

587 
p
->
off£t
=
	`upd©e
(p);

589 
Ën
=
fmt
?2:1;

590 
±r
=
	`’su»
(
p
,
Ën
); if (!ptr)  0;

591 *
±r
++=':';ià(
fmt
) *ptr++='\t';

592 
p
->
off£t
+=
Ën
;

594 
	`´št_v®ue
(
chd
,
d•th
,
fmt
,
p
);

595 
p
->
off£t
=
	`upd©e
(p);

597 
Ën
=(
fmt
?1:0)+(
chd
->
Ãxt
?1:0);

598 
±r
=
	`’su»
(
p
,
Ën
+1); if (!ptr)  0;

599 ià(
chd
->
Ãxt
è*
±r
++=',';

600 ià(
fmt
è*
±r
++='\n';*ptr=0;

601 
p
->
off£t
+=
Ën
;

602 
chd
=chd->
Ãxt
;

604 
±r
=
	`’su»
(
p
,
fmt
?(
d•th
+1):2); if (!ptr)  0;

605 ià(
fmt
è
i
=0;i<
d•th
-1;i++è*
±r
++='\t';

606 *
±r
++='}';*ptr=0;

607 
out
=(
p
->
bufãr
)+
i
;

612 
’Œ›s
=(**)
	`cJSON_m®loc
(
num’Œ›s
*(*));

613 ià(!
’Œ›s
)  0;

614 
Çmes
=(**)
	`cJSON_m®loc
(
num’Œ›s
*(*));

615 ià(!
Çmes
è{
	`cJSON_ä“
(
’Œ›s
); 0;}

616 
	`mem£t
(
’Œ›s
,0,(*)*
num’Œ›s
);

617 
	`mem£t
(
Çmes
,0,(*)*
num’Œ›s
);

620 
chd
=
™em
->chd;
d•th
++;ià(
fmt
è
Ën
+=depth;

621 
chd
)

623 
Çmes
[
i
]=
¡r
=
	`´št_¡ršg_±r
(
chd
->
¡ršg
,0);

624 
’Œ›s
[
i
++]=
»t
=
	`´št_v®ue
(
chd
,
d•th
,
fmt
,0);

625 ià(
¡r
 && 
»t
è
Ën
+=
	`¡¾’
Ô‘)+¡¾’(¡r)+2+(
fmt
?2+
d•th
:0); 
ç
=1;

626 
chd
=chd->
Ãxt
;

630 ià(!
ç
è
out
=(*)
	`cJSON_m®loc
(
Ën
);

631 ià(!
out
è
ç
=1;

634 ià(
ç
)

636 
i
=0;i<
num’Œ›s
;i++è{ià(
Çmes
[i]è
	`cJSON_ä“
Òames[i]);ià(
’Œ›s
[i]) cJSON_free(entries[i]);}

637 
	`cJSON_ä“
(
Çmes
);cJSON_ä“(
’Œ›s
);

642 *
out
='{';
±r
=out+1;ià(
fmt
)*ptr++='\n';*ptr=0;

643 
i
=0;i<
num’Œ›s
;i++)

645 ià(
fmt
è
j
=0;j<
d•th
;j++è*
±r
++='\t';

646 
tm¶’
=
	`¡¾’
(
Çmes
[
i
]);
	`memıy
(
±r
,names[i],tmplen);ptr+=tmplen;

647 *
±r
++=':';ià(
fmt
) *ptr++='\t';

648 
	`¡rıy
(
±r
,
’Œ›s
[
i
]);±r+=
	`¡¾’
(entries[i]);

649 ià(
i
!=
num’Œ›s
-1è*
±r
++=',';

650 ià(
fmt
è*
±r
++='\n';*ptr=0;

651 
	`cJSON_ä“
(
Çmes
[
i
]);cJSON_ä“(
’Œ›s
[i]);

654 
	`cJSON_ä“
(
Çmes
);cJSON_ä“(
’Œ›s
);

655 ià(
fmt
è
i
=0;i<
d•th
-1;i++è*
±r
++='\t';

656 *
±r
++='}';*ptr++=0;

658  
out
;

659 
	}
}

662 
	$cJSON_G‘A¼aySize
(
cJSON
 *
¬¿y
è{cJSON *
c
÷¼ay->
chd
;
i
=0;c)i++,c=c->
Ãxt
; i;
	}
}

663 
cJSON
 *
	$cJSON_G‘A¼ayI‹m
(
cJSON
 *
¬¿y
,
™em
è{cJSON *
c
÷¼ay->
chd
; ø&& i‹m>0è™em--,c=c->
Ãxt
;  c;
	}
}

664 
cJSON
 *
	$cJSON_G‘ObjeùI‹m
(
cJSON
 *
objeù
,cÚ¡ *
¡ršg
è{cJSON *
c
=objeù->
chd
; ø&& 
	`cJSON_¡rÿ£cmp
(c->¡ršg,¡ršg)èc=c->
Ãxt
;  c;
	}
}

667 
	$suffix_objeù
(
cJSON
 *
´ev
,cJSON *
™em
è{´ev->
Ãxt
=™em;™em->´evõ»v;
	}
}

669 
cJSON
 *
	$ü—‹_»ã»nû
(
cJSON
 *
™em
è{cJSON *
»f
=
	`cJSON_New_I‹m
();ià(!»fè 0;
	`memıy
Ôef,™em,(cJSON));»f->
¡ršg
=0;»f->
ty³
|=
cJSON_IsReã»nû
;»f->
Ãxt
ôef->
´ev
=0;„ef;
	}
}

672 
	$cJSON_AddI‹mToA¼ay
(
cJSON
 *
¬¿y
, cJSON *
™em
è{cJSON *
c
÷¼ay->
chd
;ià(!™emè; ià(!cè{¬¿y->chd=™em;} {ø&& c->
Ãxt
èc=c->Ãxt; 
	`suffix_objeù
(c,™em);}
	}
}

673 
	$cJSON_AddI‹mToObjeù
(
cJSON
 *
objeù
,cÚ¡ *
¡ršg
,cJSON *
™em
è{ià(!™emè; ià(™em->¡ršgè
	`cJSON_ä“
(™em->¡ršg);™em->¡ršg=
	`cJSON_¡rdup
(¡ršg);
	`cJSON_AddI‹mToA¼ay
(objeù,™em);
	}
}

674 
	$cJSON_AddI‹mToObjeùCS
(
cJSON
 *
objeù
,cÚ¡ *
¡ršg
,cJSON *
™em
è{ià(!™emè; ià(!(™em->
ty³
&
cJSON_SŒšgIsCÚ¡
è&& i‹m->¡ršgè
	`cJSON_ä“
(™em->¡ršg);™em->¡ršg=(*)¡ršg;™em->ty³|=cJSON_SŒšgIsCÚ¡;
	`cJSON_AddI‹mToA¼ay
(objeù,™em);
	}
}

675 
	$cJSON_AddI‹mReã»nûToA¼ay
(
cJSON
 *
¬¿y
, cJSON *
™em
è{
	`cJSON_AddI‹mToA¼ay
×¼ay,
	`ü—‹_»ã»nû
(™em));
	}
}

676 
	$cJSON_AddI‹mReã»nûToObjeù
(
cJSON
 *
objeù
,cÚ¡ *
¡ršg
,cJSON *
™em
è{
	`cJSON_AddI‹mToObjeù
(objeù,¡ršg,
	`ü—‹_»ã»nû
(™em));
	}
}

678 
cJSON
 *
	$cJSON_D‘achI‹mFromA¼ay
(
cJSON
 *
¬¿y
,
which
è{cJSON *
c
÷¼ay->
chd
;ø&& which>0èc=c->
Ãxt
,which--;if (!c)  0;

679 ià(
c
->
´ev
èc->´ev->
Ãxt
=c->Ãxt;ià(c->Ãxtèc->Ãxt->´ev=c->´ev;ià(c==
¬¿y
->
chd
è¬¿y->chd=c->Ãxt;c->´ev=c->Ãxt=0; c;
	}
}

680 
	$cJSON_D–‘eI‹mFromA¼ay
(
cJSON
 *
¬¿y
,
which
è{
	`cJSON_D–‘e
(
	`cJSON_D‘achI‹mFromA¼ay
×¼ay,which));
	}
}

681 
cJSON
 *
	$cJSON_D‘achI‹mFromObjeù
(
cJSON
 *
objeù
,cÚ¡ *
¡ršg
è{
i
=0;cJSON *
c
=objeù->
chd
;ø&& 
	`cJSON_¡rÿ£cmp
(c->¡ršg,¡ršg)èi++,c=c->
Ãxt
;ià(cè 
	`cJSON_D‘achI‹mFromA¼ay
(objeù,i); 0;
	}
}

682 
	$cJSON_D–‘eI‹mFromObjeù
(
cJSON
 *
objeù
,cÚ¡ *
¡ršg
è{
	`cJSON_D–‘e
(
	`cJSON_D‘achI‹mFromObjeù
(objeù,¡ršg));
	}
}

685 
	$cJSON_In£¹I‹mInA¼ay
(
cJSON
 *
¬¿y
,
which
,cJSON *
Ãw™em
è{cJSON *
c
÷¼ay->
chd
;ø&& which>0èc=c->
Ãxt
,which--;ià(!cè{
	`cJSON_AddI‹mToA¼ay
(array,newitem);;}

686 
Ãw™em
->
Ãxt
=
c
;Ãw™em->
´ev
=c->´ev;c->´evòew™em;ià(c==
¬¿y
->
chd
è¬¿y->chdòew™em; Ãw™em->´ev->Ãxtòew™em;
	}
}

687 
	$cJSON_R•ÏûI‹mInA¼ay
(
cJSON
 *
¬¿y
,
which
,cJSON *
Ãw™em
è{cJSON *
c
÷¼ay->
chd
;ø&& which>0èc=c->
Ãxt
,which--;if (!c) ;

688 
Ãw™em
->
Ãxt
=
c
->Ãxt;Ãw™em->
´ev
=c->prev;if (newitem->next)‚ewitem->next->prev=newitem;

689 ià(
c
==
¬¿y
->
chd
è¬¿y->chd=
Ãw™em
; Ãw™em->
´ev
->
Ãxt
òew™em;c->Ãxt=c->´ev=0;
	`cJSON_D–‘e
(c);
	}
}

690 
	$cJSON_R•ÏûI‹mInObjeù
(
cJSON
 *
objeù
,cÚ¡ *
¡ršg
,cJSON *
Ãw™em
){
i
=0;cJSON *
c
=objeù->
chd
;ø&& 
	`cJSON_¡rÿ£cmp
(c->¡ršg,¡ršg))i++,c=c->
Ãxt
;if(c){Ãw™em->¡ršg=
	`cJSON_¡rdup
(¡ršg);
	`cJSON_R•ÏûI‹mInA¼ay
(objeù,i,Ãw™em);}
	}
}

693 
cJSON
 *
	$cJSON_C»©eNuÎ
(è{
cJSON
 *
™em
=
	`cJSON_New_I‹m
();if(™em)™em->
ty³
=
cJSON_NULL
; i‹m;
	}
}

694 
cJSON
 *
	$cJSON_C»©eTrue
(è{
cJSON
 *
™em
=
	`cJSON_New_I‹m
();if(™em)™em->
ty³
=
cJSON_True
; i‹m;
	}
}

695 
cJSON
 *
	$cJSON_C»©eF®£
(è{
cJSON
 *
™em
=
	`cJSON_New_I‹m
();if(™em)™em->
ty³
=
cJSON_F®£
; i‹m;
	}
}

696 
cJSON
 *
	$cJSON_C»©eBoŞ
(
b
è{
cJSON
 *
™em
=
	`cJSON_New_I‹m
();if(™em)™em->
ty³
=b?
cJSON_True
:
cJSON_F®£
; i‹m;
	}
}

697 
cJSON
 *
	$cJSON_C»©eNumb”
(
num
è{
cJSON
 *
™em
=
	`cJSON_New_I‹m
();if(™em){™em->
ty³
=
cJSON_Numb”
;™em->
v®uedoubË
òum;™em->
v®uešt
=(êum;} i‹m;
	}
}

698 
cJSON
 *
	$cJSON_C»©eSŒšg
(cÚ¡ *
¡ršg
è{
cJSON
 *
™em
=
	`cJSON_New_I‹m
();if(™em){™em->
ty³
=
cJSON_SŒšg
;™em->
v®ue¡ršg
=
	`cJSON_¡rdup
(¡ršg);} i‹m;
	}
}

699 
cJSON
 *
	$cJSON_C»©eA¼ay
(è{
cJSON
 *
™em
=
	`cJSON_New_I‹m
();if(™em)™em->
ty³
=
cJSON_A¼ay
; i‹m;
	}
}

700 
cJSON
 *
	$cJSON_C»©eObjeù
(è{
cJSON
 *
™em
=
	`cJSON_New_I‹m
();if(™em)™em->
ty³
=
cJSON_Objeù
; i‹m;
	}
}

703 
cJSON
 *
	$cJSON_C»©eIÁA¼ay
(cÚ¡ *
numb”s
,
couÁ
è{
i
;
cJSON
 *
n
=0,*
p
=0,*
a
=
	`cJSON_C»©eA¼ay
();i=0;¨&& i<couÁ;i++){n=
	`cJSON_C»©eNumb”
Òumb”s[i]);if(!iï->
chd
ò;
	`suffix_objeù
Õ,n);pò;}‡;
	}
}

704 
cJSON
 *
	$cJSON_C»©eFlßtA¼ay
(cÚ¡ *
numb”s
,
couÁ
è{
i
;
cJSON
 *
n
=0,*
p
=0,*
a
=
	`cJSON_C»©eA¼ay
();i=0;¨&& i<couÁ;i++){n=
	`cJSON_C»©eNumb”
Òumb”s[i]);if(!iï->
chd
ò;
	`suffix_objeù
Õ,n);pò;}‡;
	}
}

705 
cJSON
 *
	$cJSON_C»©eDoubËA¼ay
(cÚ¡ *
numb”s
,
couÁ
è{
i
;
cJSON
 *
n
=0,*
p
=0,*
a
=
	`cJSON_C»©eA¼ay
();i=0;¨&& i<couÁ;i++){n=
	`cJSON_C»©eNumb”
Òumb”s[i]);if(!iï->
chd
ò;
	`suffix_objeù
Õ,n);pò;}‡;
	}
}

706 
cJSON
 *
	$cJSON_C»©eSŒšgA¼ay
(cÚ¡ **
¡ršgs
,
couÁ
è{
i
;
cJSON
 *
n
=0,*
p
=0,*
a
=
	`cJSON_C»©eA¼ay
();i=0;¨&& i<couÁ;i++){n=
	`cJSON_C»©eSŒšg
(¡ršgs[i]);if(!iï->
chd
ò;
	`suffix_objeù
Õ,n);pò;}‡;
	}
}

709 
cJSON
 *
	$cJSON_Du¶iÿ‹
(
cJSON
 *
™em
,
»cur£
)

711 
cJSON
 *
Ãw™em
,*
ıŒ
,*
ÅŒ
=0,*
Ãwchd
;

713 ià(!
™em
)  0;

715 
Ãw™em
=
	`cJSON_New_I‹m
();

716 ià(!
Ãw™em
)  0;

718 
Ãw™em
->
ty³
=
™em
->ty³&(~
cJSON_IsReã»nû
),Ãw™em->
v®uešt
=™em->v®uešt,Ãw™em->
v®uedoubË
=item->valuedouble;

719 ià(
™em
->
v®ue¡ršg
è{
Ãw™em
->v®ue¡ršg=
	`cJSON_¡rdup
(™em->v®ue¡ršg); ià(!Ãw™em->v®ue¡ršgè{
	`cJSON_D–‘e
(newitem); 0;}}

720 ià(
™em
->
¡ršg
è{
Ãw™em
->¡ršg=
	`cJSON_¡rdup
(™em->¡ršg); ià(!Ãw™em->¡ršgè{
	`cJSON_D–‘e
(newitem); 0;}}

722 ià(!
»cur£
è 
Ãw™em
;

724 
ıŒ
=
™em
->
chd
;

725 
ıŒ
)

727 
Ãwchd
=
	`cJSON_Du¶iÿ‹
(
ıŒ
,1);

728 ià(!
Ãwchd
è{
	`cJSON_D–‘e
(
Ãw™em
); 0;}

729 ià(
ÅŒ
è{ÅŒ->
Ãxt
=
Ãwchd
,Ãwchd->
´ev
=nptr;nptr=newchild;}

730 {
Ãw™em
->
chd
=
Ãwchd
;
ÅŒ
=newchild;}

731 
ıŒ
=ıŒ->
Ãxt
;

733  
Ãw™em
;

734 
	}
}

736 
	$cJSON_Mšify
(*
jsÚ
)

738 *
što
=
jsÚ
;

739 *
jsÚ
)

741 ià(*
jsÚ
==' ') json++;

742 ià(*
jsÚ
=='\t') json++;

743 ià(*
jsÚ
=='\r') json++;

744 ià(*
jsÚ
=='\n') json++;

745 ià(*
jsÚ
=='/' && json[1]=='/') *json && *json!='\n') json++;

746 ià(*
jsÚ
=='/' && json[1]=='*') {*json && !(*json=='*' && json[1]=='/')) json++;json+=2;}

747 ià(*
jsÚ
=='\"'){*
što
++=*json++;*json && *json!='\"'){if (*json=='\\') *into++=*json++;*into++=*json++;}*into++=*json++;}

748 *
što
++=*
jsÚ
++;

750 *
što
=0;

751 
	}
}

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/cJSON.h

23 #iâdeà
cJSON__h


24 
	#cJSON__h


	)

26 #ifdeà
__ılu¥lus


32 
	#cJSON_F®£
 0

	)

33 
	#cJSON_True
 1

	)

34 
	#cJSON_NULL
 2

	)

35 
	#cJSON_Numb”
 3

	)

36 
	#cJSON_SŒšg
 4

	)

37 
	#cJSON_A¼ay
 5

	)

38 
	#cJSON_Objeù
 6

	)

40 
	#cJSON_IsReã»nû
 256

	)

41 
	#cJSON_SŒšgIsCÚ¡
 512

	)

44 
	scJSON
 {

45 
cJSON
 *
Ãxt
,*
´ev
;

46 
cJSON
 *
chd
;

48 
ty³
;

50 *
v®ue¡ršg
;

51 
v®uešt
;

52 
v®uedoubË
;

54 *
¡ršg
;

55 } 
	tcJSON
;

57 
	scJSON_Hooks
 {

58 *(*
m®loc_â
)(
size_t
 
sz
);

59 (*
ä“_â
)(*
±r
);

60 } 
	tcJSON_Hooks
;

63 
cJSON_In™Hooks
(
cJSON_Hooks
* 
hooks
);

67 
cJSON
 *
cJSON_P¬£
(cÚ¡ *
v®ue
);

69 *
cJSON_Pršt
(
cJSON
 *
™em
);

71 *
cJSON_PrštUnfÜm©‹d
(
cJSON
 *
™em
);

73 *
cJSON_PrštBufã»d
(
cJSON
 *
™em
,
´ebufãr
,
fmt
);

75 
cJSON_D–‘e
(
cJSON
 *
c
);

78 
cJSON_G‘A¼aySize
(
cJSON
 *
¬¿y
);

80 
cJSON
 *
cJSON_G‘A¼ayI‹m
(cJSON *
¬¿y
,
™em
);

82 
cJSON
 *
cJSON_G‘ObjeùI‹m
(cJSON *
objeù
,cÚ¡ *
¡ršg
);

85 cÚ¡ *
cJSON_G‘E¼ÜPŒ
();

88 
cJSON
 *
cJSON_C»©eNuÎ
();

89 
cJSON
 *
cJSON_C»©eTrue
();

90 
cJSON
 *
cJSON_C»©eF®£
();

91 
cJSON
 *
cJSON_C»©eBoŞ
(
b
);

92 
cJSON
 *
cJSON_C»©eNumb”
(
num
);

93 
cJSON
 *
cJSON_C»©eSŒšg
(cÚ¡ *
¡ršg
);

94 
cJSON
 *
cJSON_C»©eA¼ay
();

95 
cJSON
 *
cJSON_C»©eObjeù
();

98 
cJSON
 *
cJSON_C»©eIÁA¼ay
(cÚ¡ *
numb”s
,
couÁ
);

99 
cJSON
 *
cJSON_C»©eFlßtA¼ay
(cÚ¡ *
numb”s
,
couÁ
);

100 
cJSON
 *
cJSON_C»©eDoubËA¼ay
(cÚ¡ *
numb”s
,
couÁ
);

101 
cJSON
 *
cJSON_C»©eSŒšgA¼ay
(cÚ¡ **
¡ršgs
,
couÁ
);

104 
cJSON_AddI‹mToA¼ay
(
cJSON
 *
¬¿y
, cJSON *
™em
);

105 
cJSON_AddI‹mToObjeù
(
cJSON
 *
objeù
,cÚ¡ *
¡ršg
,cJSON *
™em
);

106 
cJSON_AddI‹mToObjeùCS
(
cJSON
 *
objeù
,cÚ¡ *
¡ršg
,cJSON *
™em
);

108 
cJSON_AddI‹mReã»nûToA¼ay
(
cJSON
 *
¬¿y
, cJSON *
™em
);

109 
cJSON_AddI‹mReã»nûToObjeù
(
cJSON
 *
objeù
,cÚ¡ *
¡ršg
,cJSON *
™em
);

112 
cJSON
 *
cJSON_D‘achI‹mFromA¼ay
(cJSON *
¬¿y
,
which
);

113 
cJSON_D–‘eI‹mFromA¼ay
(
cJSON
 *
¬¿y
,
which
);

114 
cJSON
 *
cJSON_D‘achI‹mFromObjeù
(cJSON *
objeù
,cÚ¡ *
¡ršg
);

115 
cJSON_D–‘eI‹mFromObjeù
(
cJSON
 *
objeù
,cÚ¡ *
¡ršg
);

118 
cJSON_In£¹I‹mInA¼ay
(
cJSON
 *
¬¿y
,
which
,cJSON *
Ãw™em
);

119 
cJSON_R•ÏûI‹mInA¼ay
(
cJSON
 *
¬¿y
,
which
,cJSON *
Ãw™em
);

120 
cJSON_R•ÏûI‹mInObjeù
(
cJSON
 *
objeù
,cÚ¡ *
¡ršg
,cJSON *
Ãw™em
);

123 
cJSON
 *
cJSON_Du¶iÿ‹
(cJSON *
™em
,
»cur£
);

129 
cJSON
 *
cJSON_P¬£W™hO±s
(cÚ¡ *
v®ue
,cÚ¡ **
»tuº_·r£_’d
,
»quœe_nuÎ_‹rmš©ed
);

131 
cJSON_Mšify
(*
jsÚ
);

134 
	#cJSON_AddNuÎToObjeù
(
objeù
,
Çme
è
	`cJSON_AddI‹mToObjeù
(objeù,‚ame, 
	`cJSON_C»©eNuÎ
())

	)

135 
	#cJSON_AddTrueToObjeù
(
objeù
,
Çme
è
	`cJSON_AddI‹mToObjeù
(objeù,‚ame, 
	`cJSON_C»©eTrue
())

	)

136 
	#cJSON_AddF®£ToObjeù
(
objeù
,
Çme
è
	`cJSON_AddI‹mToObjeù
(objeù,‚ame, 
	`cJSON_C»©eF®£
())

	)

137 
	#cJSON_AddBoŞToObjeù
(
objeù
,
Çme
,
b
è
	`cJSON_AddI‹mToObjeù
(objeù,‚ame, 
	`cJSON_C»©eBoŞ
(b))

	)

138 
	#cJSON_AddNumb”ToObjeù
(
objeù
,
Çme
,
n
è
	`cJSON_AddI‹mToObjeù
(objeù,‚ame, 
	`cJSON_C»©eNumb”
Ò))

	)

139 
	#cJSON_AddSŒšgToObjeù
(
objeù
,
Çme
,
s
è
	`cJSON_AddI‹mToObjeù
(objeù,‚ame, 
	`cJSON_C»©eSŒšg
(s))

	)

142 
	#cJSON_S‘IÁV®ue
(
objeù
,
v®
è((objeù)?(objeù)->
v®uešt
=(objeù)->
v®uedoubË
=(v®):(v®))

	)

143 
	#cJSON_S‘Numb”V®ue
(
objeù
,
v®
è((objeù)?(objeù)->
v®uešt
=(objeù)->
v®uedoubË
=(v®):(v®))

	)

145 #ifdeà
__ılu¥lus


	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/cloudc_log.c

1 
	~<sys/ty³s.h
>

2 
	~<sys/¡©.h
>

3 
	~<fú.h
>

4 
	~<¡ršg.h
>

5 
	~<¡dio.h
>

6 
	~<¡d¬g.h
>

7 
	~"şoudc_log.h
"

9 
	gşoudc_log_Ëv–_št
 = 
LOG_LEVEL_DEBUG
 ;

10 
	$log_log
(
LOG_LEVEL
 
log_Ëv–
, cÚ¡ *
func
, 
lše_num
, cÚ¡ *
p_fmt
, ... )

12 *
log_Ëv–_ch_±r
 = 
NULL
;

13 
Ën
 = 0;

14 
buf
[
MAX_LOG_LINE_LENGTH
] = {0};

15 
va_li¡
 
­
;

17 
log_Ëv–
)

19 
LOG_LEVEL_ERR
:

20 
log_Ëv–_ch_±r
 = "Error ";

23 
LOG_LEVEL_DEBUG
:

24 
log_Ëv–_ch_±r
 = "Debug ";

28 
log_Ëv–_ch_±r
 = "Invalid†og†evel ";

29 
	`¢´štf
(
buf
, 
MAX_LOG_LINE_LENGTH
, "%s", 
log_Ëv–_ch_±r
);

32 iàĞ
log_Ëv–
 <ğ
şoudc_log_Ëv–_št
)

34 
log_fd
 = 
	`İ’
("/dev/cÚsŞe", 
O_RDWR
);

36 iàĞ-1 !ğ
log_fd
)

38 
	`va_¡¬t
(
­
, 
p_fmt
);

39 
	`v¢´štf
(&(
buf
[
	`¡¾’
(buf)]), 
MAX_LOG_LINE_LENGTH
, 
p_fmt
, 
­
);

40 
	`wr™e
(
log_fd
, 
buf
, 
	`¡¾’
(buf));

41 
	`wr™e
(
log_fd
, "\n", 
	`¡¾’
("\n"));

42 
	`va_’d
(
­
);

43 
	`şo£
(
log_fd
);

48 
	}
}

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/cloudc_log.h

1 
	#LOG_EMERG
 0

	)

2 
	#LOG_ALERT
 1

	)

3 
	#LOG_CRIT
 2

	)

4 
	#LOG_ERR
 3

	)

5 
	#LOG_WARNING
 4

	)

6 
	#LOG_NOTICE
 5

	)

7 
	#LOG_INFO
 6

	)

8 
	#LOG_DEBUG
 7

	)

12 
	#şoudc_”rÜ
(
¬gs
...è
	`log_log
(
LOG_ERR
, 
__FUNCTION__
, 
__LINE__
,‡rgs)

	)

13 
	#şoudc_debug
(
¬gs
...è
	`log_log
(
LOG_DEBUG
, 
__FUNCTION__
, 
__LINE__
,‡rgs)

	)

15 
	#MAX_LOG_LINE_LENGTH
 512

	)

19 
	mLOG_LEVEL_ERR
 = 3,

20 
	mLOG_LEVEL_DEBUG
 = 7

21 } 
	tLOG_LEVEL
;

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/common/NotificationReceiverTestImpl.cc

17 
	~"NÙifiÿtiÚReûiv”Te¡Im¶.h
"

18 
	~<®ljoyn/nÙifiÿtiÚ/NÙifiÿtiÚText.h
>

19 
	~<®ljoyn/nÙifiÿtiÚ/RichAudioU¾.h
>

20 
	~<®ljoyn/Stus.h
>

21 
	~<io¡»am
>

22 
	~<®gÜ™hm
>

23 
	~<s¡»am
>

24 #ifdeà
_WIN32


25 
	~<´oûss.h
>

30 
şoudc_·r£_®ljoyn_nÙifiÿtiÚ
(cÚ¡ *
jsÚ_buf
);

33 
usšg
 
Çme¥aû
 
ajn
;

34 
usšg
 
Çme¥aû
 
	g£rviûs
;

35 
usšg
 
Çme¥aû
 
	gqcc
;

37 
	gNÙifiÿtiÚReûiv”Te¡Im¶
::
	$NÙifiÿtiÚReûiv”Te¡Im¶
(
boŞ
 
wa™FÜEx‹º®NÙifiÿtiÚAùiÚ
) :

38 
	`m_NÙifiÿtiÚAùiÚ
(
ACTION_NOTHING
), 
	$m_Wa™FÜEx‹º®NÙifiÿtiÚAùiÚ
(
wa™FÜEx‹º®NÙifiÿtiÚAùiÚ
) {

40 ià(
m_Wa™FÜEx‹º®NÙifiÿtiÚAùiÚ
) {

41 #ifdeà
_WIN32


42 
	`In™ŸlizeCr™iÿlSeùiÚ
(&
m_Lock
);

43 
	`In™ŸlizeCÚd™iÚV¬ŸbË
(&
m_CÚd™iÚ
);

45 
	`±h»ad_mu‹x_š™
(&
m_Lock
, 
NULL
);

46 
	`±h»ad_cÚd_š™
(&
m_CÚd™iÚ
, 
NULL
);

49 
	}
}

51 
	gNÙifiÿtiÚReûiv”Te¡Im¶
::~
	$NÙifiÿtiÚReûiv”Te¡Im¶
() {

53 ià(
m_Wa™FÜEx‹º®NÙifiÿtiÚAùiÚ
) {

54 #ifdeà
_WIN32


55 
	`EÁ”Cr™iÿlSeùiÚ
(&
m_Lock
);

56 
	`WakeCÚd™iÚV¬ŸbË
(&
m_CÚd™iÚ
);

57 
	`L—veCr™iÿlSeùiÚ
(&
m_Lock
);

58 
	`D–‘eCr™iÿlSeùiÚ
(&
m_Lock
);

60 
	`±h»ad_mu‹x_lock
(&
m_Lock
);

61 
	`±h»ad_cÚd_sigÇl
(&
m_CÚd™iÚ
);

62 
	`±h»ad_mu‹x_uÆock
(&
m_Lock
);

63 
	`±h»ad_cÚd_de¡roy
(&
m_CÚd™iÚ
);

64 
	`±h»ad_mu‹x_de¡roy
(&
m_Lock
);

67 
	}
}

69 
	gNÙifiÿtiÚReûiv”Te¡Im¶
::
	$Reûive
(
NÙifiÿtiÚ
 cÚ¡& 
nÙifiÿtiÚ
) {

71 
qcc
::
SŒšg
 
­pName
 = 
nÙifiÿtiÚ
.
	`g‘AµName
();

73 ià((
m_AµliÿtiÚs
.
	`size
(è=ğ0è|| (
	`fšd
(m_AµliÿtiÚs.
	`begš
(), m_AµliÿtiÚs.
	`’d
(), 
­pName
) != m_Applications.end())) {

74 
¡d
::
cout
 << "******************** Begš New Mes§gReûived ********************" << std::
’dl
;

75 
¡d
::
cout
 << "Mes§gId: " << 
nÙifiÿtiÚ
.
	`g‘Mes§geId
(è<< std::
’dl
;

76 
¡d
::
cout
 << "Deviû Id: " << 
nÙifiÿtiÚ
.
	`g‘DeviûId
(è<< std::
’dl
;

77 
¡d
::
cout
 << "Deviû Name: " << 
nÙifiÿtiÚ
.
	`g‘DeviûName
(è<< std::
’dl
;

78 
¡d
::
cout
 << "Aµ Id: " << 
nÙifiÿtiÚ
.
	`g‘AµId
(è<< std::
’dl
;

79 
¡d
::
cout
 << "Aµ Name: " << 
nÙifiÿtiÚ
.
	`g‘AµName
(è<< std::
’dl
;

80 
¡d
::
cout
 << "S’d” BusName: " << 
nÙifiÿtiÚ
.
	`g‘S’d”BusName
(è<< std::
’dl
;

81 
¡d
::
cout
 << "Mes§gTy³ " << 
nÙifiÿtiÚ
.
	`g‘Mes§geTy³
(è<< " " << 
Mes§geTy³Ut
::
	`g‘Mes§geTy³SŒšg
ÒÙifiÿtiÚ.g‘Mes§geTy³()).
	`c_¡r
(è<< std::
’dl
;

82 
¡d
::
cout
 << "NÙifiÿtiÚ v”siÚ: " << 
nÙifiÿtiÚ
.
	`g‘V”siÚ
(è<< std::
’dl
;

86 
¡d
::
veùÜ
<
NÙifiÿtiÚText
> 
vecMes§ges
 = 
nÙifiÿtiÚ
.
	`g‘Text
();

88 
¡d
::
veùÜ
<
NÙifiÿtiÚText
>::
cÚ¡_™”©Ü
 
vecMes§ge_™
 = 
vecMes§ges
.
	`begš
(); vecMes§ge_™ !ğvecMes§ges.
	`’d
(); ++vecMessage_it) {

89 
¡d
::
cout
 << "Lªguage: " << 
vecMes§ge_™
->
	`g‘Lªguage
().
	`c_¡r
(è<< " Mes§ge: " << vecMes§ge_™->
	`g‘Text
().c_¡r(è<< std::
’dl
;

94 
¡d
::
cout
 << "Oth”…¬am‘” šşuded:" << std::
’dl
;

95 
¡d
::
m­
<
qcc
::
SŒšg
, qcc::SŒšg> 
cu¡omA‰ribu‹s
 = 
nÙifiÿtiÚ
.
	`g‘Cu¡omA‰ribu‹s
();

97 
¡d
::
m­
<
qcc
::
SŒšg
, qcc::SŒšg>::
cÚ¡_™”©Ü
 
cu¡omA‰ribu‹s_™
 = 
cu¡omA‰ribu‹s
.
	`begš
(); cu¡omA‰ribu‹s_™ !ğcu¡omA‰ribu‹s.
	`’d
(); ++customAttributes_it) {

98 
¡d
::
cout
 << "Cu¡om A‰ribu‹ Key: " << 
cu¡omA‰ribu‹s_™
->
fœ¡
.
	`c_¡r
(è<< " Cu¡om A‰ribu‹ V®ue: " << cu¡omA‰ribu‹s_™->
£cÚd
.c_¡r(è<< std::
’dl
;

101 ià(
nÙifiÿtiÚ
.
	`g‘RichIcÚU¾
()) {

102 
¡d
::
cout
 << "Rich CÚ‹Á IcÚ U¾: " << 
nÙifiÿtiÚ
.
	`g‘RichIcÚU¾
(è<< std::
’dl
;

106 
¡d
::
veùÜ
<
RichAudioU¾
> 
richAudioU¾
 = 
nÙifiÿtiÚ
.
	`g‘RichAudioU¾
();

108 ià(!
richAudioU¾
.
	`em±y
()) {

109 
¡d
::
cout
 << "******************** Begš Rich AudiØCÚ‹Á ********************" << std::
’dl
;

110 
¡d
::
veùÜ
<
RichAudioU¾
>::
cÚ¡_™”©Ü
 
vecAudio_™
 = 
richAudioU¾
.
	`begš
(); vecAudio_™ !ğrichAudioU¾.
	`’d
(); ++vecAudio_it) {

111 
¡d
::
cout
 << "Lªguage: " << 
vecAudio_™
->
	`g‘Lªguage
().
	`c_¡r
(è<< " AudiØU¾: " << vecAudio_™->
	`g‘U¾
().c_¡r(è<< std::
’dl
;

113 
¡d
::
cout
 << "******************** End Rich AudiØCÚ‹Á ********************" << std::
’dl
;

117 ià(
nÙifiÿtiÚ
.
	`g‘RichIcÚObjeùP©h
()) {

118 
¡d
::
cout
 << "Rich CÚ‹Á IcÚ Objeù P©h: " << 
nÙifiÿtiÚ
.
	`g‘RichIcÚObjeùP©h
(è<< std::
’dl
;

121 ià(
nÙifiÿtiÚ
.
	`g‘RichAudioObjeùP©h
()) {

122 
¡d
::
cout
 << "Rich CÚ‹Á AudiØObjeù P©h: " << 
nÙifiÿtiÚ
.
	`g‘RichAudioObjeùP©h
(è<< std::
’dl
;

125 ià(
nÙifiÿtiÚ
.
	`g‘CÚŒŞPª–S”viûObjeùP©h
()) {

126 
¡d
::
cout
 << "CÚŒŞPª–S”viû objeù…©h: " << 
nÙifiÿtiÚ
.
	`g‘CÚŒŞPª–S”viûObjeùP©h
(è<< std::
’dl
;

129 ià(
nÙifiÿtiÚ
.
	`g‘Origš®S’d”
()) {

130 
¡d
::
cout
 << "Origš®S’d”: " << 
nÙifiÿtiÚ
.
	`g‘Origš®S’d”
(è<< std::
’dl
;

134 
¡d
::
cout
 << "******************** End New Mes§gReûived ********************" << std::
’dl
 << std::endl;

136 
NÙifiÿtiÚ
 
	`nÚCÚ¡NÙifiÿtiÚ
(
nÙifiÿtiÚ
);

138 ià(
m_Wa™FÜEx‹º®NÙifiÿtiÚAùiÚ
) {

139 #ifdeà
_WIN32


140 
	`EÁ”Cr™iÿlSeùiÚ
(&
m_Lock
);

141 
	`SË•CÚd™iÚV¬ŸbËCS
(&
m_CÚd™iÚ
, &
m_Lock
, 
INFINITE
);

143 
	`±h»ad_mu‹x_lock
(&
m_Lock
);

144 
	`±h»ad_cÚd_wa™
(&
m_CÚd™iÚ
, &
m_Lock
);

147 
¡d
::
cout
 << "NÙifiÿtiÚ‡ùiÚ (0-NÙhšg 1-Dismiss):" << std::
’dl
;

148 
št32_t
 
	`nÙifiÿtiÚAùiÚ
(
ACTION_NOTHING
);

149 
»tSÿn
 = 
	`sÿnf
("%d", &
nÙifiÿtiÚAùiÚ
);

150 ià(
»tSÿn
 !ğ
EOF
) {

151 
m_NÙifiÿtiÚAùiÚ
 = 
¡©ic_ÿ¡
<
NÙifiÿtiÚAùiÚ
>(
nÙifiÿtiÚAùiÚ
);

154 
	`G‘NÙifiÿtiÚAùiÚ
()) {

155 
ACTION_NOTHING
:

156 
¡d
::
cout
 << "NÙhšg…ÏÃdØdØw™hhnÙifiÿtiÚ mes§gid:" << 
nÚCÚ¡NÙifiÿtiÚ
.
	`g‘Mes§geId
(è<< std::
’dl
;

157 
¡d
::
cout
 << "N“dØadd hªdË¸thmes§gÏ‹¸" << std::
’dl
;

160 
ACTION_DISMISS
:

162 
¡d
::
cout
 << "gošgØÿÎ dismis fÜ mes§gid:" << 
nÚCÚ¡NÙifiÿtiÚ
.
	`g‘Mes§geId
(è<< std::
’dl
;

163 
nÚCÚ¡NÙifiÿtiÚ
.
	`dismiss
();

168 
¡d
::
cout
 << "GÙ‚Ú v®id‡ùiÚØdo:" << 
	`G‘NÙifiÿtiÚAùiÚ
(è<< std::
’dl
;

172 ià(
m_Wa™FÜEx‹º®NÙifiÿtiÚAùiÚ
) {

173 #ifdeà
_WIN32


174 
	`L—veCr™iÿlSeùiÚ
(&
m_Lock
);

176 
	`±h»ad_mu‹x_uÆock
(&
m_Lock
);

180 
¡d
::
cout
 << "End hªdlšg‚ÙifiÿtiÚ!!!" << std::
’dl
;

181 
	}
}

183 
	gNÙifiÿtiÚReûiv”Te¡Im¶
::
£tAµliÿtiÚs
(
qcc
::
SŒšg
 cÚ¡& 
li¡OfAµs
) {

184 
¡d
::
i¡ršg¡»am
 
iss
(
li¡OfAµs
.
c_¡r
());

185 
	g¡d
::
¡ršg
 
sšgËAµName
;

186 
	g¡d
::
g‘lše
(
iss
, 
sšgËAµName
, ';')) {

187 
	gm_AµliÿtiÚs
.
push_back
(
sšgËAµName
.
c_¡r
());

191 
	gNÙifiÿtiÚReûiv”Te¡Im¶
::
Dismiss
(cÚ¡ 
št32_t
 
msgId
, cÚ¡ 
qcc
::
SŒšg
 
­pId
)

193 
¡d
::
cout
 << "GÙ NÙifiÿtiÚReûiv”Te¡Im¶::Dismis w™h msgId=" << 
msgId
 << "‡µId=" << 
­pId
.
c_¡r
(è<< std::
’dl
;

196 
	gNÙifiÿtiÚReûiv”Te¡Im¶
::
NÙifiÿtiÚAùiÚ
 
NÙifiÿtiÚReûiv”Te¡Im¶
::
	$G‘NÙifiÿtiÚAùiÚ
()

198  
m_NÙifiÿtiÚAùiÚ
;

199 
	}
}

201 
	gNÙifiÿtiÚReûiv”Te¡Im¶
::
S‘NÙifiÿtiÚAùiÚ
(
NÙifiÿtiÚReûiv”Te¡Im¶
::
NÙifiÿtiÚAùiÚ
 
nÙifiÿtiÚAùiÚ
)

203 ià(
m_Wa™FÜEx‹º®NÙifiÿtiÚAùiÚ
) {

204 #ifdeà
_WIN32


205 
EÁ”Cr™iÿlSeùiÚ
(&
m_Lock
);

206 
	gm_NÙifiÿtiÚAùiÚ
 = 
nÙifiÿtiÚAùiÚ
;

207 
WakeCÚd™iÚV¬ŸbË
(&
m_CÚd™iÚ
);

208 
L—veCr™iÿlSeùiÚ
(&
m_Lock
);

210 
±h»ad_mu‹x_lock
(&
m_Lock
);

211 
	gm_NÙifiÿtiÚAùiÚ
 = 
nÙifiÿtiÚAùiÚ
;

212 
±h»ad_cÚd_sigÇl
(&
m_CÚd™iÚ
);

213 
±h»ad_mu‹x_uÆock
(&
m_Lock
);

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/common/NotificationReceiverTestImpl.h

17 #iâdeà
NOTIFICATIONRECEIVERTESTIMPL_H_


18 
	#NOTIFICATIONRECEIVERTESTIMPL_H_


	)

20 
	~<veùÜ
>

21 
	~<®ljoyn/nÙifiÿtiÚ/NÙifiÿtiÚReûiv”.h
>

22 
	~<®ljoyn/nÙifiÿtiÚ/NÙifiÿtiÚ.h
>

23 #ifdeà
_WIN32


24 
	~<Wšdows.h
>

25 
	#±h»ad_mu‹x_t
 
CRITICAL_SECTION


	)

26 
	#±h»ad_cÚd_t
 
CONDITION_VARIABLE


	)

28 
	~<±h»ad.h
>

37 şas 
	cNÙifiÿtiÚReûiv”Te¡Im¶
 : 
public
 
ajn
::
£rviûs
::
NÙifiÿtiÚReûiv”
 {

38 
public
:

39 
	eNÙifiÿtiÚAùiÚ
 {

40 
ACTION_NOTHING
,

41 
	mACTION_DISMISS


47 
NÙifiÿtiÚReûiv”Te¡Im¶
(
boŞ
 
wa™FÜEx‹º®NÙifiÿtiÚAùiÚ
 = 
Œue
);

52 ~
NÙifiÿtiÚReûiv”Te¡Im¶
();

58 
Reûive
(
ajn
::
£rviûs
::
NÙifiÿtiÚ
 cÚ¡& 
nÙifiÿtiÚ
);

64 
£tAµliÿtiÚs
(
qcc
::
SŒšg
 cÚ¡& 
li¡OfAµs
);

71 
Dismiss
(cÚ¡ 
št32_t
 
msgId
, cÚ¡ 
qcc
::
SŒšg
 
­pId
);

77 
NÙifiÿtiÚAùiÚ
 
G‘NÙifiÿtiÚAùiÚ
();

85 
S‘NÙifiÿtiÚAùiÚ
(
NÙifiÿtiÚAùiÚ
 
nÙifiÿtiÚAùiÚ
);

87 
	g´iv©e
:

92 
¡d
::
veùÜ
<
qcc
::
SŒšg
> 
m_AµliÿtiÚs
;

96 
NÙifiÿtiÚAùiÚ
 
	gm_NÙifiÿtiÚAùiÚ
;

100 
±h»ad_mu‹x_t
 
	gm_Lock
;

106 
±h»ad_cÚd_t
 
	gm_CÚd™iÚ
;

113 
boŞ
 
	gm_Wa™FÜEx‹º®NÙifiÿtiÚAùiÚ
;

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/handle_sys_feature.c

1 
	~"sh¬e.h
"

2 
	~"·r£r.h
"

3 
	~"hªdË_sys_ã©u».h
"

4 
	~<cu¾/cu¾.h
>

5 
	#CLOUDC_GET_APMAC
 "/‘c/cÚfig/ÃtwÜk"

	)

8 
g‘_­_šfo
();

9 
şoudc_½c_m‘hod_hªdË
(
h‰p_v®ue
 
»cv_d©a
);

10 
şoudc_mªage_k
(*
İ_ty³
, 
£rŸl_num
, 
k_šfo
 *
k_li¡_h—d
, 
»®_k_num
);

11 
şoudc_mªage_qu”y
(*
İ_ty³
, 
£rŸl_num
);

12 
şoudc_mªage_İkg
(*
İ_ty³
, 
£rŸl_num
, 
upd©e_æag
, *
u¾
);

13 
şoudc_mªage_£rviû
(*
İ_ty³
, 
£rŸl_num
, 
k_šfo
 *
k_li¡_h—d
, 
»®_k_num
);

14 
şoudc_mªage_®ljoyn_£t_İ”©iÚ
(*
İ_ty³
, 
£rŸl_num
, *
u£r_id
, *
deviû_id
, *
deviû_ty³
, *
devD©a
);

15 
şoudc_mªage_®ljoyn_upd©e_devid
(*
İ_ty³
, *
deviû_id
, *
deviû_¢
);

16 
şoudc_mªage_®ljoyn_£t_devD©a
(*
deviûId
);

18 
şoudc_dowÆßd_fe
(*
dowÆßd_u¾
);

19 
şoudc_İkg_cÚf_upd©e
();

21 
şoudc_š¡®l_k
(*
k_Çme
);

22 
şoudc_upg¿de_k
(*
k_Çme
);

23 
şoudc_unš¡®l_k
(*
k_Çme
);

24 
check_k_š¡®Ëd
(*
k_Çme
);

26 
şoudc_g‘_ruÂšg_k_li¡
(*
İ_ty³
, 
£rŸl_num
);

27 
şoudc_g‘_š¡®l_k_li¡
(*
İ_ty³
, 
£rŸl_num
);

29 
şoudc_¡¬t_k
(*
k_Çme
);

30 
şoudc_¡İ_k
(*
k_Çme
);

31 
şoudc_’abË_k
(*
k_Çme
);

32 
şoudc_di§bË_k
(*
k_Çme
);

35 
size_t
 
	$my_fwr™e
(*
bufãr
, 
size_t
 
size
, size_ˆ
nmemb
,

36 *
¡»am
)

38 
FFe
 *
out
=(FF*)
¡»am
;

39 if(
out
 && !out->
¡»am
) {

41 
out
->
¡»am
=
	`fİ’
(out->
f’ame
, "wb");

42 if(!
out
->
¡»am
)

45  
	`fwr™e
(
bufãr
, 
size
, 
nmemb
, 
out
->
¡»am
);

46 
	}
}

48 
	$g‘_­_šfo
()

54 
‹mp_­_mac
[
MAX_MAC_LEN
] = "42:21:33:dd:08:08";

55 
‹mp_­_¢
[
MAX_SN_LEN
] = "tempserialnumber0099";

56 
	`¡ºıy
(
­_mac
, 
‹mp_­_mac
, (ap_mac) - 1);

57 
	`¡ºıy
(
­_¢
, 
‹mp_­_¢
, (
­_mac
) - 1);

59 
	}
}

61 
	$şoudc_½c_m‘hod_hªdË
(
h‰p_v®ue
 
»cv_d©a
)

63 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

64 
»cv_d©a
.
½c_æag
)

66 
eQu”yO³¿tiÚ
:

67 
	`şoudc_mªage_qu”y
(
»cv_d©a
.
½c_cmd
,„ecv_d©a.
£rŸl_num
);

70 
eIpkO³¿tiÚ
:

71 
	`şoudc_mªage_k
(
»cv_d©a
.
½c_cmd
,„ecv_d©a.
£rŸl_num
,„ecv_d©a.
k_Çme_h—d
->
Ãxt
,„ecv_d©a.
»®_k_num
);

74 
eOpkgO³¿tiÚ
:

75 
	`şoudc_mªage_İkg
(
»cv_d©a
.
½c_cmd
,„ecv_d©a.
£rŸl_num
,„ecv_d©a.
İkg_upd©e_æag
,„ecv_d©a.
İkg_upd©e_u¾
);

78 
eS”viûO³¿tiÚ
:

79 
	`şoudc_mªage_£rviû
(
»cv_d©a
.
½c_cmd
,„ecv_d©a.
£rŸl_num
,„ecv_d©a.
k_Çme_h—d
->
Ãxt
,„ecv_d©a.
»®_k_num
);

82 
eRegi¡”
:

83 
­_»gi¡”_æag
 = 
»cv_d©a
.
»gi¡”_¡©us
;

85 
	`şoudc_debug
("%s[%d]:‡p_»gi¡”_æag = %d", 
__func__
, 
__LINE__
, 
­_»gi¡”_æag
);

87 ià(1 =ğ
»cv_d©a
.
»gi¡”_¡©us
)

89 
	`şoudc_debug
("%s[%d]:„egi¡”ed faed", 
__func__
, 
__LINE__
);

90 
	`¦“p
(10);

94 
	`­_»gi¡”
();

96 ià((0 =ğ
»cv_d©a
.
»gi¡”_¡©us
) || (2 ==„ecv_data.register_status))

98 
	`şoudc_debug
("%s[%d]:‡Ì—dy„egi¡”ed", 
__func__
, 
__LINE__
);

106 
eAÎjoynG‘O³¿tiÚ
:

109 
eAÎjoynS‘O³¿tiÚ
:

110 
	`şoudc_mªage_®ljoyn_£t_İ”©iÚ
(
»cv_d©a
.
½c_cmd
,„ecv_d©a.
£rŸl_num
,„ecv_d©a.
u£r_id
,„ecv_d©a.
deviû_id
,„ecv_d©a.
deviû_ty³
,„ecv_d©a.
devD©a
);

113 
eAÎjoynUpd©eDeviûId
:

114 
	`şoudc_mªage_®ljoyn_upd©e_devid
(
»cv_d©a
.
½c_cmd
,„ecv_d©a.
deviû_id
,„ecv_d©a.
deviû_¢
);

115 
	`şoudc_mªage_®ljoyn_£t_devD©a
(
»cv_d©a
.
deviû_id
);

119 
	`şoudc_”rÜ
("%s[%d]: unknow fÏg,„pc_æag = %d", 
__func__
, 
__LINE__
, 
»cv_d©a
.
½c_æag
);

122 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

123 
	}
}

125 
	$şoudc_mªage_İkg
(*
İ_ty³
, 
£rŸl_num
, 
upd©e_æag
, *
u¾
)

127 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

128 
upd©e_¡©us
 = -1;

129 
»¶aû_¡©us
 = -1;

131 ià(
NULL
 !ğ
u¾
)

137 
»¶aû_¡©us
 = 
	`şoudc_dowÆßd_fe
(
u¾
);

143 
»¶aû_¡©us
 = 0;

144 
	`şoudc_debug
("%s[%d]:‚ØÃedØ»¶aû opkg_cÚàfe", 
__func__
, 
__LINE__
);

147 ià(1 =ğ
upd©e_æag
)

151 
upd©e_¡©us
 = 
	`şoudc_İkg_cÚf_upd©e
();

155 
upd©e_¡©us
 = 0;

156 
	`şoudc_debug
("%s[%d]:‚ØÃedØupd©e", 
__func__
, 
__LINE__
);

159 
	`şoudc_£nd_r¥_İkg_buf
(
İ_ty³
, 
£rŸl_num
, 
upd©e_¡©us
, 
»¶aû_¡©us
);

160 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

162 
	}
}

164 
	$şoudc_mªage_qu”y
(*
İ_ty³
, 
£rŸl_num
)

166 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

167 ià(0 =ğ
	`¡rcmp
(
İ_ty³
, 
CMD_GET_INSTALL_IPK
))

169 
	`şoudc_g‘_š¡®l_k_li¡
(
İ_ty³
, 
£rŸl_num
);

172 ià(0 =ğ
	`¡rcmp
(
İ_ty³
, 
CMD_GET_RUNNING_IPK
))

174 
	`şoudc_g‘_ruÂšg_k_li¡
(
İ_ty³
, 
£rŸl_num
);

178 
	`şoudc_debug
("%s[%d]: unknowÀty³", 
__func__
, 
__LINE__
);

181 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

184 
	}
}

186 
	$şoudc_mªage_k
(*
İ_ty³
, 
£rŸl_num
, 
k_šfo
 *
k_li¡_h—d
, 
»®_k_num
)

188 
¡©us
[
»®_k_num
];

189 
i
 = 0;

190 
k_šfo
 *
k_li¡_tmp
 = 
k_li¡_h—d
;

192 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

193 
	`mem£t
(
¡©us
, -1, (status));

195 ià(0 =ğ
	`¡rcmp
(
İ_ty³
, 
CMD_INSTALL_IPK
))

197 
i
 = 0; i < 
»®_k_num
; i ++)

199 
¡©us
[
i
] = 
	`şoudc_š¡®l_k
(
k_li¡_tmp
->
İ_k_Çme
);

200 ià(-1 =ğ
¡©us
[
i
])

202 
	`şoudc_”rÜ
("%s[%d]: faedØš¡®È%s", 
__func__
, 
__LINE__
, 
k_li¡_tmp
->
İ_k_Çme
);

205 
k_li¡_tmp
 = ipk_li¡_tmp->
Ãxt
;

208 
	`şoudc_£nd_r¥_k_buf
(
İ_ty³
, 
£rŸl_num
, 
k_li¡_h—d
, 
¡©us
, 
»®_k_num
);

211 ià(0 =ğ
	`¡rcmp
(
İ_ty³
, 
CMD_UNINSTALL_IPK
))

213 
i
 = 0; i < 
»®_k_num
; i ++)

215 
¡©us
[
i
] = 
	`şoudc_unš¡®l_k
(
k_li¡_tmp
->
İ_k_Çme
);

216 ià(-1 =ğ
¡©us
[
i
])

218 
	`şoudc_”rÜ
("%s[%d]: faedØunš¡®È%s", 
__func__
, 
__LINE__
, 
k_li¡_tmp
->
İ_k_Çme
);

221 
k_li¡_tmp
 = ipk_li¡_tmp->
Ãxt
;

224 
	`şoudc_£nd_r¥_k_buf
(
İ_ty³
, 
£rŸl_num
, 
k_li¡_h—d
, 
¡©us
, 
»®_k_num
);

227 ià(0 =ğ
	`¡rcmp
(
İ_ty³
, 
CMD_UPGRADE_IPK
))

229 
i
 = 0; i < 
»®_k_num
; i ++)

231 
¡©us
[
i
] = 
	`şoudc_upg¿de_k
(
k_li¡_tmp
->
İ_k_Çme
);

232 ià(-1 =ğ
¡©us
[
i
])

234 
	`şoudc_”rÜ
("%s[%d]: faedØupg¿d%s", 
__func__
, 
__LINE__
, 
k_li¡_tmp
->
İ_k_Çme
);

237 
k_li¡_tmp
 = ipk_li¡_tmp->
Ãxt
;

239 
	`şoudc_£nd_r¥_k_buf
(
İ_ty³
, 
£rŸl_num
, 
k_li¡_h—d
, 
¡©us
, 
»®_k_num
);

244 
	`şoudc_”rÜ
("%s[%d]: invad op_ty³,‚“d s”v” cÚfœm", 
__func__
, 
__LINE__
);

246 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

249 
	}
}

251 
	$şoudc_mªage_£rviû
(*
İ_ty³
, 
£rŸl_num
, 
k_šfo
 *
k_li¡_h—d
, 
»®_k_num
)

253 
¡©us
[
»®_k_num
];

254 
i
 = 0;

255 
k_šfo
 *
k_li¡_tmp
 = 
k_li¡_h—d
;

257 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

258 
	`mem£t
(
¡©us
, -1, (status));

260 ià(0 =ğ
	`¡rcmp
(
İ_ty³
, 
CMD_START_IPK_SERVICE
))

262 
i
 = 0; i < 
»®_k_num
; i ++)

264 
¡©us
[
i
] = 
	`şoudc_¡¬t_k
(
k_li¡_tmp
->
İ_k_Çme
);

265 ià(-1 =ğ
¡©us
[
i
])

267 
	`şoudc_”rÜ
("%s[%d]: faedØ¡¬ˆ% £rviû", 
__func__
, 
__LINE__
, 
k_li¡_h—d
->
İ_k_Çme
);

270 
k_li¡_tmp
 = ipk_li¡_tmp->
Ãxt
;

273 
	`şoudc_£nd_r¥_k_buf
(
İ_ty³
, 
£rŸl_num
, 
k_li¡_h—d
, 
¡©us
, 
»®_k_num
);

276 ià(0 =ğ
	`¡rcmp
(
İ_ty³
, 
CMD_STOP_IPK_SERVICE
))

278 
i
 = 0; i < 
»®_k_num
; i ++)

280 
¡©us
[
i
] = 
	`şoudc_¡İ_k
(
k_li¡_h—d
->
İ_k_Çme
);

282 
	`şoudc_”rÜ
("%s[%d]: faedØ¡¬ˆ% £rviû", 
__func__
, 
__LINE__
, 
k_li¡_h—d
->
İ_k_Çme
);

285 
k_li¡_tmp
 = ipk_li¡_tmp->
Ãxt
;

287 
	`şoudc_£nd_r¥_k_buf
(
İ_ty³
, 
£rŸl_num
, 
k_li¡_h—d
, 
¡©us
, 
»®_k_num
);

290 ià(0 =ğ
	`¡rcmp
(
İ_ty³
, 
CMD_ENABLE_IPK_SERVICE
))

292 
i
 = 0; i < 
»®_k_num
; i ++)

294 
¡©us
[
i
] = 
	`şoudc_’abË_k
(
k_li¡_h—d
->
İ_k_Çme
);

295 ià(-1 =ğ
¡©us
[
i
])

297 
	`şoudc_”rÜ
("%s[%d]: faedØ’abË % £rviû", 
__func__
, 
__LINE__
, 
k_li¡_h—d
->
İ_k_Çme
);

301 
	`şoudc_£nd_r¥_k_buf
(
İ_ty³
, 
£rŸl_num
, 
k_li¡_h—d
, 
¡©us
, 
»®_k_num
);

304 ià(0 =ğ
	`¡rcmp
(
İ_ty³
, 
CMD_DISABLE_IPK_SERVICE
))

306 
i
 = 0; i < 
»®_k_num
; i ++)

308 
¡©us
[
i
] = 
	`şoudc_di§bË_k
(
k_li¡_h—d
->
İ_k_Çme
);

309 ià(-1 =ğ
¡©us
[
i
])

311 
	`şoudc_”rÜ
("%s[%d]: faedØdi§bË % £rviû", 
__func__
, 
__LINE__
, 
k_li¡_h—d
->
İ_k_Çme
);

314 
	`şoudc_£nd_r¥_k_buf
(
İ_ty³
, 
£rŸl_num
, 
k_li¡_h—d
, 
¡©us
, 
»®_k_num
);

319 
	`şoudc_”rÜ
("%s[%d]: invad op_ty³,‚“d s”v” cÚfœm", 
__func__
, 
__LINE__
);

321 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

324 
	}
}

326 
	$şoudc_mªage_®ljoyn_£t_İ”©iÚ
(*
İ_ty³
, 
£rŸl_num
, *
u£r_id
, *
deviû_id
, *
deviû_ty³
, *
devD©a
)

328 
objeùP©h
[
MAX_OBJECTPATH_LEN
] = {0};

329 
š‹rçûName
[
MAX_INTERFACE_LEN
] = {0};

330 
ÚlšeStus
[
MAX_ONLINESTATUS_LEN
] = {0};

331 
deviûTy³
[
MAX_DEVICETYPE_LEN
] = {0};

332 
mªuçùu»
[
MAX_MANUFACTURE_LEN
] = {0};

333 
moduËNumb”
[
MAX_MODULENUMBER_LEN
] = {0};

334 
msg_ty³
 = -1;

335 
»t
 = 0;

337 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

340 if(
	`¡rcmp
(
İ_ty³
, "get") == 0)

342 
msg_ty³
 = 0;

344 if(
	`¡rcmp
(
İ_ty³
, "set") == 0)

346 
msg_ty³
 = 1;

349 
	`şoudc_debug
("%s[%d]: op_ty³ = %s, s”Ÿl_num = %d, u£r_id = %s, deviû_id = %s, deviû_ty³ = %s\n", 
__func__
, 
__LINE__
, 
İ_ty³
, 
£rŸl_num
, 
u£r_id
, 
deviû_id
, 
deviû_ty³
);

351 
	`g‘ObjInfoByDevId
(
deviû_id
, 
š‹rçûName
, 
objeùP©h
, 
ÚlšeStus
);

352 if(
	`¡rcmp
(
ÚlšeStus
, "on") == 0)

354 if(
NULL
 !ğ
devD©a
)

356 
»t
 = 
	`cÚfigCl›ÁMaš
(
š‹rçûName
,
objeùP©h
, 
msg_ty³
, 
devD©a
);

357 
	`şoudc_£nd_r¥_£t_buf
(
İ_ty³
, 
£rŸl_num
, 
u£r_id
, 
deviû_id
, 
devD©a
, 
»t
);

362 
	`şoudc_debug
("%s[%d]: deviû i ®»ady ofæše, cªnÙ bcÚfigu»d", 
__func__
, 
__LINE__
);

366 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

368 
	}
}

370 
	$şoudc_mªage_®ljoyn_upd©e_devid
(*
İ_ty³
, *
deviû_id
, *
deviû_¢
)

372 
»t
 = -1;

373 
»t
 = 
	`£tDevIdByDevSn
(
deviû_id
, 
deviû_¢
);

374 if(0 =ğ
»t
)

376 
	`şoudc_debug
("%s[%d]:upd©deviûId sucûed,‚“dØ£ndØ£rv”? \n", 
__func__
, 
__LINE__
);

380 
	`şoudc_debug
("%s[%d]:upd©deviûId faed,‚“dØ£ndØ£rv”? \n", 
__func__
, 
__LINE__
);

382 
	}
}

384 
	$şoudc_mªage_®ljoyn_£t_devD©a
(*
deviûId
)

386 
objeùP©h
[
MAX_OBJECTPATH_LEN
] = {0};

387 
š‹rçûName
[
MAX_INTERFACE_LEN
] = {0};

388 
ÚlšeStus
[
MAX_ONLINESTATUS_LEN
] = {0};

389 
devD©a
[
MAX_DEVDATA_LEN
] = {0};

390 
msg_ty³
 = -1;

391 
»t
 = 0;

393 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

395 
msg_ty³
 = 1;

398 
	`g‘ObjInfoByDevId
(
deviûId
, 
š‹rçûName
, 
objeùP©h
, 
ÚlšeStus
);

399 
	`g‘DevD©aByDevId
(
deviûId
, 
devD©a
);

400 
	`şoudc_debug
("%s[%d]: deviû_id = %s, devD©¨ğ%s\n", 
__func__
, 
__LINE__
, 
deviûId
, 
devD©a
);

402 if(
	`¡rcmp
(
ÚlšeStus
, "on") == 0)

404 if(
NULL
 !ğ
devD©a
)

406 
	`cÚfigCl›ÁMaš
(
š‹rçûName
,
objeùP©h
, 
msg_ty³
, 
devD©a
, 
NULL
, 0);

411 
	`şoudc_debug
("%s[%d]: deviû i ®»ady ofæše, cªnÙ bcÚfigu»d", 
__func__
, 
__LINE__
);

415 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

417 
	}
}

419 
	$şoudc_dowÆßd_fe
(*
dowÆßd_u¾
)

421 
CURL
 *
cu¾
;

422 
CURLcode
 
»s
;

423 
dowÆßd_¡©us
 = -1;

424 
FFe
 
ápfe
={

426 
NULL


429 
	`şoudc_debug
("%s[%d]: EÁ”,‡nd u¾ i %s", 
__func__
, 
__LINE__
, 
dowÆßd_u¾
);

430 
	`cu¾_glob®_š™
(
CURL_GLOBAL_DEFAULT
);

432 
cu¾
 = 
	`cu¾_—sy_š™
();

433 if(
cu¾
) {

439 
	`cu¾_—sy_£tİt
(
cu¾
, 
CURLOPT_URL
, 
dowÆßd_u¾
);

441 
	`cu¾_—sy_£tİt
(
cu¾
, 
CURLOPT_WRITEFUNCTION
, 
my_fwr™e
);

443 
	`cu¾_—sy_£tİt
(
cu¾
, 
CURLOPT_WRITEDATA
, &
ápfe
);

446 
	`cu¾_—sy_£tİt
(
cu¾
, 
CURLOPT_VERBOSE
, 1L);

448 
»s
 = 
	`cu¾_—sy_³rfÜm
(
cu¾
);

451 
	`cu¾_—sy_ş—nup
(
cu¾
);

453 if(
CURLE_OK
 !ğ
»s
) {

455 
	`şoudc_debug
("%s[%d]: cu¾Şd u %d\n", 
__func__
, 
__LINE__
, 
»s
);

456 
dowÆßd_¡©us
 = 1;

460 if(
ápfe
.
¡»am
)

461 
	`fşo£
(
ápfe
.
¡»am
);

463 
	`cu¾_glob®_ş—nup
();

465 if(1 =ğ
dowÆßd_¡©us
)

467 
	`şoudc_debug
("%s[%d]: Ex™,dowÆßd opkg cÚàçu»", 
__func__
, 
__LINE__
);

472 if(0 =ğ
	`»Çme
("/etc/opkg.temp","/etc/opkg.conf") )

474 
	`şoudc_debug
("%s[%d]: Ex™,»Çmsucûss", 
__func__
, 
__LINE__
);

479 
	`şoudc_debug
("%s[%d]: Ex™,»Çmçu»", 
__func__
, 
__LINE__
);

483 
	}
}

485 
	$şoudc_š¡®l_k
(*
k_Çme
)

487 
·ckage_Ën
 = 
	`¡¾’
(
k_Çme
);

488 
check_»suÉ
 = -1;

490 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

492 iàĞ
NULL
 !ğ
k_Çme
)

494 * 
‹mp_bufãr
 = (*)
	`m®loc
(
·ckage_Ën
 + 
LEN_OF_CMD_HEAD
);

495 ià(
NULL
 =ğ
‹mp_bufãr
)

497 
	`şoudc_”rÜ
("%s[%d]: m®loøçed", 
__func__
, 
__LINE__
);

498  
IPK_UNINSTALLED
;

500 
	`¡rıy
(
‹mp_bufãr
, "opkg-customer install ");

501 
	`¡rÿt
(
‹mp_bufãr
, 
k_Çme
);

502 
	`sy¡em
("opkg-customer update");

503 
	`sy¡em
(
‹mp_bufãr
);

505 
	`ä“
(
‹mp_bufãr
);

507 
check_»suÉ
 = 
	`check_k_š¡®Ëd
(
k_Çme
);

508 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

512 
check_»suÉ
 = 
IPK_UNINSTALLED
;

515 ià(
check_»suÉ
 =ğ
IPK_INSTALLED
)

519 
	}
}

521 
	$şoudc_upg¿de_k
(*
k_Çme
)

523 
check_»suÉ_1
 = -1;

524 
check_»suÉ_2
 = -1;

526 ià(
NULL
 !ğ
k_Çme
)

528 
	`şoudc_unš¡®l_k
(
k_Çme
);

529 
check_»suÉ_1
 = 
	`check_k_š¡®Ëd
(
k_Çme
);

530 
	`şoudc_š¡®l_k
(
k_Çme
);

531 
check_»suÉ_2
 = 
	`check_k_š¡®Ëd
(
k_Çme
);

538 ià(
check_»suÉ_1
 =ğ
IPK_UNINSTALLED
 && 
check_»suÉ_2
 =ğ
IPK_INSTALLED
)

542 
	}
}

544 
	$şoudc_unš¡®l_k
(*
k_Çme
)

550 
·ckage_Ën
 = 
	`¡¾’
(
k_Çme
);

551 
check_»suÉ
 = -1;

553 ià(
NULL
 !ğ
k_Çme
)

555 * 
‹mp_bufãr
 = (*)
	`m®loc
(
·ckage_Ën
 + 
LEN_OF_CMD_HEAD
);

556 ià(
NULL
 =ğ
‹mp_bufãr
)

558 
	`şoudc_”rÜ
("%s[%d]: m®loøçed", 
__func__
, 
__LINE__
);

559  
IPK_UNINSTALLED
;

561 
	`¡rıy
(
‹mp_bufãr
, "opkg-customer„emove ");

562 
	`¡rÿt
(
‹mp_bufãr
, 
k_Çme
);

563 
	`sy¡em
(
‹mp_bufãr
);

564 
	`ä“
(
‹mp_bufãr
);

566 
check_»suÉ
 = 
	`check_k_š¡®Ëd
(
k_Çme
);

567 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

571 
check_»suÉ
 =ğ
IPK_UNINSTALLED
;

574 ià(
check_»suÉ
 =ğ
IPK_UNINSTALLED
)

578 
	}
}

580 
	$şoudc_g‘_ruÂšg_k_li¡
(*
İ_ty³
, 
£rŸl_num
)

582 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

583 
‹mp_ruÂšg_k_li¡
[][
MAX_IPK_NAME_LEN
] = {"portal","loudc","hello"};

584 
qu”y_k_num
 = 3;

586 
	`şoudc_£nd_r¥_qu”y_buf
(
İ_ty³
, 
£rŸl_num
, 
‹mp_ruÂšg_k_li¡
, 
qu”y_k_num
);

587 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

590 
	}
}

592 
	$şoudc_g‘_š¡®l_k_li¡
(*
İ_ty³
, 
£rŸl_num
)

594 
FILE
 *
f¡»am
;

595 
‹mp_¡ršg
[50];

597 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

598 
	`sy¡em
("opkg-customer†ist-customer-installed > /tmp/customer_ipk_list");

600 
f¡»am
 = 
	`fİ’
("/tmp/customer_ipk_list", "r");

601 ià(
f¡»am
==
NULL
)

603 
	`şoudc_debug
("%s[%d]: faØİ’ cu¡om”_k_li¡", 
__func__
, 
__LINE__
);

607 
IPK_QUERY_INFO_NODE
 *
pH—d
 = 
	`m®loc
((IPK_QUERY_INFO_NODE));

608 
pH—d
->
pNext
 = 
NULL
;

609 
IPK_QUERY_INFO_NODE
 *
pTa
 = 
pH—d
;

610 
IPK_QUERY_INFO_NODE
 *
pTemp
;

612 
	`fg‘s
(
‹mp_¡ršg
, 50, 
f¡»am
è!ğ
NULL
)

614 
	`şoudc_debug
("%s[%d]:emp_¡ršg i %s", 
__func__
, 
__LINE__
, 
‹mp_¡ršg
);

615 if(
	`¡¾’
(
‹mp_¡ršg
è> 
MAX_IPK_NAME_LEN
)

617 
	`şoudc_debug
("%s[%d]: ipk_Çmi toØlÚg", 
__func__
, 
__LINE__
);

621 
pTemp
 = 
	`m®loc
((
IPK_QUERY_INFO_NODE
));

623 
‹mp_¡ršg
[
	`¡¾’
(temp_string) - 1] = '\0';

624 
	`şoudc_debug
("%s[%d]:emp_¡ršg = %s", 
__func__
, 
__LINE__
, 
‹mp_¡ršg
);

625 
	`¡ºıy
(
pTemp
->
k_qu”y_Çme
, 
‹mp_¡ršg
, 
MAX_IPK_NAME_LEN
 - 1);

627 
pTemp
->
pNext
 = 
NULL
;

628 
pTa
->
pNext
 = 
pTemp
;

629 
pTa
 = 
pTemp
;

631 
	`fşo£
(
f¡»am
);

633 
	`şoudc_debug
("%s[%d]:…»·»Ø£nd„¥ qu”y buf", 
__func__
, 
__LINE__
);

634 
	`şoudc_£nd_r¥_qu”y_buf
(
İ_ty³
, 
£rŸl_num
, 
pH—d
);

635 
	`şoudc_debug
("%s[%d]:‡Ì—dy fšishØ£nd„¥ qu”y buf", 
__func__
, 
__LINE__
);

638 
pTemp
 = 
pH—d
->
pNext
;

639 
	`şoudc_debug
("%s[%d]:…H—d=%p,…Temp=%p", 
__func__
, 
__LINE__
, 
pH—d
, 
pTemp
);

640 
pH—d
 !ğ
NULL
)

642 
	`ä“
(
pH—d
);

643 
pH—d
 = 
pTemp
;

644 if(
pTemp
->
pNext
 !ğ
NULL
)

645 
pTemp
 =…Temp->
pNext
;

648 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

651 
	}
}

653 
	$şoudc_¡¬t_k
(*
k_Çme
)

655 
cmd
[128] = {0};

656 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

658 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

660 
	}
}

662 
	$şoudc_¡İ_k
(*
k_Çme
)

664 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

665 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

667 
	}
}

669 
	$şoudc_’abË_k
(*
k_Çme
)

671 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

672 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

674 
	}
}

676 
	$şoudc_di§bË_k
(*
k_Çme
)

678 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

679 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

681 
	}
}

683 
	$check_k_š¡®Ëd
(*
k_Çme
)

685 
FILE
 *
f¡»am
;

686 
‹mp_¡ršg
[50];

688 
	`sy¡em
("opkg-customer†ist-customer-installed > /tmp/customer_ipk_list");

690 
f¡»am
 = 
	`fİ’
("/tmp/customer_ipk_list", "r");

691 ià(
f¡»am
==
NULL
)

693 
	`şoudc_debug
("%s[%d]: faØİ’ cu¡om”_k_li¡", 
__func__
, 
__LINE__
);

697 
	`şoudc_debug
("%s[%d]: ipk_Çmi %s", 
__func__
, 
__LINE__
, 
k_Çme
);

698 
	`fg‘s
(
‹mp_¡ršg
, 50, 
f¡»am
è!ğ
NULL
)

700 
	`şoudc_debug
("%s[%d]:emp_¡ršg i %s", 
__func__
, 
__LINE__
, 
‹mp_¡ršg
);

701 if(
‹mp_¡ršg
 =ğ
	`¡r¡r
Ñemp_¡ršg, 
k_Çme
))

703 
	`şoudc_debug
("%s[%d]: ipk in¡®Ëd", 
__func__
, 
__LINE__
);

704 
	`fşo£
(
f¡»am
);

708 
	`fşo£
(
f¡»am
);

709 
	`şoudc_debug
("%s[%d]: ipk‚Ù in¡®Ëd", 
__func__
, 
__LINE__
);

711 
	}
}

713 
	$şoudc_İkg_cÚf_upd©e
()

715 
FILE
 *
f¡»am
;

716 
‹mp
;

718 
	`sy¡em
("opkg-customer update 2>/tmp/opkg_update_result");

719 
f¡»am
 = 
	`fİ’
("/tmp/opkg_update_result", "r");

720 ià(
f¡»am
 !ğ
NULL
)

722 if((
‹mp
=
	`fg‘c
(
f¡»am
)è!ğ
EOF
)

724 
	`şoudc_debug
("%s[%d]: opkg upd©”rÜ", 
__func__
, 
__LINE__
);

725 
	`fşo£
(
f¡»am
);

730 
	`şoudc_debug
("%s[%d]: opkg upd©sucûss", 
__func__
, 
__LINE__
);

731 
	`fşo£
(
f¡»am
);

733 
	}
}

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/handle_sys_feature.h

1 
	#LEN_OF_CMD_HEAD
 20

	)

2 
	#IPK_INSTALLED
 0

	)

3 
	#IPK_UNINSTALLED
 1

	)

6 
	sFFe


8 cÚ¡ *
	mf’ame
;

9 
FILE
 *
	m¡»am
;

12 
	sk_qu”y_šfo_node


14 
	mk_qu”y_Çme
[
MAX_IPK_NAME_LEN
];

15 
k_qu”y_šfo_node
 *
	mpNext
;

16 }
	tIPK_QUERY_INFO_NODE
;

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/listener.c

1 
	~"sh¬e.h
"

2 
	~"·r£r.h
"

3 
	~"cJSON.h
"

5 
şoudc_»ad_d©a_äom_£rv”
(
fd
, *
buf
);

6 
´oûss_şoudc_mÚ™Ü
(
uloİ_fd
 *
u
, 
ev’ts
);

8 
uloİ_fd
 
	gşoudc_mÚ™Ü_uloİ_fd
 =

10 .
cb
 = 
´oûss_şoudc_mÚ™Ü
,

11 .
	gfd
 = -1

14 
	$´oûss_şoudc_mÚ™Ü
(
uloİ_fd
 *
u
, 
ev’ts
)

16 
»cv_buf
[
RECV_MAX_BUF_LEN
] = {0};

17 
»cv_buf_Ën
 = 0;

19 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

20 
»cv_buf_Ën
 = 
	`şoudc_»ad_d©a_äom_£rv”
(
u
->
fd
, 
»cv_buf
);

21 
	`´štf
("\n\n");

22 
	`şoudc_debug
("%s[%d]:„ecv_buf_ËÀğ%d ", 
__func__
, 
__LINE__
, 
»cv_buf_Ën
);

23 
	`şoudc_debug
("%s[%d]:„ecv_buàğ%s", 
__func__
, 
__LINE__
, 
»cv_buf
);

24 
	`´štf
("\n\n");

26 ià(
»cv_buf_Ën
 > 0)

28 
	`şoudc_·r£_»ûive_šfo
(
»cv_buf
);

30 if(
»cv_buf_Ën
 < 0)

32 
	`şoudc_debug
("%s[%d]:„ecv_buf_ËÀğ%d, %s,‚“dØ»cÚÃùØ£rv” ", 
__func__
, 
__LINE__
, 
»cv_buf_Ën
, 
	`¡»¼Ü
(
”ºo
));

34 
	`shutdown
(
u
->
fd
, 2);

35 
	`şo£
(
u
->
fd
);

36 
	`sock‘_š™
();

37 
	`­_»gi¡”
();

39 
	`is_sock‘_cÚÃùed
(
u
->
fd
);

40 
	`şo£
(
u
->
fd
);

41 
	`¦“p
(10);

42 
fxag’tPid
 = 
	`g‘pid
();

43 
cmd1
[128] = {0};

44 
cmd2
[128] = {0};

45 
	`¢´štf
(
cmd1
, (cmd1), "./fxag’ˆ%s:%d &", 
şoudc_£rv”_
, 
şoudc_£rv”_pÜt
);

46 
	`sy¡em
(
cmd1
);

47 
	`¢´štf
(
cmd2
, (cmd2), "kÈ-9 %d", 
fxag’tPid
);

48 
	`sy¡em
(
cmd2
);

52 if(-1 =ğ
»cv_buf_Ën
)

54 
	`şoudc_debug
("%s[%d]:„ecv_buf_ËÀğ%d, %s,‚“dØ»cÚÃùØ£rv” ", 
__func__
, 
__LINE__
, 
»cv_buf_Ën
, 
	`¡»¼Ü
(
”ºo
));

55 
	`şo£
(
u
->
fd
);

56 
	`sock‘_š™
();

57 
	`­_»gi¡”
();

60 if(0 =ğ
»cv_buf_Ën
)

62 
	`şoudc_debug
("%s[%d]:„ecv_buf_ËÀğ%d, %s,„e¡¬ˆfxag’ˆ", 
__func__
, 
__LINE__
, 
»cv_buf_Ën
, 
	`¡»¼Ü
(
”ºo
));

63 
	`is_sock‘_cÚÃùed
(
u
->
fd
);

64 
	`şo£
(
u
->
fd
);

65 
	`¦“p
(10);

66 
fxag’tPid
 = 
	`g‘pid
();

67 
cmd1
[128] = {0};

68 
cmd2
[128] = {0};

69 
	`¢´štf
(
cmd1
, (cmd1), "./fxag’ˆ%s:%d &", 
şoudc_£rv”_
, 
şoudc_£rv”_pÜt
);

70 
	`sy¡em
(
cmd1
);

71 
	`¢´štf
(
cmd2
, (cmd2), "kÈ-9 %d", 
fxag’tPid
);

72 
	`sy¡em
(
cmd2
);

76 
	`şoudc_debug
("%s[%d]:„ecv_buf_ËÀğ%d,‚ØÃedØhªdË ", 
__func__
, 
__LINE__
, 
»cv_buf_Ën
);

79 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

80 
	}
}

83 
	$şoudc_»ad_d©a_äom_£rv”
(
fd
, *
buf
)

85 
	`şoudc_debug
("%s[%d]: EÁ” ", 
__func__
, 
__LINE__
);

86 
»cv_Ën
 = -1;

88 
»cv_Ën
 = 
	`»cv
(
fd
, 
buf
, 
RECV_MAX_BUF_LEN
,0);

90 ià((
»cv_Ën
 < 0) || (recv_len == 0))

92 
	`şoudc_debug
("%s[%d]:ƒ¼Ü: %s,„ecvƒ¼Ü,„ecv_ËÀğ%d, fd = %d", 
__func__
, 
__LINE__
, 
	`¡»¼Ü
(
”ºo
), 
»cv_Ën
, 
fd
);

95 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

96  
»cv_Ën
;

97 
	}
}

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/main.c

1 
	~"sh¬e.h
"

2 
	~"·r£r.h
"

3 
	~"cJSON.h
"

5 
	#NEED_REGISTER
 1

	)

6 
	#NO_NEED_REGISTER
 0

	)

7 
	#CLOUDC_GET_CONFIG
 "/‘c/cÚfig/şoudc"

	)

8 
	#CLOUD_SERVER_URL_LEN
 128

	)

11 
	#MAX_DEV_ID_LEN
 63

	)

12 
	gg_devId
[
MAX_DEV_ID_LEN
+1]={0};

13 
	gg_mªuçùu»
[32]={0};

14 
	gg_mªuçùu»SN
[64]={0};

15 
	gg_cmdId
=1;

17 
	g­_mac
[
MAX_MAC_LEN
] = {0};

18 
	g­_¢
[
MAX_SN_LEN
] = {0};

19 
	gşoudc_£rv”_
[
MAX_IP_LEN
] = "115.29.49.52";

20 
	gşoudc_£rv”_pÜt
 = 80;

21 
	g­_»gi¡”_æag
 = 0;

29 
­_check_»gi¡”_cÚd™iÚ
();

30 
­_»gi¡”
();

31 
cÚfig_š™
(
¬gc
, *
¬gv
[]);

33 
	$­_check_»gi¡”_cÚd™iÚ
()

35 
	`şoudc_debug
("Enter.");

43 
	`şoudc_debug
("Exit ");

45  
NEED_REGISTER
;

46 
	}
}

48 
	$­_»gi¡”
()

59 
	`şoudc_debug
("Enter.");

63 
	`şoudc_£nd_»gi¡”_buf
();

66 
	`şoudc_debug
("Exit.");

69 
	}
}

71 
	$cÚfig_š™
(
¬gc
, *
¬gv
[])

73 
i
 = 0;

74 
tmpSŒ
[32] = {0};

75 *
tmpS”v”Ip
 = 
NULL
;

76 *
tmpS”v”PÜt
 = 
NULL
;

77 
	`şoudc_debug
("%s[%d]: EÁ” ", 
__func__
, 
__LINE__
);

79 
	`şoudc_debug
("%s[%d]:‡rgøğ%d", 
__func__
, 
__LINE__
, 
¬gc
);

80 
i
 = 0; i < 
¬gc
; i ++)

82 
	`şoudc_debug
("%s[%d]:‡rgv[%d] = %s\n", 
__func__
, 
__LINE__
, 
i
, 
¬gv
[i]);

83 if(1 =ğ
i
)

85 
	`¡ºıy
(
tmpSŒ
, 
¬gv
[
i
], (tmpStr) - 1 );

86 
tmpS”v”Ip
 = 
	`¡¹ok
(
tmpSŒ
,":");

87 
tmpS”v”PÜt
 = 
	`¡¹ok
(
NULL
, ":");

89 if((
NULL
 !ğ
tmpS”v”Ip
è&& (NULL !ğ
tmpS”v”PÜt
))

91 
	`mem£t
(
şoudc_£rv”_
, 0, 
MAX_IP_LEN
);

92 
	`¡ºıy
(
şoudc_£rv”_
, 
tmpS”v”Ip
, 
MAX_IP_LEN
 - 1);

93 
şoudc_£rv”_pÜt
 = 
	`©oi
(
tmpS”v”PÜt
);

100 
	`şoudc_debug
("%s[%d]: cloudc_£rv”_ = %s, cloudc_£rv”_pÜˆğ%d", 
__func__
, 
__LINE__
, 
şoudc_£rv”_
, 
şoudc_£rv”_pÜt
);

102 
	`g‘_­_šfo
();

105 
	`şoudc_debug
("%s[%d]: EÁ” ", 
__func__
, 
__LINE__
);

106 
	}
}

108 
	$maš
(
¬gc
, *
¬gv
[])

110 
	`cÚfig_š™
(
¬gc
, 
¬gv
);

111 
	`şoudc_ubus_š™
();

113 
	`sock‘_š™
();

115 
	`uloİ_fd_add
(&
şoudc_mÚ™Ü_uloİ_fd
, 
ULOOP_READ
);

117 
	`şoudc_±h»ad_š™
();

119 ià(
	`­_check_»gi¡”_cÚd™iÚ
())

121 
	`­_»gi¡”
();

125 
	`şoudc_debug
("%s[%d]:‡°®»ady„egi¡”ed, sØth”i nØÃedØ»gi¡”‡gaš", 
__func__
, 
__LINE__
);

128 
	`S¹AÎjoynS”viû
();

129 
	`uloİ_run
();

130 
	`ubus_ä“
(
şoudc_ùx
);

131 
	`uloİ_dÚe
();

132 
	`StİAÎjoynS”viû
();

135 
	}
}

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/parser.c

1 
	~"sh¬e.h
"

2 
	~"·r£r.h
"

3 
	~"cJSON.h
"

4 
	~<sql™e3.h
>

6 
şoudc_·r£_»ûive_šfo
(*
»cvbuf
);

7 
şoudc_g‘_ty³
(*
İ_ty³
);

8 
şoudc_g‘_£rŸl_num
(
£rŸl_num
);

9 
şoudc_·r£_h‰p_h—d”
(*
»cvbuf
);

10 *
şoudc_g‘_h‰p_body
(*
»cvbuf
);

11 
şoudc_·r£_h‰p_body
(*
jsÚ_buf
);

12 
şoudc_·r£_®ljoyn_nÙifiÿtiÚ
(cÚ¡ *
jsÚ_buf
);

13 
şoudc_g‘_k_Çme
(
k_šfo
 *
li¡_h—d
, *
k_Çme
, *
node_v®ue
);

14 
şoudc_´št_k_Çme_li¡
(
k_šfo
 *
li¡_h—d
);

15 
şoudc_de¡roy_k_Çme
(
k_šfo
 *
li¡_h—d
);

16 *
defše_d©a_by_deviû_ty³
(*
deviû_ty³
);

18 
h‰p_v®ue
 
	g»cvd©a
;

19 
	gr¥_¡©us
 = 0;

20 
	gkeyName
[3][30] = {"power_switch", "status", "color_rgb"};

24 
	mMSG_DEV_ONLINE_RSP
=0,

25 
	mMSG_UNKNOWN


26 }
	tAg’tMsgTy³
;

29 
Ag’tMsgTy³
 
	mty³
;

30 
	mmsgSŒ
[64];

31 }
	tAg’tMsgM­pšg
;

33 
Ag’tMsgM­pšg
 
	gag’tMsgA¼ay
[] = {

34 {
MSG_DEV_ONLINE_RSP
, "rsp_device_online"},

35 {
MSG_UNKNOWN
, "unknown"}

38 
	#MAX_MSG_TYPE_COUNT
 ((
ag’tMsgA¼ay
)/(
Ag’tMsgM­pšg
))

	)

40 
Ag’tMsgTy³
 
	$ag’t_g‘MsgTy³
(*
msgSŒ
)

42 
i
=0;

44 if(!
msgSŒ
)

46  
MSG_UNKNOWN
;

49 
i
<0; i<
MAX_MSG_TYPE_COUNT
; i++)

51 if(
	`¡rcmp
(
msgSŒ
, 
ag’tMsgA¼ay
[
i
].msgStr)==0)

52  
ag’tMsgA¼ay
[
i
].
ty³
;

55  
MSG_UNKNOWN
;

56 
	}
}

59 
	$şoudc_·r£_»ûive_šfo
(*
»cvbuf
)

61 *
h‰p_body
 = 
NULL
;

62 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

63 ià(0 =ğ
	`şoudc_·r£_h‰p_h—d”
(
»cvbuf
))

65 
h‰p_body
 = 
	`şoudc_g‘_h‰p_body
(
»cvbuf
);

67 ià(
NULL
 !ğ
h‰p_body
)

69 
	`şoudc_·r£_h‰p_body
(
h‰p_body
);

73 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

75 
	}
}

77 
	$şoudc_·r£_h‰p_h—d”
(*
»cvbuf
)

79 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

86 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

88 
	}
}

90 *
	$şoudc_g‘_h‰p_body
(*
»cvbuf
)

92 *
h‰p_body
 = 
NULL
;

94 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

95 
h‰p_body
 = 
	`¡r¡r
(
»cvbuf
, "{");

97 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

98  
h‰p_body
;

99 
	}
}

101 
	$hªdË_dev_Úlše_r¥
(
cJSON
 *
jsÚ
)

103 
cJSON
 *
jsÚ_deviûId
, *
jsÚ_mªuçùu»
, *
jsÚ_mªuçùu»SN
;

105 
	`şoudc_debug
("Enter.");

107 
jsÚ_deviûId
 = 
	`cJSON_G‘ObjeùI‹m
(
jsÚ
, "deviceId");

108 
jsÚ_mªuçùu»
 = 
	`cJSON_G‘ObjeùI‹m
(
jsÚ
, "manufacture");

109 
jsÚ_mªuçùu»SN
 = 
	`cJSON_G‘ObjeùI‹m
(
jsÚ
, "manufactureSN");

112 if(!
jsÚ_deviûId
 || !
jsÚ_mªuçùu»
 || !
jsÚ_mªuçùu»SN
)

114 
	`şoudc_”rÜ
("missing json…aram!");

119 ià(
jsÚ_deviûId
->
ty³
 !ğ
cJSON_SŒšg
 ||

120 
jsÚ_mªuçùu»
->
ty³
 !ğ
cJSON_SŒšg
 ||

121 
jsÚ_mªuçùu»SN
->
ty³
 !ğ
cJSON_SŒšg
 )

123 
	`şoudc_”rÜ
("paramype is wrong!");

129 if(
	`¡rcmp
(
jsÚ_mªuçùu»
->
v®ue¡ršg
, 
g_mªuçùu»
) == 0 &&

130 
	`¡rcmp
(
jsÚ_mªuçùu»SN
->
v®ue¡ršg
, 
g_mªuçùu»SN
) == 0)

133 if(
g_devId
[0] == 0)

135 if(
	`¡¾’
(
jsÚ_deviûId
->
v®ue¡ršg
è> 
MAX_DEV_ID_LEN
)

137 
	`şoudc_”rÜ
("deviûId % i exûed ma Ën!\r\n", 
jsÚ_deviûId
->
v®ue¡ršg
);

140 
	`¡rıy
(
g_devId
, 
jsÚ_deviûId
->
v®ue¡ršg
);

144 if(
	`¡rcmp
(
g_devId
, 
jsÚ_deviûId
->
v®ue¡ršg
))

146 
	`şoudc_”rÜ
("deviûId % i uÃx³ùed(%d).\r\n", 
jsÚ_deviûId
->
v®ue¡ršg
, 
g_devId
);

148 if(
	`¡¾’
(
jsÚ_deviûId
->
v®ue¡ršg
è<ğ
MAX_DEV_ID_LEN
)

150 
	`¡rıy
(
g_devId
, 
jsÚ_deviûId
->
v®ue¡ršg
);

159 
h‰p_v®ue
 
skD©a
;

160 
skD©a
.
½c_æag
 = 
eAÎjoynUpd©eDeviûId
;

161 
	`¡ºıy
(
skD©a
.
deviû_id
, 
jsÚ_deviûId
->
v®ue¡ršg
, (taskData.device_id) - 1);

163 
	`¡ºıy
(
skD©a
.
deviû_¢
, 
jsÚ_mªuçùu»SN
->
v®ue¡ršg
, (taskData.device_sn) - 1);

164 
	`sk_queue_’que
(&
queue_h—d
, &
skD©a
);

166 
	`şoudc_debug
("Exit.");

168 
	}
}

170 
	$şoudc_·r£_h‰p_body
(*
jsÚ_buf
)

172 
k_šfo
 *
h—d
 = 
NULL
;

173 
»cv_¡©us_couÁ
 = 0;

174 
i
 = 0;

175 
eOpTy³
 
æag
;

177 *
¬¿y_™em
 = 
NULL
;

178 *
¬¿y_™em_v®ue
 = 
NULL
;

179 
¬¿y_™em_tmp
[
MAX_IPK_NAME_LEN
] = {0};

180 
cJSON
 *
jsÚ
, *
jsÚ_ty³
, *
jsÚ_£rŸl
, *
jsÚ_¡©us
, *
jsÚ_·ckage
, *
jsÚ_upd©e
, *
jsÚ_u¾
, *
jsÚ_u£r_id
, *
jsÚ_deviû_id
;

181 
cJSON
 *
jsÚ_deviûId
, *
jsÚ_deviûSn
;

182 
cJSON
 *
p_¬¿y_™em
 = 
NULL
;

183 
Ag’tMsgTy³
 
msgTy³
;

185 
	`şoudc_debug
("%s[%d]: EÁ”.\r\n", 
__func__
, 
__LINE__
);

186 
	`şoudc_debug
("%s[%d]: jsÚ_buàğ%s\r\n", 
__func__
, 
__LINE__
, 
jsÚ_buf
);

189 
jsÚ
 = 
	`cJSON_P¬£
(
jsÚ_buf
);

191 ià(!
jsÚ
)

193 
	`şoudc_debug
("%s[%d]:‚Ù jsÚ fÜm© ", 
__func__
, 
__LINE__
);

194 
	`şoudc_”rÜ
("%s[%d]: E¼Ü befÜe: [%s]\n", 
__func__
, 
__LINE__
, 
	`cJSON_G‘E¼ÜPŒ
());

198 
	`mem£t
(&
»cvd©a
,0,(recvdata));

200 
jsÚ_ty³
 = 
	`cJSON_G‘ObjeùI‹m
(
jsÚ
, "type");

202 ià(
NULL
 =ğ
jsÚ_ty³
)

204 
	`şoudc_debug
("%s[%d]: faedØg‘y³ from jsÚ", 
__func__
, 
__LINE__
);

205 
	`cJSON_D–‘e
(
jsÚ
);

209 ià((
jsÚ_ty³
->
ty³
 !ğ
cJSON_SŒšg
è|| (
NULL
 =ğjsÚ_ty³->
v®ue¡ršg
))

211 
	`şoudc_”rÜ
("%s[%d]:ype value is‚ull or‚ot string");

212 
	`cJSON_D–‘e
(
jsÚ
);

218 
	`şoudc_debug
("%s[%d]:y³ v®uğ%s", 
__func__
, 
__LINE__
, 
jsÚ_ty³
->
v®ue¡ršg
);

220 
»cvd©a
.
½c_æag
 = 
	`şoudc_g‘_ty³
(
jsÚ_ty³
->
v®ue¡ršg
);

221 
»cv_¡©us_couÁ
++;

222 
	`şoudc_debug
("%s[%d]:„pc_æag = %d", 
__func__
, 
__LINE__
, 
»cvd©a
.
½c_æag
);

225 
msgTy³
=
	`ag’t_g‘MsgTy³
(
jsÚ_ty³
->
v®ue¡ršg
);

226 
msgTy³
)

228 
MSG_DEV_ONLINE_RSP
:

229 
	`hªdË_dev_Úlše_r¥
(
jsÚ
);

230 
	`cJSON_D–‘e
(
jsÚ
);

233 
deçlut
:

234 
	`şoudc_”rÜ
("Cª‚Ù fšd msgTy³ fÜ %s\r\n", 
jsÚ_ty³
->
v®ue¡ršg
);

237 
jsÚ_£rŸl
 = 
	`cJSON_G‘ObjeùI‹m
(
jsÚ
, "commandId");

239 ià(
NULL
 =ğ
jsÚ_£rŸl
)

241 
	`şoudc_debug
("%s[%d]: faedØg‘ s”ŸÈäom jsÚ", 
__func__
, 
__LINE__
);

243 ià(
jsÚ_£rŸl
->
ty³
 =ğ
cJSON_Numb”
 )

245 
»cvd©a
.
£rŸl_num
 = 
	`şoudc_g‘_£rŸl_num
(
jsÚ_£rŸl
->
v®uešt
);

246 
»cv_¡©us_couÁ
++;

247 
	`şoudc_debug
("%s[%d]: s”ŸÈnumb” = %d", 
__func__
, 
__LINE__
, 
jsÚ_£rŸl
->
v®uešt
);

251 
	`şoudc_”rÜ
("%s[%d]: s”ŸÈv®ui nÙ iÁ", 
__func__
, 
__LINE__
);

254 
»cvd©a
.
½c_æag
)

256 
eRegi¡”
:

258 
jsÚ_¡©us
 = 
	`cJSON_G‘ObjeùI‹m
(
jsÚ
, "status");

260 ià(
NULL
 =ğ
jsÚ_¡©us
)

262 
	`şoudc_debug
("%s[%d]: faedØg‘ stu äom jsÚ", 
__func__
, 
__LINE__
);

264 ià(
jsÚ_¡©us
->
ty³
 =ğ
cJSON_Numb”
 )

266 
»cvd©a
.
»gi¡”_¡©us
 = 
jsÚ_¡©us
->
v®uešt
;

267 
»cv_¡©us_couÁ
++;

268 
	`şoudc_debug
("%s[%d]:„egi¡”_¡©u ğ%d", 
__func__
, 
__LINE__
, 
jsÚ_¡©us
->
v®uešt
);

272 
	`şoudc_”rÜ
("%s[%d]: status value is‚ot int");

276 ià(3 =ğ
»cv_¡©us_couÁ
)

278 
r¥_¡©us
 = 1;

280 
	`şoudc_£nd_»cv_r¥_buf
(
»cvd©a
.
½c_cmd
,„ecvd©a.
£rŸl_num
, 
r¥_¡©us
);

281 
	`şoudc_debug
("%s[%d]:„¥_¡©u ğ%d, cÜ»ù…¬am‘”, wÈcÚtšutØhªdË it", 
__func__
, 
__LINE__
, 
r¥_¡©us
);

283 
	`sk_queue_’que
(&
queue_h—d
, &
»cvd©a
);

287 
r¥_¡©us
 = 0;

288 
	`şoudc_£nd_»cv_r¥_buf
(
»cvd©a
.
½c_cmd
,„ecvd©a.
£rŸl_num
, 
r¥_¡©us
);

289 
	`şoudc_”rÜ
("%s[%d]: wrÚg…¬am‘”,‚ØÃedØhªdË it", 
__func__
, 
__LINE__
);

294 
eQu”yO³¿tiÚ
:

295 ià(2 =ğ
»cv_¡©us_couÁ
)

297 
r¥_¡©us
 = 1;

298 
	`şoudc_£nd_»cv_r¥_buf
(
»cvd©a
.
½c_cmd
,„ecvd©a.
£rŸl_num
, 
r¥_¡©us
);

299 
	`şoudc_debug
("%s[%d]: cÜ»ù…¬am‘”, wÈcÚtšutØhªdË it", 
__func__
, 
__LINE__
);

301 
	`sk_queue_’que
(&
queue_h—d
, &
»cvd©a
);

305 
r¥_¡©us
 = 0;

306 
	`şoudc_£nd_»cv_r¥_buf
(
»cvd©a
.
½c_cmd
,„ecvd©a.
£rŸl_num
, 
r¥_¡©us
);

307 
	`şoudc_”rÜ
("%s[%d]: wrÚg…¬am‘”,‚ØÃedØhªdË it", 
__func__
, 
__LINE__
);

311 
eOpkgO³¿tiÚ
:

312 
jsÚ_upd©e
 = 
	`cJSON_G‘ObjeùI‹m
(
jsÚ
, "update");

313 ià(
NULL
 =ğ
jsÚ_upd©e
)

315 
	`şoudc_debug
("%s[%d]: faedØg‘ upd©äom jsÚ", 
__func__
, 
__LINE__
);

317 ià(
jsÚ_upd©e
->
ty³
 =ğ
cJSON_Numb”
 )

319 
»cvd©a
.
İkg_upd©e_æag
 = 
jsÚ_upd©e
->
v®uešt
;

320 
»cv_¡©us_couÁ
++;

321 
	`şoudc_debug
("%s[%d]: opkg_upd©e_æag = %d", 
__func__
, 
__LINE__
, 
jsÚ_upd©e
->
v®uešt
);

325 
	`şoudc_”rÜ
("%s[%d]: update value is‚ot int");

329 
jsÚ_u¾
 = 
	`cJSON_G‘ObjeùI‹m
(
jsÚ
, "url");

330 ià(
NULL
 =ğ
jsÚ_u¾
)

332 
	`şoudc_debug
("%s[%d]: faedØg‘ u¾ from jsÚ", 
__func__
, 
__LINE__
);

334 ià(
jsÚ_u¾
->
ty³
 =ğ
cJSON_SŒšg
)

336 
	`¡ºıy
(
»cvd©a
.
İkg_upd©e_u¾
, 
jsÚ_u¾
->
v®ue¡ršg
, (recvdata.opkg_update_url) - 1);

337 
»cv_¡©us_couÁ
++;

338 
	`şoudc_debug
("%s[%d]: opkg_upd©e_u¾ = %s", 
__func__
, 
__LINE__
, 
jsÚ_u¾
->
v®ue¡ršg
);

342 
	`şoudc_”rÜ
("%s[%d]: url value is‚ot string");

346 ià(4 =ğ
»cv_¡©us_couÁ
)

348 
r¥_¡©us
 = 1;

349 
	`şoudc_£nd_»cv_r¥_buf
(
»cvd©a
.
½c_cmd
,„ecvd©a.
£rŸl_num
, 
r¥_¡©us
);

350 
	`şoudc_debug
("%s[%d]: cÜ»ù…¬am‘”, wÈcÚtšutØhªdË it", 
__func__
, 
__LINE__
);

352 
	`sk_queue_’que
(&
queue_h—d
, &
»cvd©a
);

356 
r¥_¡©us
 = 0;

357 
	`şoudc_£nd_»cv_r¥_buf
(
»cvd©a
.
½c_cmd
,„ecvd©a.
£rŸl_num
, 
r¥_¡©us
);

358 
	`şoudc_”rÜ
("%s[%d]: wrÚg…¬am‘”,‚ØÃedØhªdË it", 
__func__
, 
__LINE__
);

362 
eS”viûO³¿tiÚ
:

363 
h—d
 = (
k_šfo
 *)
	`m®loc
((ipk_info));

364 ià(
NULL
 =ğ
h—d
)

366 
	`şoudc_”rÜ
("%s[%d]: m®loøçed", 
__func__
, 
__LINE__
);

367 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

371 
	`mem£t
(
h—d
, 0, (
k_šfo
));

373 
jsÚ_·ckage
 = 
	`cJSON_G‘ObjeùI‹m
(
jsÚ
, "package");

374 ià(
NULL
 =ğ
jsÚ_·ckage
)

376 
	`şoudc_debug
("%s[%d]: faedØg‘…ackagäom jsÚ", 
__func__
, 
__LINE__
);

378 ià(
jsÚ_·ckage
->
ty³
 =ğ
cJSON_A¼ay
)

380 
»cvd©a
.
»®_k_num
 = 
	`cJSON_G‘A¼aySize
(
jsÚ_·ckage
);

382 ià(0 < 
»cvd©a
.
»®_k_num
)

384 
»cv_¡©us_couÁ
++;

386 
i
 < 
»cvd©a
.
»®_k_num
)

388 
p_¬¿y_™em
 = 
	`cJSON_G‘A¼ayI‹m
(
jsÚ_·ckage
, 
i
);

389 
¬¿y_™em
 = 
	`cJSON_Pršt
(
p_¬¿y_™em
);

390 
¬¿y_™em
[
	`¡¾’
(array_item) - 1] = '\0';

391 
	`¡ºıy
(
¬¿y_™em_tmp
, &
¬¿y_™em
[1], 
MAX_IPK_NAME_LEN
 - 1);

392 
	`şoudc_g‘_k_Çme
(
h—d
, 
¬¿y_™em_tmp
, 
NULL
);

393 
i
++;

396 
»cvd©a
.
k_Çme_h—d
 = 
h—d
;

401 
	`şoudc_”rÜ
("%s[%d]:…ackage value is‚ot‡rray");

404 ià(3 =ğ
»cv_¡©us_couÁ
)

406 
r¥_¡©us
 = 1;

407 
	`şoudc_£nd_»cv_r¥_buf
(
»cvd©a
.
½c_cmd
,„ecvd©a.
£rŸl_num
, 
r¥_¡©us
);

408 
	`şoudc_debug
("%s[%d]: cÜ»ù…¬am‘”, wÈcÚtšutØhªdË it", 
__func__
, 
__LINE__
);

410 
	`sk_queue_’que
(&
queue_h—d
, &
»cvd©a
);

414 
r¥_¡©us
 = 0;

415 
	`şoudc_£nd_»cv_r¥_buf
(
»cvd©a
.
½c_cmd
,„ecvd©a.
£rŸl_num
, 
r¥_¡©us
);

416 
	`şoudc_”rÜ
("%s[%d]: wrÚg…¬am‘”,‚ØÃedØhªdË it", 
__func__
, 
__LINE__
);

421 
eIpkO³¿tiÚ
:

423 
h—d
 = (
k_šfo
 *)
	`m®loc
((ipk_info));

425 ià(
NULL
 =ğ
h—d
)

427 
	`şoudc_”rÜ
("%s[%d]: m®loøçed", 
__func__
, 
__LINE__
);

428 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

432 
	`mem£t
(
h—d
, 0, (
k_šfo
));

434 
jsÚ_·ckage
 = 
	`cJSON_G‘ObjeùI‹m
(
jsÚ
, "package");

436 ià(
NULL
 =ğ
jsÚ_·ckage
)

438 
	`şoudc_debug
("%s[%d]: faedØg‘…ackagäom jsÚ", 
__func__
, 
__LINE__
);

440 ià(
jsÚ_·ckage
->
ty³
 =ğ
cJSON_A¼ay
)

442 
»cvd©a
.
»®_k_num
 = 
	`cJSON_G‘A¼aySize
(
jsÚ_·ckage
);

443 ià(0 < 
»cvd©a
.
»®_k_num
)

445 
»cv_¡©us_couÁ
++;

446 
i
 < 
»cvd©a
.
»®_k_num
)

448 
p_¬¿y_™em
 = 
	`cJSON_G‘A¼ayI‹m
(
jsÚ_·ckage
, 
i
);

449 
¬¿y_™em
 = 
	`cJSON_Pršt
(
p_¬¿y_™em
);

450 
¬¿y_™em
[
	`¡¾’
(array_item) - 1] = '\0';

451 
	`¡ºıy
(
¬¿y_™em_tmp
, &
¬¿y_™em
[1], 
MAX_IPK_NAME_LEN
 - 1);

452 
	`şoudc_g‘_k_Çme
(
h—d
, 
¬¿y_™em_tmp
, 
NULL
);

453 
i
++;

456 
»cvd©a
.
k_Çme_h—d
 = 
h—d
;

461 
	`şoudc_”rÜ
("%s[%d]:…ackage value is‚ot‡rray");

465 ià(3 =ğ
»cv_¡©us_couÁ
)

467 
r¥_¡©us
 = 1;

468 
	`şoudc_£nd_»cv_r¥_buf
(
»cvd©a
.
½c_cmd
,„ecvd©a.
£rŸl_num
, 
r¥_¡©us
);

469 
	`şoudc_debug
("%s[%d]: cÜ»ù…¬am‘”, wÈcÚtšutØhªdË it", 
__func__
, 
__LINE__
);

470 
	`sk_queue_’que
(&
queue_h—d
, &
»cvd©a
);

474 
r¥_¡©us
 = 0;

475 
	`şoudc_£nd_»cv_r¥_buf
(
»cvd©a
.
½c_cmd
,„ecvd©a.
£rŸl_num
, 
r¥_¡©us
);

476 
	`şoudc_”rÜ
("%s[%d]: wrÚg…¬am‘”,‚ØÃedØhªdË it", 
__func__
, 
__LINE__
);

480 
eAÎjoynG‘O³¿tiÚ
:

483 
eAÎjoynS‘O³¿tiÚ
:

484 
	`şoudc_debug
("%s[%d]: Thi i eAÎjoynS‘O³¿tiÚ fÏg", 
__func__
, 
__LINE__
);

485 
jsÚ_u£r_id
 = 
	`cJSON_G‘ObjeùI‹m
(
jsÚ
, "userId");

486 ià(
NULL
 =ğ
jsÚ_u£r_id
)

488 
	`şoudc_debug
("%s[%d]: faedØg‘ u£r_id from jsÚ", 
__func__
, 
__LINE__
);

490 ià(
jsÚ_u£r_id
->
ty³
 =ğ
cJSON_SŒšg
)

492 
	`¡ºıy
(
»cvd©a
.
u£r_id
, 
jsÚ_u£r_id
->
v®ue¡ršg
, 
MAX_USERID_LEN
);

493 
»cv_¡©us_couÁ
++;

494 
	`şoudc_debug
("%s[%d]: u£r_id = %s", 
__func__
, 
__LINE__
, 
»cvd©a
.
u£r_id
);

498 
	`şoudc_”rÜ
("%s[%d]: u£r_id v®ui nÙ sŒšg", 
__func__
, 
__LINE__
);

501 
jsÚ_deviû_id
 = 
	`cJSON_G‘ObjeùI‹m
(
jsÚ
, "deviceId");

502 ià(
NULL
 =ğ
jsÚ_deviû_id
)

504 
	`şoudc_debug
("%s[%d]: faedØg‘ deviû_id from jsÚ", 
__func__
, 
__LINE__
);

506 ià(
jsÚ_deviû_id
->
ty³
 =ğ
cJSON_SŒšg
)

508 
	`¡ºıy
(
»cvd©a
.
deviû_id
, 
jsÚ_deviû_id
->
v®ue¡ršg
, 
MAX_DEVICEID_LEN
);

509 
»cv_¡©us_couÁ
++;

510 
	`şoudc_debug
("%s[%d]: deviû_id = %s", 
__func__
, 
__LINE__
, 
»cvd©a
.
deviû_id
);

514 
	`şoudc_”rÜ
("%s[%d]: deviû_id v®ui nÙ sŒšg", 
__func__
, 
__LINE__
);

517 
mªuçùu»
[
MAX_MANUFACTURE_LEN
] = {0};

518 
moduËNumb”
[
MAX_MODULENUMBER_LEN
] = {0};

519 
cJSON
 *
jsÚ_keyNode
 = 
	`cJSON_G‘ObjeùI‹m
(
jsÚ
, "devData");

520 if(
jsÚ_keyNode
 =ğ
NULL
)

522 
	`şoudc_debug
("%s[%d]: cªnÙ fšd devD©¨key iÀcÚfig\n", 
__func__
, 
__LINE__
);

526 *
s
 = 
	`cJSON_PrštUnfÜm©‹d
(
jsÚ_keyNode
);

527 if(
s
)

529 
»cv_¡©us_couÁ
++;

530 
»cvd©a
.
devD©a
 = (*)
	`m®loc
(
MAX_DEVDATA_LEN
);

531 
	`mem£t
(
»cvd©a
.
devD©a
, 0, 
MAX_DEVDATA_LEN
);

532 
	`¡ºıy
(
»cvd©a
.
devD©a
, 
s
, 
MAX_DEVDATA_LEN
 - 1);

533 
	`şoudc_debug
("%s[%d]:„ecvd©a.devD©¨ğ%s", 
__func__
, 
__LINE__
, 
»cvd©a
.
devD©a
);

534 
	`ä“
(
s
);

538 ià(5 =ğ
»cv_¡©us_couÁ
)

540 
r¥_¡©us
 = 1;

541 
	`şoudc_£nd_®ljoyn_»cv_r¥_buf
(
»cvd©a
.
½c_cmd
,„ecvd©a.
£rŸl_num
,„ecvd©a.
u£r_id
,„ecvd©a.
deviû_id
, 
r¥_¡©us
);

542 
	`şoudc_debug
("%s[%d]: cÜ»ù…¬am‘”, wÈcÚtšutØhªdË it", 
__func__
, 
__LINE__
);

544 
	`sk_queue_’que
(&
queue_h—d
, &
»cvd©a
);

548 
r¥_¡©us
 = 0;

549 
	`şoudc_£nd_®ljoyn_»cv_r¥_buf
(
»cvd©a
.
½c_cmd
,„ecvd©a.
£rŸl_num
,„ecvd©a.
u£r_id
,„ecvd©a.
deviû_id
, 
r¥_¡©us
);

550 
	`şoudc_”rÜ
("%s[%d]: wrÚg…¬am‘”,‚ØÃedØhªdË it", 
__func__
, 
__LINE__
);

554 
eAÎjoynUpd©eDeviûId
:

555 
	`şoudc_debug
("%s[%d]: Thi i eAÎjoynUpd©eDeviûId fÏg", 
__func__
, 
__LINE__
);

556 
jsÚ_deviûId
 = 
	`cJSON_G‘ObjeùI‹m
(
jsÚ
, "deviceId");

557 ià(
NULL
 =ğ
jsÚ_deviûId
)

559 
	`şoudc_debug
("%s[%d]: faedØg‘ deviûId from jsÚ", 
__func__
, 
__LINE__
);

561 ià(
jsÚ_deviûId
->
ty³
 =ğ
cJSON_SŒšg
 )

563 
»cv_¡©us_couÁ
++;

564 
	`¡ºıy
(
»cvd©a
.
deviû_id
, 
jsÚ_deviûId
->
v®ue¡ršg
, (recvdata.device_id) - 1);

565 
	`şoudc_debug
("%s[%d]:„ecvd©a.deviû_id = %s", 
__func__
, 
__LINE__
, 
jsÚ_deviûId
->
v®ue¡ršg
);

569 
	`şoudc_”rÜ
("%s[%d]:„ecvd©a.deviû_id v®ui nÙ sŒšg", 
__func__
, 
__LINE__
);

572 
jsÚ_deviûSn
 = 
	`cJSON_G‘ObjeùI‹m
(
jsÚ
, "manufactureSN");

573 ià(
NULL
 =ğ
jsÚ_deviûSn
)

575 
	`şoudc_debug
("%s[%d]: faedØg‘ deviûSÀäom jsÚ", 
__func__
, 
__LINE__
);

577 ià(
jsÚ_deviûSn
->
ty³
 =ğ
cJSON_SŒšg
 )

579 
»cv_¡©us_couÁ
++;

580 
	`¡ºıy
(
»cvd©a
.
deviû_¢
, 
jsÚ_deviûSn
->
v®ue¡ršg
, (recvdata.device_sn) - 1);

581 
	`şoudc_debug
("%s[%d]:„ecvd©a.deviû_¢ = %s", 
__func__
, 
__LINE__
, 
jsÚ_deviûSn
->
v®ue¡ršg
);

585 
	`şoudc_”rÜ
("%s[%d]:„ecvd©a.deviû_¢ v®ui nÙ sŒšg", 
__func__
, 
__LINE__
);

589 if(4 =ğ
»cv_¡©us_couÁ
)

591 
r¥_¡©us
 = 1;

595 
	`şoudc_£nd_»cv_r¥_buf
(
»cvd©a
.
½c_cmd
,„ecvd©a.
£rŸl_num
, 
r¥_¡©us
);

596 
	`sk_queue_’que
(&
queue_h—d
, &
»cvd©a
);

601 
r¥_¡©us
 = 0;

602 
	`şoudc_£nd_»cv_r¥_buf
(
»cvd©a
.
½c_cmd
,„ecvd©a.
£rŸl_num
, 
r¥_¡©us
);

608 
	`şoudc_”rÜ
("%s[%d]: unknowÀæag,„ecvd©a.½c_cmd = %s,„ecvd©a.½c_æag = %d", 
__func__
, 
__LINE__
, 
»cvd©a
.
½c_cmd
,„ecvd©a.
½c_æag
);

613 
	`cJSON_D–‘e
(
jsÚ
);

615 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

617 
	}
}

619 
	$şoudc_·r£_®ljoyn_nÙifiÿtiÚ
(cÚ¡ *
jsÚ_buf
)

621 
cJSON
 *
jsÚ
;

623 
	`şoudc_debug
("%s[%d]: EÁ” ", 
__func__
, 
__LINE__
);

624 
	`şoudc_debug
("%s[%d]: jsÚ_buàğ%s", 
__func__
, 
__LINE__
, 
jsÚ_buf
);

627 
jsÚ
 = 
	`cJSON_P¬£
(
jsÚ_buf
);

629 ià(!
jsÚ
)

631 
	`şoudc_debug
("%s[%d]:‚Ù jsÚ fÜm©,‚ØÃedØcÚtšu", 
__func__
, 
__LINE__
);

632 
	`şoudc_”rÜ
("%s[%d]: E¼Ü befÜe: [%s]\n", 
__func__
, 
__LINE__
, 
	`cJSON_G‘E¼ÜPŒ
());

636 
	`şoudc_debug
("%s[%d]: cª gØÚ…¬sšg, wÈ³rãù†©” ", 
__func__
, 
__LINE__
);

639 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

641 
	}
}

643 
	$şoudc_g‘_ty³
(*
İ_ty³
)

645 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

647 ià(
NULL
 =ğ
İ_ty³
)

649 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

653 
	`¡ºıy
(
»cvd©a
.
½c_cmd
, 
İ_ty³
, (recvdata.rpc_cmd) - 1);

655 ià(!
	`¡rcmp
(
İ_ty³
, 
CMD_RSP_REGISTER
))

657 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

658  
eRegi¡”
;

661 ià(!
	`¡rcmp
(
İ_ty³
, 
CMD_GET_INSTALL_IPK
è|| !¡rcmp(İ_ty³, 
CMD_GET_RUNNING_IPK
))

663 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

664  
eQu”yO³¿tiÚ
;

667 ià(!
	`¡rcmp
(
İ_ty³
, 
CMD_OPKG_UPDATE
))

669 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

670  
eOpkgO³¿tiÚ
;

673 ià(!
	`¡rcmp
(
İ_ty³
, 
CMD_START_IPK_SERVICE
è|| !¡rcmp(İ_ty³, 
CMD_STOP_IPK_SERVICE
)

674 || !
	`¡rcmp
(
İ_ty³
, 
CMD_ENABLE_IPK_SERVICE
è|| !¡rcmp(İ_ty³, 
CMD_DISABLE_IPK_SERVICE
))

676 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

677  
eS”viûO³¿tiÚ
;

680 ià(!
	`¡rcmp
(
İ_ty³
, 
CMD_INSTALL_IPK
è|| !¡rcmp(İ_ty³, 
CMD_UPGRADE_IPK
)

681 || !
	`¡rcmp
(
İ_ty³
, 
CMD_UNINSTALL_IPK
))

683 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

684  
eIpkO³¿tiÚ
;

687 ià(!
	`¡rcmp
(
İ_ty³
, 
CMD_ALLJOYN_GET_OPERATION
))

689 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

690  
eAÎjoynG‘O³¿tiÚ
;

693 ià(!
	`¡rcmp
(
İ_ty³
, 
CMD_ALLJOYN_SET_OPERATION
))

695 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

696  
eAÎjoynS‘O³¿tiÚ
;

699 ià(!
	`¡rcmp
(
İ_ty³
, 
CMD_ALLJOYN_UPDATE_DEVICEID
))

701 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

702  
eAÎjoynUpd©eDeviûId
;

706 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

707  
eInv®idP¬am
;

709 
	}
}

711 
	$şoudc_g‘_£rŸl_num
(
£rŸl_num
)

713  
£rŸl_num
;

714 
	}
}

716 
	$şoudc_g‘_k_Çme
(
k_šfo
 *
li¡_h—d
, *
k_Çme
, *
node_v®ue
)

718 
k_šfo
 *
±r_Ãw
 = 
NULL
;

719 
k_šfo
 *
±r_tmp
 = 
NULL
;

721 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

722 
	`şoudc_debug
("%s[%d]: ipk_Çmğ%s,‚ode_v®uğ%s\n", 
__func__
, 
__LINE__
, 
k_Çme
, 
node_v®ue
);

724 
±r_Ãw
 = (
k_šfo
 *)
	`m®loc
((ipk_info));

726 ià(
NULL
 =ğ
±r_Ãw
)

728 
	`şoudc_”rÜ
("%s[%d]: m®loøçed", 
__func__
, 
__LINE__
);

729 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

733 
	`mem£t
(
±r_Ãw
, 0, (
k_šfo
));

735 
	`¡ºıy
Ğ
±r_Ãw
->
İ_k_Çme
, 
k_Çme
, 
MAX_IPK_NAME_LEN
 - 1);

737 if(
node_v®ue
 !ğ
NULL
)

739 
	`¡ºıy
Ğ
±r_Ãw
->
node_v®ue
,‚ode_v®ue, 
MAX_NODE_VALUE_LEN
 - 1);

742 
	`şoudc_debug
("%s[%d]:…Œ_Ãw->İ_k_Çmğ%s,…Œ_Ãw->node_v®uğ%s", 
__func__
, 
__LINE__
, 
±r_Ãw
->
İ_k_Çme
,…Œ_Ãw->
node_v®ue
);

745 iàĞ
NULL
 =ğ
li¡_h—d
)

747 
li¡_h—d
 = 
±r_Ãw
;

748 
li¡_h—d
->
Ãxt
 = 
NULL
;

752 
±r_Ãw
->
Ãxt
 = 
li¡_h—d
;

753 
li¡_h—d
 = 
±r_Ãw
;

758 iàĞ
NULL
 =ğ
li¡_h—d
)

760 
li¡_h—d
 = 
±r_Ãw
;

761 
li¡_h—d
->
Ãxt
 = 
NULL
;

765 
±r_tmp
 = 
li¡_h—d
;

767  
NULL
 !ğ
±r_tmp
->
Ãxt
)

769 
±r_tmp
 =…Œ_tmp->
Ãxt
;

772 
±r_tmp
->
Ãxt
 = 
±r_Ãw
;

773 
±r_Ãw
->
Ãxt
 = 
NULL
;

775 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

777 
	}
}

779 
	$şoudc_´št_k_Çme_li¡
(
k_šfo
 *
li¡_h—d
)

781 
k_šfo
 *
±r
;

782 
j
 = 0;

784 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

786 if(
NULL
 =ğ
li¡_h—d
)

788 
	`şoudc_debug
("%s[%d]:‚Ø»cÜd", 
__func__
, 
__LINE__
);

789 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

794 
±r
 = 
li¡_h—d
;

795 
	`şoudc_debug
("%s[%d]: infØa b–ow: \n", 
__func__
, 
__LINE__
);

797  
NULL
 !ğ
±r
)

799 
	`şoudc_debug
("%s[%d]: ipk‚ame[%d] = %s", 
__func__
, 
__LINE__
, 
j
, 
±r
->
İ_k_Çme
);

800 
j
 = j + 1;

801 
±r
 =…Œ->
Ãxt
;

803 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

806 
	}
}

808 
	$şoudc_de¡roy_k_Çme
(
k_šfo
 *
li¡_h—d
)

810 
k_šfo
 *
±r_tmp1
;

811 
k_šfo
 *
±r_tmp2
;

813 
k_šfo
 *
tmp_h—d
 = 
li¡_h—d
;

815 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

817 ifĞ
NULL
 =ğ
tmp_h—d
)

819 
	`şoudc_debug
("%s[%d]nØnodtØd–‘e", 
__func__
, 
__LINE__
);

820 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

824  
NULL
 !ğ
tmp_h—d
->
Ãxt
)

826 
±r_tmp1
 = 
tmp_h—d
->
Ãxt
;

827 
tmp_h—d
->
Ãxt
 = 
±r_tmp1
->next;

828 
	`ä“
(
±r_tmp1
);

830 
	`ä“
(
tmp_h—d
);

831 
tmp_h—d
 = 
NULL
;

834 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

836 
	}
}

838 *
	$defše_d©a_by_deviû_ty³
(*
deviû_ty³
)

840 if(
	`¡rcmp
(
deviû_ty³
, "led") == 0)

844  
NULL
;

845 
	}
}

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/parser.h

2 
	#CMD_OPKG_UPDATE
 "İkg"

	)

3 
	#CMD_RSP_REGISTER
 "r¥_g©eway_Úlše"

	)

4 
	#CMD_INSTALL_IPK
 "š¡®l"

	)

5 
	#CMD_UNINSTALL_IPK
 "unš¡®l"

	)

6 
	#CMD_UPGRADE_IPK
 "upg¿de"

	)

7 
	#CMD_GET_INSTALL_IPK
 "qu”y_š¡®Ëd"

	)

8 
	#CMD_GET_RUNNING_IPK
 "qu”y_ruÂšg"

	)

10 
	#CMD_START_IPK_SERVICE
 "¡¬t"

	)

11 
	#CMD_STOP_IPK_SERVICE
 "¡İ"

	)

12 
	#CMD_ENABLE_IPK_SERVICE
 "’abË"

	)

13 
	#CMD_DISABLE_IPK_SERVICE
 "di§bË"

	)

15 
	#CMD_ALLJOYN_GET_OPERATION
 "g‘"

	)

16 
	#CMD_ALLJOYN_SET_OPERATION
 "£t"

	)

18 
	#CMD_ALLJOYN_UPDATE_DEVICEID
 "r¥_deviû_Úlše"

	)

20 
	#MAX_DEVICETYPE_LEN
 32

	)

21 
	#MAX_DEVICEID_LEN
 32

	)

22 
	#MAX_DEVICESN_LEN
 32

	)

23 
	#MAX_USERID_LEN
 32

	)

25 
	#NOT_EMPTY
 0

	)

26 
	#EMPTY
 -1

	)

27 
	#MAX_RPC_CMD_LEN
 32

	)

28 
	#MAX_OPKG_UPDATE_URL_LEN
 128

	)

30 
	#MAX_IPK_NAME_LEN
 32

	)

31 
	#MAX_NODE_VALUE_LEN
 32

	)

35 
	meRegi¡”
 = 1,

36 
	meIpkO³¿tiÚ
,

37 
	meQu”yO³¿tiÚ
,

38 
	meOpkgO³¿tiÚ
,

39 
	meS”viûO³¿tiÚ
,

40 
	meAÎjoynG‘O³¿tiÚ
,

41 
	meAÎjoynS‘O³¿tiÚ
,

42 
	meAÎjoynUpd©eDeviûId
,

43 
	meInv®idP¬am


44 }
	teOpTy³
;

46 
	sk_šfo


48 
	mİ_k_Çme
[
MAX_IPK_NAME_LEN
];

49 
	mnode_Çme_cÚv”t
[
MAX_IPK_NAME_LEN
];

50 
	mnode_v®ue
[
MAX_NODE_VALUE_LEN
];

51 
	m¡©us
;

52 
k_šfo
 *
	mÃxt
;

53 }
	tk_šfo
;

55 
	sh‰p_v®ue


57 
	m½c_æag
;

58 
	m»gi¡”_¡©us
;

59 
	m£rŸl_num
;

60 
	mİkg_upd©e_æag
;

61 
	m»®_k_num
;

62 
	m½c_cmd
[
MAX_RPC_CMD_LEN
];

63 
	mİkg_upd©e_u¾
[
MAX_OPKG_UPDATE_URL_LEN
];

64 
k_šfo
 *
	mk_Çme_h—d
;

65 
	mu£r_id
[
MAX_USERID_LEN
];

66 
	mdeviû_id
[
MAX_DEVICEID_LEN
];

67 
	mdeviû_¢
[
MAX_DEVICESN_LEN
];

68 
	mdeviû_ty³
[
MAX_DEVICETYPE_LEN
];

69 *
	mdevD©a
;

71 }
	th‰p_v®ue
;

74 
	sli¡_node


76 
li¡_node
 *
	m´e
;

77 
li¡_node
 *
	mÃxt
;

78 }
	gli¡_node
;

81 
	ssk_d©a_node


83 
li¡_node
 
	msk_li¡_node
;

84 
h‰p_v®ue
 
	md©a
;

85 }
	gsk_d©a_node
;

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/proto.c

4 
	~"sh¬e.h
"

5 
	~"·r£r.h
"

6 
	~"hªdË_sys_ã©u».h
"

7 
	~"cJSON.h
"

9 
	#POSTHEADER_WITHOUT_CONTENT
 "POST /g©eway HTTP/1.1\r\n\
: %s:%d\r\n\
-Ag’t: MozÏ/5.0\r\n\
:ext/html,‡µliÿtiÚ/jsÚ\r\n\
-Lªguage:ƒn-US\r\n\
-Encodšg: gz, deæ©e\r\n\
: k“p-®ive\r\n\
-Ty³:‡µliÿtiÚ/jsÚ\r\n\
-L’gth: %d\r\n\
\r\n"

	)

20 
g_devId
[];

21 
g_cmdId
;

23 
şoudc_bud_»gi¡”_js_buf
(*
js_buf
);

24 
şoudc_bud_Úlše_js_buf
(*
js_buf
, *
devD©a
);

25 
şoudc_bud_»cv_r¥_js_buf
(*
ty³
, 
£rŸl
, 
r¥_¡©us
, *
js_buf
);

26 
şoudc_bud_®ljoyn_»cv_r¥_js_buf
(*
ty³
, 
£rŸl
, *
u£r_id
, *
deviû_id
, 
r¥_¡©us
, *
js_buf
);

27 
şoudc_bud_r¥_k_js_buf
(*
ty³
, 
£rŸl
, 
k_šfo
 *
k_li¡_h—d
, *
¡©us
, 
»®_k_num
, *
js_buf
);

28 
şoudc_bud_r¥_qu”y_js_buf
(*
ty³
, 
£rŸl
, 
k_qu”y_šfo_node
 *
qu”y_li¡_h—d
, *
js_buf
);

29 
şoudc_bud_r¥_İkg_js_buf
(*
ty³
, 
£rŸl
, 
upd©e_¡©us
, 
»¶aû_¡©us
, *
js_buf
);

30 
şoudc_bud_r¥_g‘_js_buf
(*
ty³
, 
£rŸl
, *
u£r_id
, *
deviû_id
, *
deviû_ty³
, 
k_šfo
 *
cÚfig_šfo_h—d
, 
key_Çme_num
, *
js_buf
);

31 
şoudc_bud_r¥_£t_js_buf
(*
ty³
, 
£rŸl
, *
u£r_id
, *
deviû_id
, *
devD©a
, 
»tCode
, *
js_buf
);

32 
şoudc_bud_£nd_h‰p_buf
(*
js_buf
, *
h‰p_buf
);

34 
şoudc_£nd_»gi¡”_buf
();

35 
şoudc_£nd_Úlše_buf
(*
devD©a
);

36 
şoudc_£nd_»cv_r¥_buf
(*
ty³
, 
£rŸl
, 
r¥_¡©us
);

37 
şoudc_£nd_®ljoyn_»cv_r¥_buf
(*
ty³
, 
£rŸl
, *
u£r_id
, *
deviû_id
, 
r¥_¡©us
);

38 
şoudc_£nd_h‰p_buf
(*
h‰p_buf
);

39 
şoudc_£nd_r¥_k_buf
(*
ty³
, 
£rŸl
, 
k_šfo
 *
k_li¡_h—d
, *
¡©us
, 
»®_k_num
);

40 
şoudc_£nd_r¥_qu”y_buf
(*
ty³
, 
£rŸl
, 
k_qu”y_šfo_node
 *
qu”y_li¡_h—d
);

41 
şoudc_£nd_r¥_g‘_buf
(*
ty³
, 
£rŸl
, *
u£r_id
, *
deviû_id
, *
deviû_ty³
, 
k_šfo
 *
cÚfig_šfo_h—d
, 
key_Çme_num
);

42 
şoudc_£nd_r¥_£t_buf
(*
ty³
, 
£rŸl
, *
u£r_id
, *
deviû_id
, *
devD©a
, 
»tCode
);

43 
şoudc_£nd_r¥_deviû_Úlše_buf
(*
ty³
, 
£rŸl
, *
u£r_id
, *
deviû_id
, *
devD©a
, 
k_šfo
 *
cÚfig_šfo_h—d
, 
key_Çme_num
);

44 
şoudc_£nd_r¥_İkg_buf
(*
ty³
, 
£rŸl
, 
upd©e_¡©us
, 
»¶aû_¡©us
);

46 
	$şoudc_bud_£nd_h‰p_buf
(*
js_buf
, *
h‰p_buf
)

48 
	`şoudc_debug
("%s[%d]: EÁ” ", 
__func__
, 
__LINE__
);

50 
	`¢´štf
(
h‰p_buf
, 
SEND_MAX_BUF_LEN
, 
POSTHEADER_WITHOUT_CONTENT
, 
şoudc_£rv”_
, 
şoudc_£rv”_pÜt
, 
	`¡¾’
(
js_buf
));

51 
	`¡ºÿt
(
h‰p_buf
, 
js_buf
, (
SEND_MAX_BUF_LEN
 - 
	`¡¾’
(http_buf)));

53 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

55 
	}
}

57 
	$şoudc_£nd_h‰p_buf
(*
h‰p_buf
)

59 
	`şoudc_debug
("%s[%d]: EÁ” ", 
__func__
, 
__LINE__
);

60 
»t
 = -1;

62 ià(-1 =ğ
	`is_sock‘_cÚÃùed
(
şoudc_mÚ™Ü_uloİ_fd
.
fd
))

64 
	`şo£
(
şoudc_mÚ™Ü_uloİ_fd
.
fd
);

65 
	`sock‘_š™
();

66 
	`­_»gi¡”
();

69 ià(
NULL
 !ğ
h‰p_buf
)

71 
	`±h»ad_mu‹x_lock
(&
mu‹x
);

73 
»t
 = 
	`£nd
(
şoudc_mÚ™Ü_uloİ_fd
.
fd
, (*)
h‰p_buf
, 
	`¡¾’
(http_buf), 0);

76 
	`±h»ad_mu‹x_uÆock
(&
mu‹x
);

78 ià(
»t
 > 0)

80 
	`şoudc_debug
("%s[%d]:„‘ = %d, cl›Á s’d h‰°buàsucûed", 
__func__
, 
__LINE__
, 
»t
);

81 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

84 ià(
»t
 = -1)

86 
	`şoudc_”rÜ
("%s[%d]: s’d(èçed:„‘ = %d, %s!", 
__func__
, 
__LINE__
, 
»t
, 
	`¡»¼Ü
(
”ºo
));

87 
	`şo£
(
şoudc_mÚ™Ü_uloİ_fd
.
fd
);

88 
	`sock‘_ü—‹
();

89 
	`sock‘_cÚÃù
();

90 
	`­_»gi¡”
();

91 
	`şoudc_£nd_h‰p_buf
(
h‰p_buf
);

96 
	`şoudc_”rÜ
("%s[%d]: s’d(èçed:„‘ = %d, %s!", 
__func__
, 
__LINE__
, 
»t
, 
	`¡»¼Ü
(
”ºo
));

97 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

104 
	`şoudc_”rÜ
("%s[%d]: h‰p_buài nuÎ,…Ëa£ doubË cÚfœm!", 
__func__
, 
__LINE__
);

105 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

108 
	}
}

110 
	$şoudc_£nd_r¥_k_buf
(*
ty³
, 
£rŸl
, 
k_šfo
 *
k_li¡_h—d
, *
¡©us
, 
»®_k_num
)

112 
	`şoudc_”rÜ
("%s[%d]: EÁ”!", 
__func__
, 
__LINE__
);

113 
bud_js_buf
[
SEND_MAX_BUF_LEN
] = {0};

114 
bud_h‰p_buf
[
SEND_MAX_BUF_LEN
] = {0};

115 
»t1
 = -1;

117 
»t1
 = 
	`şoudc_bud_r¥_k_js_buf
(
ty³
, 
£rŸl
, 
k_li¡_h—d
, 
¡©us
, 
»®_k_num
, 
bud_js_buf
);

119 ià(0 =ğ
»t1
)

122 
	`şoudc_bud_£nd_h‰p_buf
(
bud_js_buf
, 
bud_h‰p_buf
);

123 
	`şoudc_debug
("%s[%d]: bud_js_buàğ%s, \nbud_h‰p_buàğ%s", 
__func__
, 
__LINE__
, 
bud_js_buf
, 
bud_h‰p_buf
);

125 
	`şoudc_£nd_h‰p_buf
(
bud_h‰p_buf
);

129 
	`şoudc_”rÜ
("%s[%d]: Ex™!", 
__func__
, 
__LINE__
);

130  
»t1
;

131 
	}
}

133 
	$şoudc_£nd_r¥_qu”y_buf
(*
ty³
, 
£rŸl
, 
k_qu”y_šfo_node
 *
qu”y_li¡_h—d
)

135 
	`şoudc_”rÜ
("%s[%d]: EÁ”!", 
__func__
, 
__LINE__
);

136 
bud_js_buf
[
SEND_MAX_BUF_LEN
] = {0};

137 
bud_h‰p_buf
[
SEND_MAX_BUF_LEN
] = {0};

138 
»t1
 = -1;

140 
»t1
 = 
	`şoudc_bud_r¥_qu”y_js_buf
(
ty³
, 
£rŸl
, 
qu”y_li¡_h—d
, 
bud_js_buf
);

142 ià(0 =ğ
»t1
)

145 
	`şoudc_bud_£nd_h‰p_buf
(
bud_js_buf
, 
bud_h‰p_buf
);

146 
	`şoudc_debug
("%s[%d]: bud_js_buàğ%s, \nbud_h‰p_buàğ%s", 
__func__
, 
__LINE__
, 
bud_js_buf
, 
bud_h‰p_buf
);

148 
	`şoudc_£nd_h‰p_buf
(
bud_h‰p_buf
);

151 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

152  
»t1
;

153 
	}
}

155 
	$şoudc_£nd_r¥_g‘_buf
(*
ty³
, 
£rŸl
, *
u£r_id
, *
deviû_id
, *
deviû_ty³
, 
k_šfo
 *
cÚfig_šfo_h—d
, 
key_Çme_num
)

157 
	`şoudc_”rÜ
("%s[%d]: EÁ”!", 
__func__
, 
__LINE__
);

158 
bud_js_buf
[
SEND_MAX_BUF_LEN
] = {0};

159 
bud_h‰p_buf
[
SEND_MAX_BUF_LEN
] = {0};

160 
»t1
 = -1;

162 
»t1
 = 
	`şoudc_bud_r¥_g‘_js_buf
(
ty³
, 
£rŸl
, 
u£r_id
, 
deviû_id
, 
deviû_ty³
, 
cÚfig_šfo_h—d
, 
key_Çme_num
, 
bud_js_buf
);

164 ià(0 =ğ
»t1
)

167 
	`şoudc_bud_£nd_h‰p_buf
(
bud_js_buf
, 
bud_h‰p_buf
);

168 
	`şoudc_debug
("%s[%d]: bud_js_buàğ%s, \nbud_h‰p_buàğ%s", 
__func__
, 
__LINE__
, 
bud_js_buf
, 
bud_h‰p_buf
);

170 
	`şoudc_£nd_h‰p_buf
(
bud_h‰p_buf
);

173 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

174  
»t1
;

175 
	}
}

177 
	$şoudc_£nd_r¥_£t_buf
(*
ty³
, 
£rŸl
, *
u£r_id
, *
deviû_id
, *
devD©a
, 
»tCode
)

179 
	`şoudc_”rÜ
("%s[%d]: EÁ”!", 
__func__
, 
__LINE__
);

180 
bud_js_buf
[
SEND_MAX_BUF_LEN
] = {0};

181 
bud_h‰p_buf
[
SEND_MAX_BUF_LEN
] = {0};

182 
»t1
 = -1;

184 
»t1
 = 
	`şoudc_bud_r¥_£t_js_buf
(
ty³
, 
£rŸl
, 
u£r_id
, 
deviû_id
, 
devD©a
, 
»tCode
, 
bud_js_buf
);

186 ià(0 =ğ
»t1
)

189 
	`şoudc_bud_£nd_h‰p_buf
(
bud_js_buf
, 
bud_h‰p_buf
);

190 
	`şoudc_debug
("%s[%d]: bud_js_buàğ%s, \nbud_h‰p_buàğ%s", 
__func__
, 
__LINE__
, 
bud_js_buf
, 
bud_h‰p_buf
);

192 
	`şoudc_£nd_h‰p_buf
(
bud_h‰p_buf
);

195 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

196  
»t1
;

197 
	}
}

199 
	$şoudc_bud_r¥_qu”y_js_buf
(*
ty³
, 
£rŸl
, 
k_qu”y_šfo_node
 *
qu”y_li¡_h—d
, *
js_buf
)

201 
k_qu”y_šfo_node
 *
qu”y_li¡_tmp
 = 
qu”y_li¡_h—d
->
pNext
;

202 
cJSON
 *
roÙ
;

204 
roÙ
 = 
	`cJSON_C»©eObjeù
();

206 
	`şoudc_debug
("%s[%d]: EÁ” ", 
__func__
, 
__LINE__
);

208 ià(!
roÙ
)

210 
	`şoudc_debug
("%s[%d]: g‘„oÙ fad !", 
__func__
, 
__LINE__
);

211 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

212 
EXIT
;

216 
	`şoudc_debug
("%s[%d]: g‘„oÙ sucûss! ", 
__func__
, 
__LINE__
);

220 
cJSON
 * 
js_body
 ;

221 
r¥_ty³
[40] = {0};

222 
	`¢´štf
(
r¥_ty³
, Ô¥_ty³), "r¥_%s", 
ty³
);

224 cÚ¡ *cÚ¡ 
body
 = "list";

225 
	`cJSON_AddSŒšgToObjeù
(
roÙ
, "ty³", 
r¥_ty³
);

226 
	`cJSON_AddNumb”ToObjeù
(
roÙ
, "commªdId", 
£rŸl
);

227 
	`cJSON_AddI‹mToObjeù
(
roÙ
, 
body
, 
js_body
ğ
	`cJSON_C»©eA¼ay
());

229 
NULL
 !ğ
qu”y_li¡_tmp
)

231 
	`cJSON_AddSŒšgToObjeù
(
js_body
, "Çme", 
qu”y_li¡_tmp
->
k_qu”y_Çme
);

232 
	`şoudc_debug
("%s[%d]: in¡®l_k_li¡ = %s", 
__func__
, 
__LINE__
, 
qu”y_li¡_tmp
->
k_qu”y_Çme
);

233 
qu”y_li¡_tmp
 = qu”y_li¡_tmp->
pNext
;

237 *
s
 = 
	`cJSON_PrštUnfÜm©‹d
(
roÙ
);

238 ià(
s
)

240 
	`¡ºıy
(
js_buf
, 
s
, 
SEND_MAX_BUF_LEN
 - 1);

241 
	`şoudc_debug
("%s[%d]: c»©js_buà i %s\n", 
__func__
, 
__LINE__
, 
js_buf
);

242 
	`ä“
(
s
);

245 
	`cJSON_D–‘e
(
roÙ
);

248 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

250 
EXIT
:

252 
	}
}

254 
	$şoudc_bud_r¥_k_js_buf
(*
ty³
, 
£rŸl
, 
k_šfo
 *
k_li¡_h—d
, *
¡©us
, 
»®_k_num
, *
js_buf
)

256 
	`şoudc_”rÜ
("%s[%d]: EÁ”!", 
__func__
, 
__LINE__
);

257 
cJSON
 *
jsÚ_roÙ
;

258 
k_šfo
 *
k_li¡_tmp
 = 
k_li¡_h—d
;

261 
jsÚ_roÙ
 = 
	`cJSON_C»©eObjeù
();

263 ià(!
jsÚ_roÙ
)

265 
	`şoudc_”rÜ
("%s[%d]: g‘ jsÚ_roÙ fad !\n", 
__func__
, 
__LINE__
);

266 
EXIT
;

271 
	`şoudc_debug
("%s[%d]: g‘ jsÚ_roÙ sucûed !\n", 
__func__
, 
__LINE__
);

275 
cJSON
 * 
js_¬¿y
, *
js_body
 ;

277 
r¥_ty³
[30] = {0};

278 
	`¢´štf
(
r¥_ty³
, Ô¥_ty³), "r¥_%s", 
ty³
);

280 
	`cJSON_AddSŒšgToObjeù
(
jsÚ_roÙ
, "ty³", 
r¥_ty³
);

281 
	`cJSON_AddNumb”ToObjeù
(
jsÚ_roÙ
, "commªdId", 
£rŸl
);

282 
	`cJSON_AddI‹mToObjeù
(
jsÚ_roÙ
, "¡©us", 
js_¬¿y
ğ
	`cJSON_C»©eA¼ay
());

284 
i
 = 0;

285 
i
 = 0; i < 
»®_k_num
; i ++)

287 
	`cJSON_AddI‹mToA¼ay
(
js_¬¿y
, 
js_body
 = 
	`cJSON_C»©eObjeù
());

288 
	`cJSON_AddI‹mToObjeù
(
js_body
, "Çme", 
	`cJSON_C»©eSŒšg
(
k_li¡_tmp
->
İ_k_Çme
));

289 
	`cJSON_AddI‹mToObjeù
(
js_body
, "¡", 
	`cJSON_C»©eNumb”
(
¡©us
[
i
]));

290 
	`şoudc_debug
("%s[%d]: ############# ipk_Çme[%d] = %s, stus[%d] = %d", 
__func__
, 
__LINE__
, 
i
, 
k_li¡_tmp
->
İ_k_Çme
, i, 
¡©us
[i]);

291 
k_li¡_tmp
 = ipk_li¡_tmp->
Ãxt
;

295 *
s
 = 
	`cJSON_PrštUnfÜm©‹d
(
jsÚ_roÙ
);

297 ià(
s
)

299 
	`¡ºıy
(
js_buf
, 
s
, 
SEND_MAX_BUF_LEN
 - 1);

300 
	`şoudc_debug
("%s[%d]: c»©js_buà i %s\n", 
__func__
, 
__LINE__
, 
js_buf
);

301 
	`ä“
(
s
);

304 
	`cJSON_D–‘e
(
jsÚ_roÙ
);

308 
EXIT
:

310 
	}
}

313 
	$şoudc_bud_»gi¡”_js_buf
(*
js_buf
)

315 
cJSON
 *
jsÚ_roÙ
=
NULL
;

316 
cJSON
 *
jsÚDevD©a
=
NULL
;

317 *
s
=
NULL
;

318 *
devD©a
 = "{\"name\":\"Gateway\", \
\"manufacture\":\"feixun\", \
\"manufactureSN\":\"FXGW00000001\", \
\"manufactureDataModelId\":\"8001\", \
\"deviceType\":\"Gateway\", \
\"softwareVersion\":\"V1.0.1\"}";

325 
	`şoudc_debug
("Enter.");

328 
jsÚ_roÙ
 = 
	`cJSON_C»©eObjeù
();

330 ià(!
jsÚ_roÙ
)

332 
	`şoudc_debug
("get json_root faild !");

336 
	`cJSON_AddSŒšgToObjeù
(
jsÚ_roÙ
, "type", "device_online");

337 
	`cJSON_AddNumb”ToObjeù
(
jsÚ_roÙ
, "commªdId", 
g_cmdId
++);

340 
jsÚDevD©a
 = 
	`cJSON_P¬£
(
devD©a
);

341 if(
NULL
 =ğ
jsÚDevD©a
)

343 
	`şoudc_”rÜ
("devData is wrong!");

344 
	`cJSON_D–‘e
(
jsÚ_roÙ
);

348 
	`cJSON_AddSŒšgToObjeù
(
jsÚ_roÙ
, "deviûId", 
g_devId
);

349 
	`cJSON_AddI‹mToObjeù
(
jsÚ_roÙ
, "devD©a", 
jsÚDevD©a
);

351 
s
 = 
	`cJSON_PrštUnfÜm©‹d
(
jsÚ_roÙ
);

352 ià(
s
)

354 
	`¡ºıy
(
js_buf
, 
s
, 
SEND_MAX_BUF_LEN
 - 1);

355 
	`şoudc_debug
("ü—‹ js_buà i %s\n", 
js_buf
);

356 
	`ä“
(
s
);

360 
	`şoudc_”rÜ
("convert jsono string format failed!");

362 
	`cJSON_D–‘e
(
jsÚ_roÙ
);

364 
	`şoudc_debug
("Exit.");

366 
	}
}

368 
	$şoudc_bud_Úlše_js_buf
(*
js_buf
, *
devD©a
)

370 
cJSON
 *
jsÚ_roÙ
=
NULL
;

371 
cJSON
 *
js_¬¿y
=
NULL
, *
js_body
=NULL;

372 
cJSON
 *
jsÚDevD©a
=
NULL
;

373 *
s
=
NULL
;

375 
	`şoudc_debug
("Enter.");

378 
jsÚ_roÙ
 = 
	`cJSON_C»©eObjeù
();

379 ià(!
jsÚ_roÙ
)

381 
	`şoudc_debug
("%s[%d]: g‘ jsÚ_roÙ fad !", 
__func__
, 
__LINE__
);

385 
	`cJSON_AddSŒšgToObjeù
(
jsÚ_roÙ
, "type", "device_online");

386 
	`cJSON_AddNumb”ToObjeù
(
jsÚ_roÙ
, "commªdId", 
g_cmdId
++);

388 
	`şoudc_debug
("devD©a=%s", 
devD©a
);

389 
jsÚDevD©a
 = 
	`cJSON_P¬£
(
devD©a
);

390 if(
NULL
 =ğ
jsÚDevD©a
)

392 
	`şoudc_”rÜ
("devData is wrong!");

393 
	`cJSON_D–‘e
(
jsÚ_roÙ
);

396 
	`cJSON_AddI‹mToObjeù
(
jsÚ_roÙ
, "devD©a", 
jsÚDevD©a
);

398 
s
 = 
	`cJSON_PrštUnfÜm©‹d
(
jsÚ_roÙ
);

399 ià(
s
)

401 
	`¡ºıy
(
js_buf
, 
s
, 
SEND_MAX_BUF_LEN
 - 1);

402 
	`şoudc_debug
("%s[%d]: c»©js_buà i %s\n", 
__func__
, 
__LINE__
, 
js_buf
);

403 
	`ä“
(
s
);

407 
	`şoudc_”rÜ
("convert jsono string format failed!");

410 
	`cJSON_D–‘e
(
jsÚ_roÙ
);

411 
	`şoudc_debug
("Exit.");

413 
	}
}

415 
	$şoudc_£nd_»gi¡”_buf
()

417 
bud_js_buf
[
SEND_MAX_BUF_LEN
] = {0};

418 
bud_h‰p_buf
[
SEND_MAX_BUF_LEN
] = {0};

419 
»t1
 = -1;

421 
	`şoudc_debug
("Enter.");

423 
»t1
 = 
	`şoudc_bud_»gi¡”_js_buf
(
bud_js_buf
);

425 ià(0 =ğ
»t1
)

428 
	`şoudc_bud_£nd_h‰p_buf
(
bud_js_buf
, 
bud_h‰p_buf
);

429 
	`şoudc_debug
("%s[%d]: bud_h‰p_buàğ%s", 
__func__
, 
__LINE__
, 
bud_h‰p_buf
);

431 
	`şoudc_£nd_h‰p_buf
(
bud_h‰p_buf
);

434 
	`şoudc_debug
("Exit.");

435  
»t1
;

436 
	}
}

438 
	$şoudc_£nd_Úlše_buf
(*
devD©a
)

440 
bud_js_buf
[
SEND_MAX_BUF_LEN
] = {0};

441 
bud_h‰p_buf
[
SEND_MAX_BUF_LEN
] = {0};

442 
»t1
 = -1;

444 
	`şoudc_debug
("%s[%d]: EÁ” ", 
__func__
, 
__LINE__
);

446 
»t1
 = 
	`şoudc_bud_Úlše_js_buf
(
bud_js_buf
, 
devD©a
);

448 ià(0 =ğ
»t1
)

451 
	`şoudc_bud_£nd_h‰p_buf
(
bud_js_buf
, 
bud_h‰p_buf
);

452 
	`şoudc_debug
("%s[%d]: bud_h‰p_buàğ%s", 
__func__
, 
__LINE__
, 
bud_h‰p_buf
);

454 
	`şoudc_£nd_h‰p_buf
(
bud_h‰p_buf
);

457 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

458 
	}
}

460 
	$şoudc_bud_»cv_r¥_js_buf
(*
ty³
, 
£rŸl
, 
r¥_¡©us
, *
js_buf
)

462 
cJSON
 *
jsÚ_roÙ
;

464 
jsÚ_roÙ
 = 
	`cJSON_C»©eObjeù
();

466 
r¥_ty³
[30] = {0};

467 
	`¢´štf
(
r¥_ty³
, Ô¥_ty³), "r¥_%s", 
ty³
);

469 ià(!
jsÚ_roÙ
)

471 
	`şoudc_debug
("%s[%d]: g‘ jsÚ_roÙ fad !", 
__func__
, 
__LINE__
);

472 
EXIT
;

476 
	`şoudc_debug
("%s[%d]: g‘ jsÚ_roÙ sucûss,„¥_¡©u ğ%d!", 
__func__
, 
__LINE__
, 
r¥_¡©us
);

480 
	`cJSON_AddSŒšgToObjeù
(
jsÚ_roÙ
, "ty³", 
r¥_ty³
);

481 
	`cJSON_AddNumb”ToObjeù
(
jsÚ_roÙ
, "commªdId", 
£rŸl
);

482 
	`cJSON_AddNumb”ToObjeù
(
jsÚ_roÙ
, "¡©us", 
r¥_¡©us
);

484 *
s
 = 
	`cJSON_PrštUnfÜm©‹d
(
jsÚ_roÙ
);

485 ià(
s
)

487 
	`¡ºıy
(
js_buf
, 
s
, 
SEND_MAX_BUF_LEN
 - 1);

488 
	`şoudc_debug
("%s[%d]: c»©js_buà i %s\n", 
__func__
, 
__LINE__
, 
js_buf
);

489 
	`ä“
(
s
);

492 
	`cJSON_D–‘e
(
jsÚ_roÙ
);

495 
EXIT
:

497 
	}
}

499 
	$şoudc_bud_®ljoyn_»cv_r¥_js_buf
(*
ty³
, 
£rŸl
, *
u£r_id
, *
deviû_id
, 
r¥_¡©us
, *
js_buf
)

501 
cJSON
 *
jsÚ_roÙ
;

503 
jsÚ_roÙ
 = 
	`cJSON_C»©eObjeù
();

505 
r¥_ty³
[30] = {0};

506 
	`¢´štf
(
r¥_ty³
, Ô¥_ty³), "r¥_%s", 
ty³
);

508 ià(!
jsÚ_roÙ
)

510 
	`şoudc_debug
("%s[%d]: g‘ jsÚ_roÙ fad !", 
__func__
, 
__LINE__
);

511 
EXIT
;

515 
	`şoudc_debug
("%s[%d]: g‘ jsÚ_roÙ sucûss,„¥_¡©u ğ%d!", 
__func__
, 
__LINE__
, 
r¥_¡©us
);

519 
	`cJSON_AddSŒšgToObjeù
(
jsÚ_roÙ
, "ty³", 
r¥_ty³
);

520 
	`cJSON_AddNumb”ToObjeù
(
jsÚ_roÙ
, "commªdId", 
£rŸl
);

521 
	`cJSON_AddSŒšgToObjeù
(
jsÚ_roÙ
, "u£rId", 
u£r_id
);

522 
	`cJSON_AddSŒšgToObjeù
(
jsÚ_roÙ
, "deviûId", 
deviû_id
);

523 
	`cJSON_AddNumb”ToObjeù
(
jsÚ_roÙ
, "¡©us", 
r¥_¡©us
);

525 *
s
 = 
	`cJSON_PrštUnfÜm©‹d
(
jsÚ_roÙ
);

526 ià(
s
)

528 
	`¡ºıy
(
js_buf
, 
s
, 
SEND_MAX_BUF_LEN
 - 1);

529 
	`şoudc_debug
("%s[%d]: c»©js_buà i %s\n", 
__func__
, 
__LINE__
, 
js_buf
);

530 
	`ä“
(
s
);

533 
	`cJSON_D–‘e
(
jsÚ_roÙ
);

536 
EXIT
:

538 
	}
}

540 
	$şoudc_£nd_»cv_r¥_buf
(*
ty³
, 
£rŸl
, 
r¥_¡©us
)

542 
bud_js_buf
[
SEND_MAX_BUF_LEN
] = {0};

543 
bud_h‰p_buf
[
SEND_MAX_BUF_LEN
] = {0};

544 
»t1
 = -1;

546 
	`şoudc_debug
("%s[%d]: EÁ” ", 
__func__
, 
__LINE__
);

549 
»t1
 = 
	`şoudc_bud_»cv_r¥_js_buf
(
ty³
, 
£rŸl
, 
r¥_¡©us
, 
bud_js_buf
);

551 ià(0 =ğ
»t1
)

554 
	`şoudc_bud_£nd_h‰p_buf
(
bud_js_buf
, 
bud_h‰p_buf
);

555 
	`şoudc_debug
("%s[%d]: bud_js_buàğ%s, \nbud_h‰p_buàğ%s", 
__func__
, 
__LINE__
, 
bud_js_buf
, 
bud_h‰p_buf
);

557 
	`şoudc_£nd_h‰p_buf
(
bud_h‰p_buf
);

560 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

561  
»t1
;

562 
	}
}

564 
	$şoudc_£nd_®ljoyn_»cv_r¥_buf
(*
ty³
, 
£rŸl
, *
u£r_id
, *
deviû_id
, 
r¥_¡©us
)

566 
bud_js_buf
[
SEND_MAX_BUF_LEN
] = {0};

567 
bud_h‰p_buf
[
SEND_MAX_BUF_LEN
] = {0};

568 
»t1
 = -1;

570 
	`şoudc_debug
("%s[%d]: EÁ” ", 
__func__
, 
__LINE__
);

573 
»t1
 = 
	`şoudc_bud_®ljoyn_»cv_r¥_js_buf
(
ty³
, 
£rŸl
, 
u£r_id
, 
deviû_id
, 
r¥_¡©us
, 
bud_js_buf
);

575 ià(0 =ğ
»t1
)

578 
	`şoudc_bud_£nd_h‰p_buf
(
bud_js_buf
, 
bud_h‰p_buf
);

579 
	`şoudc_debug
("%s[%d]: bud_js_buàğ%s, \nbud_h‰p_buàğ%s", 
__func__
, 
__LINE__
, 
bud_js_buf
, 
bud_h‰p_buf
);

581 
	`şoudc_£nd_h‰p_buf
(
bud_h‰p_buf
);

584 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

585  
»t1
;

586 
	}
}

588 
	$şoudc_£nd_r¥_İkg_buf
(*
ty³
, 
£rŸl
, 
upd©e_¡©us
, 
»¶aû_¡©us
)

590 
bud_js_buf
[
SEND_MAX_BUF_LEN
] = {0};

591 
bud_h‰p_buf
[
SEND_MAX_BUF_LEN
] = {0};

592 
»t1
 = -1;

594 
	`şoudc_debug
("%s[%d]: EÁ” ", 
__func__
, 
__LINE__
);

597 
»t1
 = 
	`şoudc_bud_r¥_İkg_js_buf
(
ty³
, 
£rŸl
, 
upd©e_¡©us
, 
»¶aû_¡©us
, 
bud_js_buf
);

599 ià(0 =ğ
»t1
)

602 
	`şoudc_bud_£nd_h‰p_buf
(
bud_js_buf
, 
bud_h‰p_buf
);

603 
	`şoudc_debug
("%s[%d]: bud_js_buàğ%s, \nbud_h‰p_buàğ%s", 
__func__
, 
__LINE__
, 
bud_js_buf
, 
bud_h‰p_buf
);

605 
	`şoudc_£nd_h‰p_buf
(
bud_h‰p_buf
);

607  
»t1
;

608 
	}
}

610 
	$şoudc_bud_r¥_İkg_js_buf
(*
ty³
, 
£rŸl
, 
upd©e_¡©us
, 
»¶aû_¡©us
, *
js_buf
)

612 
cJSON
 *
jsÚ_roÙ
;

614 
jsÚ_roÙ
 = 
	`cJSON_C»©eObjeù
();

616 
r¥_ty³
[30] = {0};

617 
	`¢´štf
(
r¥_ty³
, Ô¥_ty³), "r¥_%s", 
ty³
);

619 ià(!
jsÚ_roÙ
)

621 
	`şoudc_debug
("%s[%d]: g‘ jsÚ_roÙ fad !", 
__func__
, 
__LINE__
);

622 
EXIT
;

626 
	`şoudc_debug
("%s[%d]: g‘ jsÚ_roÙ sucûss!", 
__func__
, 
__LINE__
);

630 
	`cJSON_AddSŒšgToObjeù
(
jsÚ_roÙ
, "ty³", 
r¥_ty³
);

631 
	`cJSON_AddNumb”ToObjeù
(
jsÚ_roÙ
, "commªdId", 
£rŸl
);

632 
	`cJSON_AddNumb”ToObjeù
(
jsÚ_roÙ
, "upd©e", 
upd©e_¡©us
);

633 
	`cJSON_AddNumb”ToObjeù
(
jsÚ_roÙ
, "u¾", 
»¶aû_¡©us
);

635 *
s
 = 
	`cJSON_PrštUnfÜm©‹d
(
jsÚ_roÙ
);

636 ià(
s
)

638 
	`¡ºıy
(
js_buf
, 
s
, 
SEND_MAX_BUF_LEN
 - 1);

639 
	`şoudc_debug
("%s[%d]: c»©js_buà i %s\n", 
__func__
, 
__LINE__
, 
js_buf
);

640 
	`ä“
(
s
);

643 
	`cJSON_D–‘e
(
jsÚ_roÙ
);

646 
EXIT
:

649 
	}
}

651 
	$şoudc_bud_r¥_g‘_js_buf
(*
ty³
, 
£rŸl
, *
u£r_id
, *
deviû_id
, *
deviû_ty³
, 
k_šfo
 *
cÚfig_šfo_h—d
, 
key_Çme_num
, *
js_buf
)

653 
	`şoudc_”rÜ
("%s[%d]: EÁ”!", 
__func__
, 
__LINE__
);

654 
cJSON
 *
jsÚ_roÙ
;

655 
k_šfo
 *
tmp_cÚfig_šfo_h—d
 = 
cÚfig_šfo_h—d
;

658 
jsÚ_roÙ
 = 
	`cJSON_C»©eObjeù
();

660 ià(!
jsÚ_roÙ
)

662 
	`şoudc_”rÜ
("%s[%d]: g‘ jsÚ_roÙ fad !\n", 
__func__
, 
__LINE__
);

663 
EXIT
;

668 
	`şoudc_debug
("%s[%d]: g‘ jsÚ_roÙ sucûed !\n", 
__func__
, 
__LINE__
);

672 
cJSON
 * 
js_¬¿y
, *
js_body
 ;

674 
r¥_ty³
[30] = {0};

675 
	`¢´štf
(
r¥_ty³
, Ô¥_ty³), "r¥_%s", 
ty³
);

677 
	`cJSON_AddSŒšgToObjeù
(
jsÚ_roÙ
, "ty³", 
r¥_ty³
);

678 
	`cJSON_AddNumb”ToObjeù
(
jsÚ_roÙ
, "commªdId", 
£rŸl
);

679 
	`cJSON_AddSŒšgToObjeù
(
jsÚ_roÙ
, "u£rId", 
u£r_id
);

680 
	`cJSON_AddSŒšgToObjeù
(
jsÚ_roÙ
, "deviûId", 
deviû_id
);

681 
	`cJSON_AddSŒšgToObjeù
(
jsÚ_roÙ
, "deviûTy³", 
deviû_ty³
);

682 
	`cJSON_AddNumb”ToObjeù
(
jsÚ_roÙ
, "status", 2);

683 
	`cJSON_AddI‹mToObjeù
(
jsÚ_roÙ
, "cÚfig", 
js_¬¿y
ğ
	`cJSON_C»©eA¼ay
());

685 
i
 = 0;

686 
i
 = 0; i < 
key_Çme_num
; i ++)

688 
	`cJSON_AddI‹mToA¼ay
(
js_¬¿y
, 
js_body
 = 
	`cJSON_C»©eObjeù
());

689 
	`cJSON_AddI‹mToObjeù
(
js_body
, 
tmp_cÚfig_šfo_h—d
->
İ_k_Çme
, 
	`cJSON_C»©eSŒšg
Ñmp_cÚfig_šfo_h—d->
node_v®ue
));

690 
tmp_cÚfig_šfo_h—d
 =mp_cÚfig_šfo_h—d->
Ãxt
;

694 *
s
 = 
	`cJSON_PrštUnfÜm©‹d
(
jsÚ_roÙ
);

696 ià(
s
)

698 
	`¡ºıy
(
js_buf
, 
s
, 
SEND_MAX_BUF_LEN
 - 1);

699 
	`şoudc_debug
("%s[%d]: c»©js_buà i %s\n", 
__func__
, 
__LINE__
, 
js_buf
);

700 
	`ä“
(
s
);

703 
	`cJSON_D–‘e
(
jsÚ_roÙ
);

707 
EXIT
:

709 
	}
}

712 
	$şoudc_bud_r¥_£t_js_buf
(*
ty³
, 
£rŸl
, *
u£r_id
, *
deviû_id
, *
devD©a
, 
»tCode
, *
js_buf
)

714 
	`şoudc_”rÜ
("%s[%d]: EÁ”!", 
__func__
, 
__LINE__
);

715 
cJSON
 *
jsÚ_roÙ
;

718 
jsÚ_roÙ
 = 
	`cJSON_C»©eObjeù
();

720 ià(!
jsÚ_roÙ
)

722 
	`şoudc_”rÜ
("%s[%d]: g‘ jsÚ_roÙ fad !\n", 
__func__
, 
__LINE__
);

723 
EXIT
;

728 
	`şoudc_debug
("%s[%d]: g‘ jsÚ_roÙ sucûed !\n", 
__func__
, 
__LINE__
);

732 
cJSON
 * 
js_¬¿y
, *
js_body
 ;

734 
r¥_ty³
[30] = {0};

735 
	`¢´štf
(
r¥_ty³
, Ô¥_ty³), "r¥_%s", 
ty³
);

737 
	`cJSON_AddSŒšgToObjeù
(
jsÚ_roÙ
, "ty³", 
r¥_ty³
);

738 
	`cJSON_AddNumb”ToObjeù
(
jsÚ_roÙ
, "commªdId", 
£rŸl
);

739 
	`cJSON_AddSŒšgToObjeù
(
jsÚ_roÙ
, "u£rId", 
u£r_id
);

740 
	`cJSON_AddSŒšgToObjeù
(
jsÚ_roÙ
, "deviûId", 
deviû_id
);

741 
	`cJSON_AddNumb”ToObjeù
(
jsÚ_roÙ
, "status", 2);

742 
	`cJSON_AddNumb”ToObjeù
(
jsÚ_roÙ
, "»t", 
»tCode
);

744 if(0 =ğ
»tCode
)

746 
cJSON
 * 
pSubJsÚ
 = 
NULL
;

747 
cJSON
 * 
pSubDevD©a
 = 
NULL
;

748 
pSubJsÚ
 = 
	`cJSON_C»©eObjeù
();

749 
pSubDevD©a
 = 
	`cJSON_P¬£
(
devD©a
);

751 if(
NULL
 =ğ
pSubJsÚ
)

756 
	`cJSON_AddI‹mToObjeù
(
jsÚ_roÙ
, "devD©a", 
pSubDevD©a
);

760 *
s
 = 
	`cJSON_PrštUnfÜm©‹d
(
jsÚ_roÙ
);

762 ià(
s
)

764 
	`¡ºıy
(
js_buf
, 
s
, 
SEND_MAX_BUF_LEN
 - 1);

765 
	`şoudc_debug
("%s[%d]: c»©js_buà i %s\n", 
__func__
, 
__LINE__
, 
js_buf
);

766 
	`ä“
(
s
);

769 
	`cJSON_D–‘e
(
jsÚ_roÙ
);

773 
EXIT
:

775 
	}
}

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/pthread.c

1 
	~"sh¬e.h
"

2 
	~"·r£r.h
"

3 
	~<±h»ad.h
>

6 
´štids
(cÚ¡ *
s
);

7 *
şoudc_´oûss_sk_th»ad
(*
¬g
);

8 
şoudc_±h»ad_š™
();

10 
±h»ad_mu‹x_t
 
	gmu‹x
 = 
PTHREAD_MUTEX_INITIALIZER
;

12 
	$´štids
(cÚ¡ *
s
)

14 
pid_t
 
pid
;

15 
±h»ad_t
 
tid
;

17 
pid
 = 
	`g‘pid
();

18 
tid
 = 
	`±h»ad_£lf
();

20 
	`şoudc_debug
("%s[%d]: % pid %uid %u (0x%x)\n", 
__func__
, 
__LINE__
, 
s
, (è
pid
, (è
tid
, ()id);

21 
	}
}

23 *
	$şoudc_´oûss_sk_th»ad
(*
¬g
)

25 
	`´štids
("‚ewhread: ");

26 
	`sk_queue_š™
(& 
queue_h—d
);

30 if(
NOT_EMPTY
 =ğ
	`sk_queue_is_em±y
(&
queue_h—d
))

32 
	`şoudc_debug
(" hello, I‡m…rocessingasks ...");

37 
	`sk_queue_deque
(&
queue_h—d
);

40 
	`u¦“p
(100*1000);

43 
	}
}

46 
	$şoudc_±h»ad_š™
()

48 
±h»ad_t
 
şoudc_tid
;

49 
»t
 = -1;

51 
»t
 = 
	`±h»ad_ü—‹
(&
şoudc_tid
, 
NULL
, 
şoudc_´oûss_sk_th»ad
, NULL);

53 
	`şoudc_debug
("%s[%d]:„‘ = %d\n", 
__func__
, 
__LINE__
, 
»t
);

55 if(
»t
 != 0)

57 
	`³¼Ü
("can't createhread: %s\n");

60 
	`´štids
("mainhread: ");

61 
	`¦“p
(1);

65 
	}
}

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/AboutDataStore.cc

16 #ifdeà
NEED_DATA_STORE


17 
	~"AboutD©aStÜe.h
"

18 
	~"AboutObjApi.h
"

19 
	~<®ljoyn/cÚfig/AboutD©aStÜeIÁ”çû.h
>

20 
	~<®ljoyn/AboutD©a.h
>

21 
	~<f¡»am
>

22 
	~<iomª
>

23 
	~<io¡»am
>

24 
	~<s¡»am
>

25 
	~<sys/¡©.h
>

27 
usšg
 
Çme¥aû
 
	gajn
;

28 
usšg
 
Çme¥aû
 
	g£rviûs
;

30 
	gAboutD©aStÜe
::
	$AboutD©aStÜe
(cÚ¡ * 
çùÜyCÚfigFe
, cÚ¡ * 
cÚfigFe
) :

31 
	`AboutD©aStÜeIÁ”çû
(
çùÜyCÚfigFe
, 
cÚfigFe
), 
	$m_IsIn™Ÿlized
(
çl£
)

33 
¡d
::
cout
 << "AboutD©aStÜe::AboutD©aStÜe" << std::
’dl
;

34 
m_cÚfigFeName
.
	`assign
(
cÚfigFe
);

35 
m_çùÜyCÚfigFeName
.
	`assign
(
çùÜyCÚfigFe
);

36 
	`S‘NewF›ldD‘as
("Passcode", 
EMPTY_MASK
, "s");

37 
	`S‘NewF›ldD‘as
("D«mÚ»®m", 
EMPTY_MASK
, "s");

38 
MsgArg
 
	`¬g
("s", "");

39 
	`S‘F›ld
("D«mÚ»®m", 
¬g
);

40 
	}
}

42 
	gAboutD©aStÜe
::
	$In™Ÿlize
()

44 
¡d
::
cout
 << "AboutD©aStÜe::In™Ÿliz" << 
m_cÚfigFeName
 << std::
’dl
;

45 
¡d
::
if¡»am
 
	`cÚfigFe
(
m_cÚfigFeName
.
	`c_¡r
(), std::
ios
::
bš¬y
);

46 ià(
cÚfigFe
) {

47 
¡d
::
¡ršg
 
	`¡r
((¡d::
i¡»ambuf_™”©Ü
<>(
cÚfigFe
)),

48 
¡d
::
i¡»ambuf_™”©Ü
<>());

49 
¡d
::
cout
 << "CÚšs:" << std::
’dl
 << 
¡r
 << std::endl;

50 
QStus
 
¡©us
;

51 
¡©us
 = 
	`C»©eFromXml
(
qcc
::
	`SŒšg
(
¡r
.
	`c_¡r
()));

53 ià(
¡©us
 !ğ
ER_OK
) {

54 
¡d
::
cout
 << "AboutD©aStÜe::In™ŸlizERROR" << std::
’dl
;

57 
size_t
 
numF›lds
 = 
	`G‘F›lds
();

58 
¡d
::
cout
 << "AboutD©aStÜe::In™Ÿlize(ènumF›lds=" << 
numF›lds
 << std::
’dl
;

61 ià(!
	`IsV®id
()) {

62 
¡d
::
cout
 << "AboutD©aStÜe::In™ŸlizFAIL" << std::
’dl
;

64 
m_IsIn™Ÿlized
 = 
Œue
;

65 
¡d
::
cout
 << "AboutD©aStÜe::In™ŸlizEnd" << std::
’dl
;

67 
	}
}

69 
	gAboutD©aStÜe
::
	$S‘OBCFG
()

71 
	`S‘NewF›ldD‘as
("sÿn_fe", 
EMPTY_MASK
, "s");

72 
MsgArg
 
	`¬gSÿnFe
("s", "/tmp/wifi_scan_results");

73 
	`S‘F›ld
("sÿn_fe", 
¬gSÿnFe
);

74 
	`S‘NewF›ldD‘as
("”rÜ_fe", 
EMPTY_MASK
, "s");

75 
MsgArg
 
	`¬gE¼ÜFe
("s", "/tmp/state/alljoyn-onboarding-lasterror");

76 
	`S‘F›ld
("”rÜ_fe", 
¬gE¼ÜFe
);

77 
	`S‘NewF›ldD‘as
("¡©e_fe", 
EMPTY_MASK
, "s");

78 
MsgArg
 
	`¬gS‹Fe
("s", "/tmp/state/alljoyn-onboarding-lasterror");

79 
	`S‘F›ld
("¡©e_fe", 
¬gS‹Fe
);

80 
	`S‘NewF›ldD‘as
("cÚÃù_cmd", 
EMPTY_MASK
, "s");

81 
MsgArg
 
	`¬gCÚÃùCmd
("s", "/tmp/state/alljoyn-onboarding");

82 
	`S‘F›ld
("cÚÃù_cmd", 
¬gCÚÃùCmd
);

83 
	`S‘NewF›ldD‘as
("offbßrd_cmd", 
EMPTY_MASK
, "s");

84 
MsgArg
 
	`¬gOffbßrdCmd
("s", "/tmp/state/alljoyn-onboarding");

85 
	`S‘F›ld
("offbßrd_cmd", 
¬gOffbßrdCmd
);

86 
	`S‘NewF›ldD‘as
("cÚfigu»_cmd", 
EMPTY_MASK
, "s");

87 
MsgArg
 
	`¬gCÚfigu»Cmd
("s", "/tmp/state/alljoyn-onboarding");

88 
	`S‘F›ld
("cÚfigu»_cmd", 
¬gCÚfigu»Cmd
);

89 
	`S‘NewF›ldD‘as
("sÿn_cmd", 
EMPTY_MASK
, "s");

90 
MsgArg
 
	`¬gSÿnCmd
("s", "/tmp/state/alljoyn-onboarding");

91 
	`S‘F›ld
("sÿn_cmd", 
¬gSÿnCmd
);

92 
	}
}

94 
	gAboutD©aStÜe
::
	$FaùÜyRe£t
()

96 
¡d
::
cout
 << "AboutD©aStÜe::FaùÜyRe£t" << std::
’dl
;

98 
m_IsIn™Ÿlized
 = 
çl£
;

100 
¡d
::
if¡»am
 
	`çùÜyCÚfigFe
(
m_çùÜyCÚfigFeName
.
	`c_¡r
(), std::
ios
::
bš¬y
);

101 
¡d
::
¡ršg
 
	`¡r
((¡d::
i¡»ambuf_™”©Ü
<>(
çùÜyCÚfigFe
)),

102 
¡d
::
i¡»ambuf_™”©Ü
<>());

103 
çùÜyCÚfigFe
.
	`şo£
();

105 
¡d
::
of¡»am
 
	`cÚfigFeWr™e
(
m_cÚfigFeName
.
	`c_¡r
(), std::of¡»am::
out
 | std::of¡»am::
Œunc
);

106 
cÚfigFeWr™e
.
	`wr™e
(
¡r
.
	`c_¡r
(), sŒ.
	`Ëngth
());

107 
cÚfigFeWr™e
.
	`şo£
();

109 
	`In™Ÿlize
();

110 
	}
}

112 
	gAboutD©aStÜe
::~
	$AboutD©aStÜe
()

114 
¡d
::
cout
 << "AboutD©aStÜe::~AboutD©aStÜe" << std::
’dl
;

115 
	}
}

117 
QStus
 
	gAboutD©aStÜe
::
R—dAÎ
(cÚ¡ * 
ÏnguageTag
, 
D©aP”missiÚ
::
F‹r
 
f‹r
, 
ajn
::
MsgArg
& 
®l
)

119 
¡d
::
cout
 << "AboutD©aStÜe::R—dAÎ" << std::
’dl
;

120 
QStus
 
	g¡©us
 = 
G‘AboutD©a
(&
®l
, 
ÏnguageTag
);

121 
	g¡d
::
cout
 << "G‘AboutD©¨¡©u ğ" << 
QCC_StusText
(
¡©us
è<< 
¡d
::
’dl
;

122  
	g¡©us
;

125 
QStus
 
	gAboutD©aStÜe
::
Upd©e
(cÚ¡ * 
Çme
, cÚ¡ * 
ÏnguageTag
, cÚ¡ 
ajn
::
MsgArg
* 
v®ue
)

127 
¡d
::
cout
 << "AboutD©aStÜe::Upd©e" << "‚ame:" << 
Çme
 << "†ªguageTag:" << 
ÏnguageTag
 << " v®ue:" << 
v®ue
 << std::
’dl
;

129 
QStus
 
	g¡©us
 = 
ER_INVALID_VALUE
;

130 ià(
¡rcmp
(
Çme
, 
AboutD©a
::
APP_ID
) == 0) {

131 
ušt8_t
* 
­pId
 = 
NULL
;

132 
size_t
* 
	gnum
 = 
NULL
;

133 
	g¡©us
 = 
v®ue
->
G‘
("ay", 
num
, &
­pId
);

134 ià(
	g¡©us
 =ğ
ER_OK
) {

135 
¡©us
 = 
S‘AµId
(
­pId
, *
num
);

137 } ià(
¡rcmp
(
Çme
, 
AboutD©a
::
DEFAULT_LANGUAGE
) == 0) {

138 * 
deçuÉLªguage
;

139 
	g¡©us
 = 
v®ue
->
G‘
("s", &
deçuÉLªguage
);

140 ià(
	g¡©us
 =ğ
ER_OK
) {

141 ià(0 =ğ
¡rcmp
(
deçuÉLªguage
, "")) {

142 
	g¡©us
 = 
ER_LANGUAGE_NOT_SUPPORTED
;

144 
	g¡©us
 = 
IsLªguageSuµÜ‹d
(
deçuÉLªguage
);

145 ià(
	g¡©us
 =ğ
ER_OK
) {

146 
¡©us
 = 
S‘DeçuÉLªguage
(
deçuÉLªguage
);

150 } ià(
¡rcmp
(
Çme
, 
AboutD©a
::
DEVICE_NAME
) == 0) {

151 
¡d
::
cout
 << "GÙ deviû‚ame" << std::
’dl
;

152 * 
	gdeviûName
 = 
NULL
;

153 
	g¡©us
 = 
v®ue
->
G‘
("s", &
deviûName
);

154 
	g¡©us
 = 
IsLªguageSuµÜ‹d
(
ÏnguageTag
);

155 ià(
	g¡©us
 =ğ
ER_OK
) {

156 
¡©us
 = 
S‘DeviûName
(
deviûName
, 
ÏnguageTag
);

158 } ià(
¡rcmp
(
Çme
, 
AboutD©a
::
DEVICE_ID
) == 0) {

159 * 
deviûId
 = 
NULL
;

160 
	g¡©us
 = 
v®ue
->
G‘
("s", &
deviûId
);

161 ià(
	g¡©us
 =ğ
ER_OK
) {

162 
¡©us
 = 
S‘DeviûId
(
deviûId
);

164 } ià(
¡rcmp
(
Çme
, 
AboutD©a
::
APP_NAME
) == 0) {

165 * 
­pName
 = 
NULL
;

166 
	g¡©us
 = 
v®ue
->
G‘
("s", &
­pName
);

167 ià(
	g¡©us
 =ğ
ER_OK
) {

168 
¡©us
 = 
S‘AµName
(
­pName
, 
ÏnguageTag
);

170 } ià(
¡rcmp
(
Çme
, 
AboutD©a
::
MANUFACTURER
) == 0) {

171 * 
chv®
 = 
NULL
;

172 
	g¡©us
 = 
v®ue
->
G‘
("s", &
chv®
);

173 ià(
	g¡©us
 =ğ
ER_OK
) {

174 
¡©us
 = 
S‘Mªuçùu»r
(
chv®
);

176 } ià(
¡rcmp
(
Çme
, 
AboutD©a
::
MODEL_NUMBER
) == 0) {

177 * 
chv®
 = 
NULL
;

178 
	g¡©us
 = 
v®ue
->
G‘
("s", 
chv®
);

179 ià(
	g¡©us
 =ğ
ER_OK
) {

180 
¡©us
 = 
S‘Mod–Numb”
(
chv®
);

182 } ià(
¡rcmp
(
Çme
, 
AboutD©a
::
SUPPORTED_LANGUAGES
) == 0) {

184 
¡d
::
cout
 << "AboutD©aStÜe::Upd©- suµÜ‹d†ªguage wÈbadded‡utom©iÿÎy wh’‡ddšg v®ue" << std::
’dl
;

185 } ià(
¡rcmp
(
Çme
, 
AboutD©a
::
DESCRIPTION
) == 0) {

186 * 
chv®
 = 
NULL
;

187 
	g¡©us
 = 
v®ue
->
G‘
("s", &
chv®
);

188 ià(
	g¡©us
 =ğ
ER_OK
) {

189 
¡©us
 = 
S‘DesütiÚ
(
chv®
);

191 } ià(
¡rcmp
(
Çme
, 
AboutD©a
::
DATE_OF_MANUFACTURE
) == 0) {

192 * 
chv®
 = 
NULL
;

193 
	g¡©us
 = 
v®ue
->
G‘
("s", &
chv®
);

194 ià(
	g¡©us
 =ğ
ER_OK
) {

195 
¡©us
 = 
S‘D©eOfMªuçùu»
(
chv®
);

197 } ià(
¡rcmp
(
Çme
, 
AboutD©a
::
SOFTWARE_VERSION
) == 0) {

198 * 
chv®
 = 
NULL
;

199 
	g¡©us
 = 
v®ue
->
G‘
("s", &
chv®
);

200 ià(
	g¡©us
 =ğ
ER_OK
) {

201 
¡©us
 = 
S‘Soáw¬eV”siÚ
(
chv®
);

203 } ià(
¡rcmp
(
Çme
, 
AboutD©a
::
HARDWARE_VERSION
) == 0) {

204 * 
chv®
 = 
NULL
;

205 
	g¡©us
 = 
v®ue
->
G‘
("s", &
chv®
);

206 ià(
	g¡©us
 =ğ
ER_OK
) {

207 
¡©us
 = 
S‘H¬dw¬eV”siÚ
(
chv®
);

209 } ià(
¡rcmp
(
Çme
, 
AboutD©a
::
SUPPORT_URL
) == 0) {

210 * 
chv®
 = 
NULL
;

211 
	g¡©us
 = 
v®ue
->
G‘
("s", &
chv®
);

212 ià(
	g¡©us
 =ğ
ER_OK
) {

213 
¡©us
 = 
S‘SuµÜtU¾
(
chv®
);

217 ià(
	g¡©us
 =ğ
ER_OK
) {

219 
qcc
::
SŒšg
 
¡r
 = 
ToXml
();

221 
	g¡d
::
of¡»am
 
šiFeWr™e
(
m_cÚfigFeName
.
c_¡r
(), 
¡d
::of¡»am::
out
 | std::of¡»am::
Œunc
);

223 
	gšiFeWr™e
.
wr™e
(
¡r
.
c_¡r
(), sŒ.
Ëngth
());

224 
	gšiFeWr™e
.
şo£
();

226 
AboutObjApi
* 
	gaboutObjApi
 = AboutObjApi::
g‘In¡ªû
();

227 ià(
	gaboutObjApi
) {

228 
	g¡©us
 = 
aboutObjApi
->
AÂounû
();

229 
	g¡d
::
cout
 << "AÂounû stu " << 
QCC_StusText
(
¡©us
è<< 
¡d
::
’dl
;

233  
	g¡©us
;

236 
QStus
 
	gAboutD©aStÜe
::
	$D–‘e
(cÚ¡ * 
Çme
, cÚ¡ * 
ÏnguageTag
)

238 
¡d
::
cout
 << "AboutD©aStÜe::D–‘e(" << 
Çme
 << ", " << 
ÏnguageTag
 << ")" << std::
’dl
;

239 
QStus
 
¡©us
 = 
ER_INVALID_VALUE
;

241 
ajn
::
AboutD©a
 
	`çùÜyS‘tšgs
("en");

242 
¡d
::
if¡»am
 
	`cÚfigFe
(
m_çùÜyCÚfigFeName
.
	`c_¡r
(), std::
ios
::
bš¬y
);

243 ià(
cÚfigFe
) {

244 
¡d
::
¡ršg
 
	`¡r
((¡d::
i¡»ambuf_™”©Ü
<>(
cÚfigFe
)),

245 
¡d
::
i¡»ambuf_™”©Ü
<>());

246 
¡d
::
cout
 << "CÚšs:" << std::
’dl
 << 
¡r
 << std::endl;

247 
QStus
 
¡©us
;

248 
¡©us
 = 
çùÜyS‘tšgs
.
	`C»©eFromXml
(
qcc
::
	`SŒšg
(
¡r
.
	`c_¡r
()));

250 ià(
¡©us
 !ğ
ER_OK
) {

251 
¡d
::
cout
 << "AboutD©aStÜe::In™ŸlizERROR" << std::
’dl
;

252  
¡©us
;

256 ià(
	`¡rcmp
(
Çme
, 
AboutD©a
::
APP_ID
) == 0) {

257 
ušt8_t
* 
­pId
;

258 
size_t
 
num
;

259 
¡©us
 = 
çùÜyS‘tšgs
.
	`G‘AµId
(&
­pId
, &
num
);

260 ià(
¡©us
 =ğ
ER_OK
) {

261 
¡©us
 = 
	`S‘AµId
(
­pId
, 
num
);

263 } ià(
	`¡rcmp
(
Çme
, 
AboutD©a
::
DEFAULT_LANGUAGE
) == 0) {

264 * 
deçuÉLªguage
;

265 
¡©us
 = 
çùÜyS‘tšgs
.
	`G‘DeçuÉLªguage
(&
deçuÉLªguage
);

266 ià(
¡©us
 =ğ
ER_OK
) {

267 
¡©us
 = 
	`S‘DeçuÉLªguage
(
deçuÉLªguage
);

269 } ià(
	`¡rcmp
(
Çme
, 
AboutD©a
::
DEVICE_NAME
) == 0) {

270 
¡©us
 = 
	`IsLªguageSuµÜ‹d
(
ÏnguageTag
);

271 ià(
¡©us
 =ğ
ER_OK
) {

272 * 
deviûName
 = 
NULL
;

273 
¡©us
 = 
çùÜyS‘tšgs
.
	`G‘DeviûName
(&
deviûName
, 
ÏnguageTag
);

274 
¡d
::
cout
 << "G‘DeviûNam¡©u " << 
	`QCC_StusText
(
¡©us
è<< std::
’dl
;

275 ià(
¡©us
 =ğ
ER_OK
) {

276 
¡©us
 = 
	`S‘DeviûName
(
deviûName
, 
ÏnguageTag
);

277 
¡d
::
cout
 << "S‘DeviûNam¡©u " << 
	`QCC_StusText
(
¡©us
è<< std::
’dl
;

280 } ià(
	`¡rcmp
(
Çme
, 
AboutD©a
::
DEVICE_ID
) == 0) {

281 * 
deviûId
 = 
NULL
;

282 
¡©us
 = 
çùÜyS‘tšgs
.
	`G‘DeviûId
(&
deviûId
);

283 ià(
¡©us
 =ğ
ER_OK
) {

284 
¡©us
 = 
	`S‘DeviûId
(
deviûId
);

286 } ià(
	`¡rcmp
(
Çme
, 
AboutD©a
::
APP_NAME
) == 0) {

287 * 
­pName
;

288 
¡©us
 = 
çùÜyS‘tšgs
.
	`G‘AµName
(&
­pName
);

289 ià(
¡©us
 =ğ
ER_OK
) {

290 
¡©us
 = 
	`S‘AµName
(
­pName
, 
ÏnguageTag
);

292 } ià(
	`¡rcmp
(
Çme
, 
AboutD©a
::
MANUFACTURER
) == 0) {

293 * 
mªuçùu»r
 = 
NULL
;

294 
¡©us
 = 
çùÜyS‘tšgs
.
	`G‘Mªuçùu»r
(&
mªuçùu»r
, 
ÏnguageTag
);

295 ià(
¡©us
 =ğ
ER_OK
) {

296 
¡©us
 = 
	`S‘Mªuçùu»r
(
mªuçùu»r
, 
ÏnguageTag
);

298 } ià(
	`¡rcmp
(
Çme
, 
AboutD©a
::
MODEL_NUMBER
) == 0) {

299 * 
mod–Numb”
 = 
NULL
;

300 
¡©us
 = 
çùÜyS‘tšgs
.
	`G‘Mod–Numb”
(&
mod–Numb”
);

301 ià(
¡©us
 =ğ
ER_OK
) {

302 
¡©us
 = 
	`S‘Mod–Numb”
(
mod–Numb”
);

304 } ià(
	`¡rcmp
(
Çme
, 
AboutD©a
::
SUPPORTED_LANGUAGES
) == 0) {

305 
size_t
 
ÏngNum
;

306 
ÏngNum
 = 
çùÜyS‘tšgs
.
	`G‘SuµÜ‹dLªguages
();

307 
¡d
::
cout
 << "Numb” oàsuµÜ‹d†ªguages: " << 
ÏngNum
 << std::
’dl
;

308 ià(
ÏngNum
 > 0) {

309 cÚ¡ ** 
Ïngs
 = 
Ãw
 cÚ¡ *[
ÏngNum
];

310 
çùÜyS‘tšgs
.
	`G‘SuµÜ‹dLªguages
(
Ïngs
, 
ÏngNum
);

311 
size_t
 
i
 = 0; i < 
ÏngNum
; ++i) {

312 
	`S‘SuµÜ‹dLªguage
(
Ïngs
[
i
]);

315 } ià(
	`¡rcmp
(
Çme
, 
AboutD©a
::
DESCRIPTION
) == 0) {

316 * 
desütiÚ
 = 
NULL
;

317 
¡©us
 = 
çùÜyS‘tšgs
.
	`G‘DesütiÚ
(&
desütiÚ
, 
ÏnguageTag
);

318 ià(
¡©us
 =ğ
ER_OK
) {

319 
¡©us
 = 
	`S‘DesütiÚ
(
desütiÚ
, 
ÏnguageTag
);

321 } ià(
	`¡rcmp
(
Çme
, 
AboutD©a
::
DATE_OF_MANUFACTURE
) == 0) {

322 * 
d©e
 = 
NULL
;

323 
¡©us
 = 
çùÜyS‘tšgs
.
	`G‘D©eOfMªuçùu»
(&
d©e
);

324 ià(
¡©us
 =ğ
ER_OK
) {

325 
¡©us
 = 
	`S‘D©eOfMªuçùu»
(
d©e
);

327 } ià(
	`¡rcmp
(
Çme
, 
AboutD©a
::
SOFTWARE_VERSION
) == 0) {

328 * 
v”siÚ
 = 
NULL
;

329 
¡©us
 = 
çùÜyS‘tšgs
.
	`G‘Soáw¬eV”siÚ
(&
v”siÚ
);

330 ià(
¡©us
 =ğ
ER_OK
) {

331 
¡©us
 = 
	`S‘Soáw¬eV”siÚ
(
v”siÚ
);

333 } ià(
	`¡rcmp
(
Çme
, 
AboutD©a
::
HARDWARE_VERSION
) == 0) {

334 * 
v”siÚ
 = 
NULL
;

335 
¡©us
 = 
çùÜyS‘tšgs
.
	`G‘H¬dw¬eV”siÚ
(&
v”siÚ
);

336 ià(
¡©us
 =ğ
ER_OK
) {

337 
¡©us
 = 
	`S‘H¬dw¬eV”siÚ
(
v”siÚ
);

339 } ià(
	`¡rcmp
(
Çme
, 
AboutD©a
::
SUPPORT_URL
) == 0) {

340 * 
u¾
 = 
NULL
;

341 
¡©us
 = 
çùÜyS‘tšgs
.
	`G‘SuµÜtU¾
(&
u¾
);

342 ià(
¡©us
 =ğ
ER_OK
) {

343 
¡©us
 = 
	`S‘SuµÜtU¾
(
u¾
);

347 ià(
¡©us
 =ğ
ER_OK
) {

349 
qcc
::
SŒšg
 
¡r
 = 
	`ToXml
();

351 
¡d
::
of¡»am
 
	`šiFeWr™e
(
m_cÚfigFeName
.
	`c_¡r
(), std::of¡»am::
out
 | std::of¡»am::
Œunc
);

353 
šiFeWr™e
.
	`wr™e
(
¡r
.
	`c_¡r
(), sŒ.
	`Ëngth
());

354 
šiFeWr™e
.
	`şo£
();

356 
AboutObjApi
* 
aboutObjApi
 = AboutObjApi::
	`g‘In¡ªû
();

357 ià(
aboutObjApi
) {

358 
¡©us
 = 
aboutObjApi
->
	`AÂounû
();

359 
¡d
::
cout
 << "AÂounû stu " << 
	`QCC_StusText
(
¡©us
è<< std::
’dl
;

363  
¡©us
;

364 
	}
}

366 cÚ¡ 
	gqcc
::
SŒšg
& 
AboutD©aStÜe
::
	$G‘CÚfigFeName
()

368 
¡d
::
cout
 << "AboutD©aStÜe::G‘CÚfigFeName" << std::
’dl
;

369  
m_cÚfigFeName
;

370 
	}
}

372 
	gAboutD©aStÜe
::
	$wr™e
()

375 
qcc
::
SŒšg
 
¡r
 = 
	`ToXml
();

377 
¡d
::
of¡»am
 
	`šiFeWr™e
(
m_cÚfigFeName
.
	`c_¡r
(), std::of¡»am::
out
 | std::of¡»am::
Œunc
);

379 
šiFeWr™e
.
	`wr™e
(
¡r
.
	`c_¡r
(), sŒ.
	`Ëngth
());

380 
šiFeWr™e
.
	`şo£
();

382 
AboutObjApi
* 
aboutObjApi
 = AboutObjApi::
	`g‘In¡ªû
();

383 ià(
aboutObjApi
) {

384 
QStus
 
¡©us
 = 
aboutObjApi
->
	`AÂounû
();

385 
¡d
::
cout
 << "AÂounû stu " << 
	`QCC_StusText
(
¡©us
è<< std::
’dl
;

387 
	}
}

389 
	gqcc
::
SŒšg
 
AboutD©aStÜe
::
	$ToXml
()

391 
¡d
::
cout
 << "AboutD©aStÜe::ToXml" << std::
’dl
;

392 
QStus
 
¡©us
 = 
ER_OK
;

393 
size_t
 
numF›lds
 = 
	`G‘F›lds
();

394 ià(0 =ğ
numF›lds
) {

397 cÚ¡ * 
f›ldNames
[512];

398 
	`G‘F›lds
(
f›ldNames
, 
numF›lds
);

399 * 
deçuÉLªguage
;

400 
¡©us
 = 
	`G‘DeçuÉLªguage
(&
deçuÉLªguage
);

401 ià(
ER_OK
 !ğ
¡©us
) {

404 
size_t
 
numLªgs
 = 
	`G‘SuµÜ‹dLªguages
();

405 cÚ¡ ** 
Ïngs
 = 
Ãw
 cÚ¡ *[
numLªgs
];

406 
	`G‘SuµÜ‹dLªguages
(
Ïngs
, 
numLªgs
);

407 
qcc
::
SŒšg
 
»s
;

408 
»s
 += "<AboutData>\n";

409 
size_t
 
i
 = 0; i < 
numF›lds
; i++) {

410 
ajn
::
MsgArg
* 
¬g
;

411 * 
v®
;

412 
	`G‘F›ld
(
f›ldNames
[
i
], 
¬g
);

413 ià(!
	`¡rcmp
(
f›ldNames
[
i
], "AppId")) {

414 
»s
 +ğ" <" + 
qcc
::
	`SŒšg
(
f›ldNames
[
i
]) + ">";

415 
size_t
 
Ïy
;

416 
ušt8_t
* 
·y
;

417 
¬g
->
	`G‘
("ay", &
Ïy
, &
·y
);

418 
¡d
::
¡ršg¡»am
 
ss
;

419 
size_t
 
j
 = 0; j < 
Ïy
; ++j) {

420 
ss
 << 
¡d
::
hex
 << std::
	`£tw
(2è<< std::
	`£tfl
('0'è<< 
¡©ic_ÿ¡
<>(
·y
[
j
]);

422 
»s
 +ğ
ss
.
	`¡r
().
	`c_¡r
();

423 
»s
 +ğ"</" + 
qcc
::
	`SŒšg
(
f›ldNames
[
i
]) + ">\n";

427 ià(
¬g
->
	`SigÇtu»
() != "s") {

431 
¬g
->
	`G‘
("s", &
v®
);

432 
»s
 +ğ" <" + 
qcc
::
	`SŒšg
(
f›ldNames
[
i
]) + ">";

433 
»s
 +ğ
v®
;

434 
»s
 +ğ"</" + 
qcc
::
	`SŒšg
(
f›ldNames
[
i
]) + ">\n";

435 ià(!
	`IsF›ldLoÿlized
(
f›ldNames
[
i
])) {

439 
size_t
 
j
 = 0; j < 
numLªgs
; j++) {

440 ià(
Ïngs
[
j
] =ğ
deçuÉLªguage
) {

444 
»s
 +ğ" <" + 
qcc
::
	`SŒšg
(
f›ldNames
[
i
]è+ "†ªg=\"" + 
Ïngs
[
j
] + "\">";

445 
	`G‘F›ld
(
f›ldNames
[
i
], 
¬g
, 
Ïngs
[
j
]);

446 
¬g
->
	`G‘
("s", &
v®
);

447 
»s
 +ğ
v®
;

448 
»s
 +ğ"</" + 
qcc
::
	`SŒšg
(
f›ldNames
[
i
]) + ">\n";

451 
»s
 += "</AboutData>";

453 
d–‘e
 [] 
Ïngs
;

454 
¡d
::
cout
 << "’d" << std::
’dl
;

455  
»s
;

456 
	}
}

458 
QStus
 
	gAboutD©aStÜe
::
	$IsLªguageSuµÜ‹d
(cÚ¡ * 
ÏnguageTag
)

467 
QStus
 
¡©us
 = ((QStatus)0x911a);

468 
¡d
::
cout
 << "AboutD©aStÜe::IsLªguageSuµÜ‹d†ªguageTag = " << 
ÏnguageTag
 << std::
’dl
;

469 
size_t
 
ÏngNum
;

470 
ÏngNum
 = 
	`G‘SuµÜ‹dLªguages
();

471 
¡d
::
cout
 << "Numb” oàsuµÜ‹d†ªguages: " << 
ÏngNum
 << std::
’dl
;

472 ià(
ÏngNum
 > 0) {

473 cÚ¡ ** 
Ïngs
 = 
Ãw
 cÚ¡ *[
ÏngNum
];

474 
	`G‘SuµÜ‹dLªguages
(
Ïngs
, 
ÏngNum
);

475 
size_t
 
i
 = 0; i < 
ÏngNum
; ++i) {

476 ià(0 =ğ
	`¡rcmp
(
ÏnguageTag
, 
Ïngs
[
i
])) {

477 
¡©us
 = 
ER_OK
;

481 
d–‘e
 [] 
Ïngs
;

484 
¡d
::
cout
 << "R‘uºšg " << 
	`QCC_StusText
(
¡©us
è<< std::
’dl
;

485  
¡©us
;

486 
	}
}

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/AboutDataStore.h

16 #iâdeà
ABOUT_DATA_STORE_H_


17 
	#ABOUT_DATA_STORE_H_


	)

19 
	~<¡dio.h
>

20 
	~<io¡»am
>

21 
	~<®ljoyn/cÚfig/AboutD©aStÜeIÁ”çû.h
>

27 şas 
	cAboutD©aStÜe
 : 
public
 
AboutD©aStÜeIÁ”çû
 {

29 
public
:

35 
AboutD©aStÜe
(cÚ¡ * 
çùÜyCÚfigFe
, cÚ¡ * 
cÚfigFe
);

40 
S‘OBCFG
();

45 
FaùÜyRe£t
();

51 cÚ¡ 
	mqcc
::
SŒšg
& 
G‘CÚfigFeName
();

56 
	mvœtu®
 ~
AboutD©aStÜe
();

65 
vœtu®
 
QStus
 
R—dAÎ
(cÚ¡ * 
ÏnguageTag
, 
D©aP”missiÚ
::
F‹r
 
f‹r
, 
ajn
::
MsgArg
& 
®l
);

74 
vœtu®
 
QStus
 
Upd©e
(cÚ¡ * 
Çme
, cÚ¡ * 
ÏnguageTag
, cÚ¡ 
ajn
::
MsgArg
* 
v®ue
);

82 
vœtu®
 
QStus
 
D–‘e
(cÚ¡ * 
Çme
, cÚ¡ * 
ÏnguageTag
);

87 
wr™e
();

92 
In™Ÿlize
();

94 
	m´iv©e
:

95 
boŞ
 
m_IsIn™Ÿlized
;

96 
	mqcc
::
SŒšg
 
m_cÚfigFeName
;

97 
	mqcc
::
SŒšg
 
m_çùÜyCÚfigFeName
;

99 
	mqcc
::
SŒšg
 
ToXml
();

101 
QStus
 
IsLªguageSuµÜ‹d
(cÚ¡ * 
ÏnguageTag
);

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/AboutObjApi.cc

17 
	~<®ljoyn/AboutObj.h
>

18 
	~<®ljoyn/AboutD©a.h
>

19 
	~"AboutObjApi.h
"

21 
usšg
 
Çme¥aû
 
	gajn
;

22 
usšg
 
Çme¥aû
 
	g£rviûs
;

24 
AboutObjApi
* 
	gAboutObjApi
::
m_š¡ªû
 = 
NULL
;

25 
BusA‰achm’t
* 
	gAboutObjApi
::
m_BusA‰achm’t
 = 
NULL
;

26 
AboutD©a
* 
	gAboutObjApi
::
m_AboutD©a
 = 
NULL
;

27 
AboutObj
* 
	gAboutObjApi
::
m_AboutObj
 = 
NULL
;

28 
SessiÚPÜt
 
	gAboutObjApi
::
m_£ssiÚPÜt
 = 0;

30 
	gAboutObjApi
::
	$AboutObjApi
() {

31 
	}
}

33 
AboutObjApi
::~
	$AboutObjApi
() {

34 
	}
}

36 
AboutObjApi
* AboutObjApi::
	$g‘In¡ªû
() {

38 ià(!
m_š¡ªû
) {

39 
m_š¡ªû
 = 
Ãw
 
	`AboutObjApi
();

41  
m_š¡ªû
;

42 
	}
}

44 
	gAboutObjApi
::
In™
(
ajn
::
BusA‰achm’t
* 
bus
, 
AboutD©a
* 
aboutD©a
, 
AboutObj
* 
aboutObj
) {

45 
	gm_BusA‰achm’t
 = 
bus
;

46 
	gm_AboutD©a
 = 
aboutD©a
;

47 
	gm_AboutObj
 = 
aboutObj
;

50 
	gAboutObjApi
::
	$De¡royIn¡ªû
() {

51 ià(
m_š¡ªû
) {

52 
d–‘e
 
m_š¡ªû
;

53 
m_š¡ªû
 = 
NULL
;

55 
	}
}

57 
	gAboutObjApi
::
	$S‘PÜt
(
SessiÚPÜt
 
£ssiÚPÜt
) {

58 
m_£ssiÚPÜt
 = 
£ssiÚPÜt
;

59 
	}
}

61 
QStus
 
	gAboutObjApi
::
	$AÂounû
() {

62 ià(
m_AboutObj
 =ğ
NULL
) {

63  
ER_FAIL
;

65  
m_AboutObj
->
	`AÂounû
(
m_£ssiÚPÜt
, *
m_AboutD©a
);

66 
	}
}

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/AboutObjApi.h

21 #iâdeà
ABOUT_DATA_API_H


22 
	#ABOUT_DATA_API_H


	)

24 
	~<qcc/Log.h
>

25 
	~<®ljoyn/v”siÚ.h
>

26 
	~<®ljoyn/AboutObj.h
>

27 
	~<®ljoyn/AboutD©a.h
>

29 
Çme¥aû
 
	gajn
 {

30 
Çme¥aû
 
	g£rviûs
 {

35 şas 
	cAboutObjApi
 {

37 
	gpublic
:

43 
AboutObjApi
* 
g‘In¡ªû
();

51 
In™
(
ajn
::
BusA‰achm’t
* 
bus
, 
AboutD©a
* 
aboutD©a
, 
AboutObj
* 
aboutObj
);

55 
De¡royIn¡ªû
();

60 
S‘PÜt
(
SessiÚPÜt
 
£ssiÚPÜt
);

64 
QStus
 
AÂounû
();

66 
	g´iv©e
:

70 
AboutObjApi
();

74 
	gvœtu®
 ~
AboutObjApi
();

78 
AboutObjApi
* 
	gm_š¡ªû
;

82 
BusA‰achm’t
* 
	gm_BusA‰achm’t
;

86 
AboutD©a
* 
	gm_AboutD©a
;

90 
AboutObj
* 
	gm_AboutObj
;

94 
SessiÚPÜt
 
	gm_£ssiÚPÜt
;

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/AnnounceHandlerImpl.cc

17 
	~"AÂounûHªdËrIm¶.h
"

18 
	~<io¡»am
>

20 
usšg
 
Çme¥aû
 
	gajn
;

22 
	gAÂounûHªdËrIm¶
::
	$AÂounûHªdËrIm¶
(
BasicAÂounûHªdËrC®lback
 
basicC®lback
, 
FuÎAÂounûHªdËrC®lback
 
fuÎC®lback
) :

23 
	`m_BasicC®lback
(
basicC®lback
), 
	$m_FuÎC®lback
(
fuÎC®lback
)

26 
	}
}

28 
	gAÂounûHªdËrIm¶
::~
	$AÂounûHªdËrIm¶
()

30 
	}
}

32 
AÂounûHªdËrIm¶
::
	$AÂounûd
(cÚ¡ * 
busName
, 
ušt16_t
 
v”siÚ
, 
SessiÚPÜt
 
pÜt
, cÚ¡ 
MsgArg
& 
objeùDesütiÚArg
, cÚ¡ MsgArg& 
aboutD©aArg
)

34 
¡d
::
cout
 << "*********************************************************************************" << std::
’dl
;

35 
¡d
::
cout
 << "AÂounû sigÇÈdiscov”ed" << std::
’dl
;

36 
¡d
::
cout
 << "\tFrom bu " << 
busName
 << std::
’dl
;

37 
¡d
::
cout
 << "\tAbouˆv”siÚ " << 
v”siÚ
 << std::
’dl
;

38 
¡d
::
cout
 << "\tSessiÚPÜˆ" << 
pÜt
 << std::
’dl
;

39 
¡d
::
cout
 << "\tObjeùDesütiÚ" << std::
’dl
 << 
objeùDesütiÚArg
.
	`ToSŒšg
().
	`c_¡r
() << std::endl;

40 
¡d
::
cout
 << "\tAboutD©a:" << std::
’dl
 << 
aboutD©aArg
.
	`ToSŒšg
().
	`c_¡r
() << std::endl;

41 
¡d
::
cout
 << "*********************************************************************************" << std::
’dl
;

43 
¡d
::
cout
 << "AÂounûHªdËrIm¶::AÂounûd()" << std::
’dl
;

44 ià(
m_BasicC®lback
) {

45 
¡d
::
cout
 << "C®lšg AÂounûHªdË¸C®lback" << std::
’dl
;

46 
	`m_BasicC®lback
(
busName
, 
pÜt
);

49 ià(
m_FuÎC®lback
) {

50 
¡d
::
cout
 << "C®lšg AÂounûHªdË¸C®lback" << std::
’dl
;

51 
AboutD©a
 
aboutD©a
;

52 
aboutD©a
.
	`C»©eäomMsgArg
(
aboutD©aArg
);

53 
AboutObjeùDesütiÚ
 
aboutObjeùDesütiÚ
;

54 
aboutObjeùDesütiÚ
.
	`C»©eFromMsgArg
(
objeùDesütiÚArg
);

55 
	`m_FuÎC®lback
(
busName
, 
v”siÚ
, 
pÜt
, 
aboutObjeùDesütiÚ
, 
aboutD©a
);

57 
	}
}

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/AnnounceHandlerImpl.h

17 #iâdeà
ANNOUNCEHANDLERSAMPLE_H_


18 
	#ANNOUNCEHANDLERSAMPLE_H_


	)

19 
	~<®ljoyn/AboutLi¡’”.h
>

20 
	~<®ljoyn/AboutD©a.h
>

22 (*
	tBasicAÂounûHªdËrC®lback
)(
	tqcc
::
	tSŒšg
 cÚ¡& 
	tbusName
, 
	tpÜt
);

23 (*
	tFuÎAÂounûHªdËrC®lback
)(
	tqcc
::
	tSŒšg
 cÚ¡& 
	tbusName
, 
	tv”siÚ
,

24 
	tpÜt
, cÚ¡ 
	tajn
::
	tAboutObjeùDesütiÚ
& 
	tobjeùDesütiÚ
,

25 cÚ¡ 
	tajn
::
	tAboutD©a
& 
	taboutD©a
);

29 şas 
	cAÂounûHªdËrIm¶
 : 
public
 
ajn
::
AboutLi¡’”
 {

31 
public
:

41 
vœtu®
 
	`AÂounûd
(cÚ¡ * 
busName
, 
ušt16_t
 
v”siÚ
, 
ajn
::
SessiÚPÜt
 
pÜt
, cÚ¡‡jn::
MsgArg
& 
objeùDesütiÚArg
, cÚ¡‡jn::MsgArg& 
aboutD©aArg
);

47 
	`AÂounûHªdËrIm¶
(
BasicAÂounûHªdËrC®lback
 
basicC®lback
 = 0, 
FuÎAÂounûHªdËrC®lback
 
fuÎC®lback
 = 0);

52 ~
	`AÂounûHªdËrIm¶
();

54 
´iv©e
:

56 
BasicAÂounûHªdËrC®lback
 
m_BasicC®lback
;

58 
FuÎAÂounûHªdËrC®lback
 
m_FuÎC®lback
;

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/AsyncSessionJoiner.cc

17 
	~"AsyncSessiÚJoš”.h
"

18 
	~"SessiÚLi¡’”Im¶.h
"

19 
	~<io¡»am
>

21 
usšg
 
Çme¥aû
 
	gajn
;

23 
	gAsyncSessiÚJoš”
::
	$AsyncSessiÚJoš”
(cÚ¡ * 
Çme
, 
SessiÚJošedC®lback
 
ÿÎback
) :

24 
	`m_Bu¢ame
(""), 
	$m_C®lback
(
ÿÎback
)

26 ià(
Çme
) {

27 
m_Bu¢ame
.
	`assign
(
Çme
);

29 
	}
}

31 
	gAsyncSessiÚJoš”
::~
	$AsyncSessiÚJoš”
()

34 
	}
}

36 
AsyncSessiÚJoš”
::
	$JošSessiÚCB
(
QStus
 
¡©us
, 
SessiÚId
 
id
, cÚ¡ 
SessiÚO±s
& 
İts
, * 
cÚ‹xt
)

38 ià(
¡©us
 =ğ
ER_OK
) {

39 
¡d
::
cout
 << "JošSessiÚCB(" << 
m_Bu¢ame
.
	`c_¡r
(è<< "èsucûeded w™h id" << 
id
 << std::
’dl
;

40 ià(
m_C®lback
) {

41 
¡d
::
cout
 << "C®lšg SessiÚJoš” C®lback" << std::
’dl
;

42 
	`m_C®lback
(
m_Bu¢ame
, 
id
);

45 
¡d
::
cout
 << "JošSessiÚCB(" << 
m_Bu¢ame
.
	`c_¡r
(è<< "èçed w™h stus: " << 
	`QCC_StusText
(
¡©us
è<< std::
’dl
;

48 
SessiÚLi¡’”Im¶
* 
li¡’”
 = (SessiÚLi¡’”Im¶*è
cÚ‹xt
;

49 
d–‘e
 
li¡’”
;

50 
d–‘e
 
this
;

51 
	}
}

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/AsyncSessionJoiner.h

17 #iâdeà
ASYNCSESSIONJOINER_H_


18 
	#ASYNCSESSIONJOINER_H_


	)

20 
	~<®ljoyn/BusA‰achm’t.h
>

22 (*
	tSessiÚJošedC®lback
)(
	tqcc
::
	tSŒšg
 cÚ¡& 
	tbusName
, 
	tajn
::
	tSessiÚId
 
	tid
);

27 şas 
	cAsyncSessiÚJoš”
 : 
public
 
ajn
::
BusA‰achm’t
::
JošSessiÚAsyncCB
 {

29 
public
:

35 
	`AsyncSessiÚJoš”
(cÚ¡ * 
Çme
, 
SessiÚJošedC®lback
 
ÿÎback
 = 0);

40 
vœtu®
 ~
	`AsyncSessiÚJoš”
();

49 
	`JošSessiÚCB
(
QStus
 
¡©us
, 
ajn
::
SessiÚId
 
id
, cÚ¡‡jn::
SessiÚO±s
& 
İts
, * 
cÚ‹xt
);

51 
´iv©e
:

53 
qcc
::
SŒšg
 
m_Bu¢ame
;

55 
SessiÚJošedC®lback
 
m_C®lback
;

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/CommonBusListener.cc

17 
	~"CommÚBusLi¡’”.h
"

18 
	~<io¡»am
>

19 
	~<®gÜ™hm
>

21 
usšg
 
Çme¥aû
 
	gajn
;

23 
	gCommÚBusLi¡’”
::
CommÚBusLi¡’”
(
ajn
::
BusA‰achm’t
* 
bus
, (*
d«mÚDiscÚÃùCB
)()) :

24 
	`BusLi¡’”
(), 
	`SessiÚPÜtLi¡’”
(), 
	`m_SessiÚPÜt
(0), 
	`m_Bus
(
bus
), 
	$m_D«mÚDiscÚÃùCB
(
d«mÚDiscÚÃùCB
)

26 
	}
}

28 
	gCommÚBusLi¡’”
::~
	$CommÚBusLi¡’”
()

30 
	}
}

32 
CommÚBusLi¡’”
::
£tSessiÚPÜt
(
ajn
::
SessiÚPÜt
 
£ssiÚPÜt
)

34 
m_SessiÚPÜt
 = 
£ssiÚPÜt
;

37 
SessiÚPÜt
 
	gCommÚBusLi¡’”
::
	$g‘SessiÚPÜt
()

39  
m_SessiÚPÜt
;

40 
	}
}

42 
boŞ
 
	gCommÚBusLi¡’”
::
Acû±SessiÚJoš”
(
ajn
::
SessiÚPÜt
 
£ssiÚPÜt
, cÚ¡ * 
još”
, cÚ¡‡jn::
SessiÚO±s
& 
İts
)

44 ià(
£ssiÚPÜt
 !ğ
m_SessiÚPÜt
) {

45  
çl£
;

48 
	g¡d
::
cout
 << "Acû±šg JošSessiÚReque¡" << 
¡d
::
’dl
;

49  
	gŒue
;

52 
	gCommÚBusLi¡’”
::
	$SessiÚJošed
(
SessiÚPÜt
 
£ssiÚPÜt
, 
SessiÚId
 
id
, cÚ¡ * 
još”
)

54 
¡d
::
cout
 << "SessiÚ ha b“Àjošed sucûssfuÎy" << std::
’dl
;

55 ià(
m_Bus
) {

56 
m_Bus
->
	`S‘SessiÚLi¡’”
(
id
, 
this
);

58 
m_SessiÚIds
.
	`push_back
(
id
);

59 
	}
}

61 
	gCommÚBusLi¡’”
::
	$SessiÚLo¡
(
SessiÚId
 
£ssiÚId
, 
SessiÚLo¡R—sÚ
 
»asÚ
)

63 
¡d
::
cout
 << "SessiÚ ha b“Àlo¡" << std::
’dl
;

64 
¡d
::
veùÜ
<
SessiÚId
>::
™”©Ü
 
™
 = std::
	`fšd
(
m_SessiÚIds
.
	`begš
(), m_SessiÚIds.
	`’d
(), 
£ssiÚId
);

65 ià(
™
 !ğ
m_SessiÚIds
.
	`’d
()) {

66 
m_SessiÚIds
.
	`”a£
(
™
);

68 
	}
}

70 
	gCommÚBusLi¡’”
::
	$BusDiscÚÃùed
()

72 
¡d
::
cout
 << "Bu ha b“ÀdiscÚÃùed" << std::
’dl
;

73 ià(
m_D«mÚDiscÚÃùCB
) {

74 
	`m_D«mÚDiscÚÃùCB
();

76 
	}
}

78 cÚ¡ 
	g¡d
::
veùÜ
<
SessiÚId
>& 
CommÚBusLi¡’”
::
	$g‘SessiÚIds
() const

80  
m_SessiÚIds
;

81 
	}
}

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/CommonBusListener.h

17 #iâdeà
COMMONBUSLISTENER_H_


18 
	#COMMONBUSLISTENER_H_


	)

20 
	~<®ljoyn/BusA‰achm’t.h
>

21 
	~<®ljoyn/BusLi¡’”.h
>

22 
	~<®ljoyn/SessiÚPÜtLi¡’”.h
>

23 
	~<veùÜ
>

28 
şass
 
	gCommÚBusLi¡’”
 : 
public
 
ajn
::
BusLi¡’”
,…ubliø
	gajn
::
SessiÚPÜtLi¡’”
,…ubliøajn::
SessiÚLi¡’”
 {

30 
public
:

37 
CommÚBusLi¡’”
(
ajn
::
BusA‰achm’t
* 
bus
 = 
NULL
, (*
d«mÚDiscÚÃùCB
)() = NULL);

42 ~
CommÚBusLi¡’”
();

51 
boŞ
 
Acû±SessiÚJoš”
(
ajn
::
SessiÚPÜt
 
£ssiÚPÜt
, cÚ¡ * 
još”
, cÚ¡‡jn::
SessiÚO±s
& 
İts
);

57 
£tSessiÚPÜt
(
ajn
::
SessiÚPÜt
 
£ssiÚPÜt
);

65 
SessiÚJošed
(
ajn
::
SessiÚPÜt
 
£ssiÚPÜt
,‡jn::
SessiÚId
 
id
, cÚ¡ * 
još”
);

72 
SessiÚLo¡
(
ajn
::
SessiÚId
 
£ssiÚId
, 
SessiÚLo¡R—sÚ
 
»asÚ
);

78 
	gajn
::
SessiÚPÜt
 
g‘SessiÚPÜt
();

84 cÚ¡ 
	g¡d
::
veùÜ
<
ajn
::
SessiÚId
>& 
g‘SessiÚIds
() const;

89 
BusDiscÚÃùed
();

91 
	g´iv©e
:

96 
ajn
::
SessiÚPÜt
 
m_SessiÚPÜt
;

101 
	gajn
::
BusA‰achm’t
* 
m_Bus
;

106 
	g¡d
::
veùÜ
<
ajn
::
SessiÚId
> 
m_SessiÚIds
;

111 (*
	gm_D«mÚDiscÚÃùCB
)();

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/CommonSampleUtil.cc

17 
	~<®gÜ™hm
>

18 
	~"CommÚSam¶eUt.h
"

19 
	~"AboutObjApi.h
"

20 
	~<qcc/SŒšgUt.h
>

21 
	~<¡dio.h
>

23 
usšg
 
Çme¥aû
 
	gajn
;

24 
usšg
 
Çme¥aû
 
	g£rviûs
;

26 
	#CHECK_RETURN
(
x
èià((
¡©us
 = xè!ğ
ER_OK
è{  stus; }

	)

28 
BusA‰achm’t
* 
	gCommÚSam¶eUt
::
´•¬eBusA‰achm’t
(
ajn
::
AuthLi¡’”
* 
authLi¡’”
)

30 
BusA‰achm’t
* 
bus
 = 
Ãw
 BusA‰achm’t("CommÚS”viûAµ", 
Œue
);

33 
QStus
 
	g¡©us
 = 
bus
->
S¹
();

34 ià(
	g¡©us
 !ğ
ER_OK
) {

35 
d–‘e
 
bus
;

36  
	gNULL
;

40 
	g¡©us
 = 
bus
->
CÚÃù
();

41 ià(
	g¡©us
 !ğ
ER_OK
) {

42 
d–‘e
 
bus
;

43  
	gNULL
;

46 ià(
	gauthLi¡’”
) {

47 
	g¡©us
 = 
CommÚSam¶eUt
::
EÇbËSecur™y
(
bus
, 
authLi¡’”
);

48 ià(
	g¡©us
 !ğ
ER_OK
) {

49 
d–‘e
 
bus
;

50  
	gNULL
;

54  
	gbus
;

57 
QStus
 
	gCommÚSam¶eUt
::
flAboutD©a
(
AboutD©a
* 
aboutd©a
, 
qcc
::
SŒšg
 cÚ¡& 
­pIdHex
,

58 
qcc
::
SŒšg
 cÚ¡& 
­pName
, qcc::SŒšg cÚ¡& 
deviûId
, 
DeviûNamesTy³
 cÚ¡& 
deviûNames
,

59 
qcc
::
SŒšg
 cÚ¡& 
deçuÉLªguage
)

61 ià(!
aboutd©a
) {

62  
ER_BAD_ARG_1
;

65 
QStus
 
	g¡©us
 = 
ER_OK
;

67 ià(!
	g­pIdHex
.
em±y
()) {

68 
CHECK_RETURN
(
aboutd©a
->
S‘AµId
(
­pIdHex
.
c_¡r
()));

71 ià(
	gdeviûId
 != "") {

72 
CHECK_RETURN
(
aboutd©a
->
S‘DeviûId
(
deviûId
.
c_¡r
()))

75 
¡d
::
veùÜ
<
qcc
::
SŒšg
> 
Ïnguages
(3);

76 
	gÏnguages
[0] = "en";

77 
	gÏnguages
[1] = "es";

78 
	gÏnguages
[2] = "fr";

80 
size_t
 
	gi
 = 0; i < 
	gÏnguages
.
size
(); i++) {

81 
CHECK_RETURN
(
aboutd©a
->
S‘SuµÜ‹dLªguage
(
Ïnguages
[
i
].
c_¡r
()))

84 ià(
	gdeçuÉLªguage
 != "") {

85 
CHECK_RETURN
(
aboutd©a
->
S‘DeçuÉLªguage
(
deçuÉLªguage
.
c_¡r
()))

88 ià(
­pName
 != "") {

89 
CHECK_RETURN
(
aboutd©a
->
S‘AµName
(
­pName
.
c_¡r
(), 
Ïnguages
[0].c_str()))

90 
CHECK_RETURN
(
aboutd©a
->
S‘AµName
(
­pName
.
c_¡r
(), 
Ïnguages
[1].c_str()))

91 
CHECK_RETURN
(
aboutd©a
->
S‘AµName
(
­pName
.
c_¡r
(), 
Ïnguages
[2].c_str()))

94 
CHECK_RETURN
(
aboutd©a
->
S‘Mod–Numb”
("Wxfy388i"))

95 
CHECK_RETURN
(
aboutd©a
->
S‘D©eOfMªuçùu»
("10/1/2199"))

96 
CHECK_RETURN
(
aboutd©a
->
S‘Soáw¬eV”siÚ
("12.20.44 build 44454"))

97 
CHECK_RETURN
(
aboutd©a
->
S‘H¬dw¬eV”siÚ
("355.499. b"))

99 
DeviûNamesTy³
::
cÚ¡_™”©Ü
 
™”
 = 
deviûNames
.
fšd
(
Ïnguages
[0]);

100 ià(
	g™”
 !ğ
deviûNames
.
’d
()) {

101 
CHECK_RETURN
(
aboutd©a
->
S‘DeviûName
(
™”
->
£cÚd
.
c_¡r
(), 
Ïnguages
[0].c_str()));

103 
CHECK_RETURN
(
aboutd©a
->
S‘DeviûName
("My device‚ame", "en"));

106 
	g™”
 = 
deviûNames
.
fšd
(
Ïnguages
[1]);

107 ià(
	g™”
 !ğ
deviûNames
.
’d
()) {

108 
CHECK_RETURN
(
aboutd©a
->
S‘DeviûName
(
™”
->
£cÚd
.
c_¡r
(), 
Ïnguages
[1].c_str()));

110 
CHECK_RETURN
(
aboutd©a
->
S‘DeviûName
("Mi‚ombre de dispositivo", "es"));

113 
	g™”
 = 
deviûNames
.
fšd
(
Ïnguages
[2]);

114 ià(
	g™”
 !ğ
deviûNames
.
’d
()) {

115 
CHECK_RETURN
(
aboutd©a
->
S‘DeviûName
(
™”
->
£cÚd
.
c_¡r
(), 
Ïnguages
[2].c_str()));

117 
CHECK_RETURN
(
aboutd©a
->
S‘DeviûName
("Mon‚om de†'appareil", "fr"));

120 
CHECK_RETURN
(
aboutd©a
->
S‘DesütiÚ
("This is‡n Alljoyn Application", "en"))

121 
CHECK_RETURN
(
aboutd©a
->
S‘DesütiÚ
("Estaƒs una Alljoyn‡plicacion", "es"))

122 
CHECK_RETURN
(
aboutd©a
->
S‘DesütiÚ
("C'est une Alljoyn‡pplication", "fr"))

124 
CHECK_RETURN
(
aboutd©a
->
S‘Mªuçùu»r
("Company", "en"))

125 
CHECK_RETURN
(
aboutd©a
->
S‘Mªuçùu»r
("Empresa", "es"))

126 
CHECK_RETURN
(
aboutd©a
->
S‘Mªuçùu»r
("Entreprise", "fr"))

128 
CHECK_RETURN
(
aboutd©a
->
S‘SuµÜtU¾
("http://www.alljoyn.org"))

130 ià(!
	gaboutd©a
->
IsV®id
()) {

131 
´štf
("failedo setup‡bout data.\n");

132  
	gER_FAIL
;

134  
	g¡©us
;

137 
QStus
 
	gCommÚSam¶eUt
::
	$´•¬eAboutS”viû
(
BusA‰achm’t
* 
bus
, 
AboutD©a
* 
aboutD©a
, 
AboutObj
* 
aboutObj
,

138 
CommÚBusLi¡’”
* 
busLi¡’”
, 
ušt16_t
 
pÜt
)

140 ià(!
bus
) {

141  
ER_BAD_ARG_1
;

144 ià(!
aboutD©a
) {

145  
ER_BAD_ARG_2
;

148 ià(!
busLi¡’”
) {

149  
ER_BAD_ARG_3
;

152 
AboutObjApi
::
	`In™
(
bus
, 
aboutD©a
, 
aboutObj
);

153 
AboutObjApi
* 
aboutS”viû
 = AboutObjApi::
	`g‘In¡ªû
();

154 ià(!
aboutS”viû
) {

155  
ER_BUS_NOT_ALLOWED
;

158 
busLi¡’”
->
	`£tSessiÚPÜt
(
pÜt
);

159 
bus
->
	`Regi¡”BusLi¡’”
(*
busLi¡’”
);

161 
T¿n¥ÜtMask
 
Œª¥ÜtMask
 = 
TRANSPORT_ANY
;

162 
SessiÚPÜt
 
¥
 = 
pÜt
;

163 
SessiÚO±s
 
	`İts
(SessiÚO±s::
TRAFFIC_MESSAGES
, 
çl£
, SessiÚO±s::
PROXIMITY_ANY
, 
Œª¥ÜtMask
);

165 
QStus
 
¡©us
 = 
bus
->
	`BšdSessiÚPÜt
(
¥
, 
İts
, *
busLi¡’”
);

166 ià(
¡©us
 !ğ
ER_OK
) {

167  
¡©us
;

170 
aboutS”viû
->
	`S‘PÜt
(
pÜt
);

172  
ER_OK
;

173 
	}
}

175 
QStus
 
	gCommÚSam¶eUt
::
	$aboutS”viûAÂounû
()

177 
AboutObjApi
* 
aboutS”viû
 = AboutObjApi::
	`g‘In¡ªû
();

178 ià(!
aboutS”viû
) {

179  
ER_BUS_NOT_ALLOWED
;

182  (
aboutS”viû
->
	`AÂounû
());

183 
	}
}

185 
	gCommÚSam¶eUt
::
	$aboutS”viûDe¡roy
(
BusA‰achm’t
* 
bus
,

186 
CommÚBusLi¡’”
* 
busLi¡’”
)

188 ià(
bus
 && 
busLi¡’”
) {

189 
bus
->
	`UÄegi¡”BusLi¡’”
(*
busLi¡’”
);

190 
bus
->
	`UnbšdSessiÚPÜt
(
busLi¡’”
->
	`g‘SessiÚPÜt
());

193 
AboutObjApi
::
	`De¡royIn¡ªû
();

195 
	}
}

197 
QStus
 
	gCommÚSam¶eUt
::
	$EÇbËSecur™y
(
BusA‰achm’t
* 
bus
, 
AuthLi¡’”
* 
authLi¡’”
)

199 
QStus
 
¡©us
 = 
bus
->
	`EÇbËP“rSecur™y
("ALLJOYN_PIN_KEYX ALLJOYN_SRP_KEYX ALLJOYN_ECDHE_PSK", 
authLi¡’”
);

200  
¡©us
;

201 
	}
}

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/CommonSampleUtil.h

17 #iâdeà
COMMONSAMPLEUTIL_H_


18 
	#COMMONSAMPLEUTIL_H_


	)

20 
	~<®ljoyn/BusA‰achm’t.h
>

21 
	~<qcc/SŒšg.h
>

22 
	~<®ljoyn/AboutD©a.h
>

23 
	~<®ljoyn/AboutObj.h
>

24 
	~"AboutObjApi.h
"

25 
	~"CommÚBusLi¡’”.h
"

26 
	~<m­
>

28 
	g¡d
::
	tm­
<
	tqcc
::
	tSŒšg
, qcc::SŒšg> 
	tDeviûNamesTy³
;

33 şas 
	cCommÚSam¶eUt
 {

34 
	mpublic
:

41 
ajn
::
BusA‰achm’t
* 
´•¬eBusA‰achm’t
×jn::
AuthLi¡’”
* 
authLi¡’”
 = 0);

53 
QStus
 
flAboutD©a
(
ajn
::
AboutD©a
* 
aboutD©a
, 
qcc
::
SŒšg
 cÚ¡& 
­pIdHex
,

54 
qcc
::
SŒšg
 cÚ¡& 
­pName
, qcc::SŒšg cÚ¡& 
deviûId
, 
DeviûNamesTy³
 cÚ¡& 
deviûNames
,

55 
qcc
::
SŒšg
 cÚ¡& 
deçuÉLªguage
 = "en");

66 
QStus
 
´•¬eAboutS”viû
(
ajn
::
BusA‰achm’t
* 
bus
,‡jn::
AboutD©a
* 
aboutD©a
,‡jn::
AboutObj
* 
aboutObj
,

67 
CommÚBusLi¡’”
* 
busLi¡’”
, 
ušt16_t
 
pÜt
);

73 
QStus
 
aboutS”viûAÂounû
();

80 
aboutS”viûDe¡roy
(
ajn
::
BusA‰achm’t
* 
bus
, 
CommÚBusLi¡’”
* 
busLi¡’”
);

82 
	m´iv©e
:

90 
QStus
 
EÇbËSecur™y
(
ajn
::
BusA‰achm’t
* 
bus
,‡jn::
AuthLi¡’”
* 
authLi¡’”
);

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/SessionListenerImpl.cc

17 
	~"SessiÚLi¡’”Im¶.h
"

18 
	~<io¡»am
>

20 
	gSessiÚLi¡’”Im¶
::
SessiÚLi¡’”Im¶
(
qcc
::
SŒšg
 cÚ¡& 
šS”viûNAme
) :

21 
	$£rviûName
(
šS”viûNAme
)

23 
	}
}

25 
SessiÚLi¡’”Im¶
::~
	$SessiÚLi¡’”Im¶
()

27 
	}
}

29 
SessiÚLi¡’”Im¶
::
SessiÚLo¡
(
ajn
::
SessiÚId
 
£ssiÚId
)

31 
¡d
::
cout
 << "AboutCl›Á sessiÚ ha b“Àlo¡ fÜ " << 
£rviûName
.
c_¡r
(è<< std::
’dl
;

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/SessionListenerImpl.h

17 #iâdeà
SESSIONLISTENERIMPL_H_


18 
	#SESSIONLISTENERIMPL_H_


	)

20 
	~<®ljoyn/SessiÚLi¡’”.h
>

21 
	~<qcc/SŒšg.h
>

26 şas 
	cSessiÚLi¡’”Im¶
 : 
public
 
ajn
::
SessiÚLi¡’”
 {

27 
public
:

32 
SessiÚLi¡’”Im¶
(
qcc
::
SŒšg
 cÚ¡& 
šS”viûNAme
);

37 
	mvœtu®
 ~
SessiÚLi¡’”Im¶
();

43 
SessiÚLo¡
(
ajn
::
SessiÚId
 
£ssiÚId
);

45 
	m´iv©e
:

47 
qcc
::
SŒšg
 
£rviûName
;

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/SrpKeyXListener.cc

17 
	~"S½KeyXLi¡’”.h
"

18 
	~<io¡»am
>

20 
	gS½KeyXLi¡’”
::
	$S½KeyXLi¡’”
(è: 
	`m_PassCode
("000000"), 
	$m_G‘PassCode
(0)

24 
	}
}

26 
	gS½KeyXLi¡’”
::~
	$S½KeyXLi¡’”
()

29 
	}
}

31 
S½KeyXLi¡’”
::
£tPassCode
(
qcc
::
SŒšg
 cÚ¡& 
·ssCode
)

33 
m_PassCode
 = 
·ssCode
;

36 
	gS½KeyXLi¡’”
::
£tG‘PassCode
((*
g‘PassCode
)(
qcc
::
SŒšg
&))

38 
m_G‘PassCode
 = 
g‘PassCode
;

39 
	}
}

41 
boŞ
 
	gS½KeyXLi¡’”
::
	$Reque¡C»d’tŸls
(cÚ¡ * 
authMechªism
, cÚ¡ * 
authP“r
,

42 
ušt16_t
 
authCouÁ
, cÚ¡ * 
u£rId
, ušt16_ˆ
üedMask
, 
C»d’tŸls
& 
üeds
)

44 
¡d
::
cout
 << "Reque¡C»d’tŸl fÜ‡uth’tiÿtšg " << 
authP“r
 << " usšg mechªism " << 
authMechªism
 << std::
’dl
;

45 ià(
	`¡rcmp
(
authMechªism
, "ALLJOYN_SRP_KEYX") == 0 || strcmp(authMechanism, "ALLJOYN_PIN_KEYX") == 0 || strcmp(authMechanism, "ALLJOYN_ECDHE_PSK") == 0) {

46 ià(
üedMask
 & 
AuthLi¡’”
::
CRED_PASSWORD
) {

47 ià(
authCouÁ
 <= 3) {

48 
qcc
::
SŒšg
 
·ssCodeFromG‘
;

49 ià(
m_G‘PassCode
) {

50 
	`m_G‘PassCode
(
·ssCodeFromG‘
);

52 
¡d
::
cout
 << "Reque¡C»d’tŸl £tPasscodtØ" << (
m_G‘PassCode
 ? 
·ssCodeFromG‘
.
	`c_¡r
(è: 
m_PassCode
.c_¡r()è<< std::
’dl
;

53 
üeds
.
	`S‘PasswÜd
(
m_G‘PassCode
 ? 
·ssCodeFromG‘
.
	`c_¡r
(è: 
m_PassCode
.c_str());

54  
Œue
;

56  
çl£
;

60  
çl£
;

61 
	}
}

63 
	gS½KeyXLi¡’”
::
	$Auth’tiÿtiÚCom¶‘e
(cÚ¡ * 
authMechªism
, cÚ¡ * 
authP“r
, 
boŞ
 
sucûss
)

65 
¡d
::
cout
 << "Auth’tiÿtiÚ w™h " << 
authMechªism
 << (
sucûss
 ? " wa sucûssful" : " faed"è<< std::
’dl
;

66 
	}
}

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/SrpKeyXListener.h

17 #iâdeà
SRPKEYLISTENER_H_


18 
	#SRPKEYLISTENER_H_


	)

20 
	~<®ljoyn/AuthLi¡’”.h
>

26 şas 
	cS½KeyXLi¡’”
 : 
public
 
ajn
::
AuthLi¡’”
 {

27 
public
:

31 
S½KeyXLi¡’”
();

36 
	mvœtu®
 ~
S½KeyXLi¡’”
();

42 
£tPassCode
(
qcc
::
SŒšg
 cÚ¡& 
·ssCode
);

48 
£tG‘PassCode
((*
g‘PassCode
)(
qcc
::
SŒšg
&));

60 
boŞ
 
	`Reque¡C»d’tŸls
(cÚ¡ * 
authMechªism
, cÚ¡ * 
authP“r
, 
ušt16_t
 
authCouÁ
, cÚ¡ * 
u£rId
,

61 
ušt16_t
 
üedMask
, 
C»d’tŸls
& 
üeds
);

69 
	`Auth’tiÿtiÚCom¶‘e
(cÚ¡ * 
authMechªism
, cÚ¡ * 
authP“r
, 
boŞ
 
sucûss
);

71 
´iv©e
:

72 
qcc
::
SŒšg
 
m_PassCode
;

74 (*
m_G‘PassCode
)(
qcc
::
SŒšg
&);

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/share.h

1 
	~<¡dio.h
>

2 
	~<¡ršg.h
>

3 
	~<”ºo.h
>

4 
	~<¡dlib.h
>

5 
	~<sys/sock‘.h
>

6 
	~<sys/ioùl.h
>

7 
	~<Ãtš‘/š.h
>

8 
	~<Ãtš‘/tı.h
>

9 
	~<lšux/Ãšk.h
>

10 
	~<”ºo.h
>

11 
	~<Ãtš‘/š.h
>

12 
	~<¬·/š‘.h
>

13 
	~<Ãtdb.h
>

14 
	~<sys/£ndfe.h
>

15 
	~<sys/ty³s.h
>

16 
	~<sys/¡©.h
>

17 
	~<fú.h
>

18 
	~<sys/time.h
>

19 
	~<uni¡d.h
>

20 
	~<libubox/u¡»am.h
>

21 
	~<libubus.h
>

22 
	~<sigÇl.h
>

23 
	~<libubox/blobmsg_jsÚ.h
>

24 
	~<uci.h
>

25 
	~"şoudc_log.h
"

27 
	#CLOUD_SERVER_MANAGE_IP
 "192.168.1.10"

	)

28 
	#CLOUD_SERVER_MANAGE_PORT
 3000

	)

29 
	#CLOUD_SERVER_MANAGE_IP
 "115.29.49.52"

	)

30 
	#CLOUD_SERVER_MANAGE_PORT
 80

	)

32 
	#RECV_MAX_BUF_LEN
 4096

	)

33 
	#SEND_MAX_BUF_LEN
 4096

	)

34 
	#RECV_TIME_OUT
 30

	)

35 
	#SEND_TIME_OUT
 30

	)

37 
	#MAX_INTERFACE_LEN
 128

	)

38 
	#MAX_OBJECTPATH_LEN
 128

	)

39 
	#MAX_DEVICETYPE_LEN
 32

	)

40 
	#MAX_DEVICEID_LEN
 32

	)

41 
	#MAX_DEVICESN_LEN
 32

	)

42 
	#MAX_ONLINESTATUS_LEN
 4

	)

43 
	#MAX_MANUFACTURE_LEN
 32

	)

44 
	#MAX_MODULENUMBER_LEN
 32

	)

45 
	#MAX_USERID_LEN
 32

	)

48 
	#MAX_DEVDATA_LEN
 512

	)

49 
	#MAX_MAC_LEN
 18

	)

50 
	#MAX_SN_LEN
 32

	)

51 
	#MAX_IP_LEN
 16

	)

53 
	#DATA_CONVERT_FILE_PATH
 "/‘c/cÚfig/D©aCÚv”t.xml"

	)

54 
	#DEVICE_DATABASE_PATH
 "/u¤/bš/deviû.db"

	)

56 
uloİ_fd
 
şoudc_mÚ™Ü_uloİ_fd
;

57 
sockaddr_š
 
£rv”_addr
;

58 
ubus_cÚ‹xt
 *
şoudc_ùx
;

60 
­_mac
[
MAX_MAC_LEN
] ;

61 
­_¢
[
MAX_SN_LEN
] ;

62 
şoudc_£rv”_
[
MAX_IP_LEN
];

63 
şoudc_£rv”_pÜt
;

64 
şoudc_log_Ëv–_št
;

65 
­_»gi¡”_æag
;

66 
li¡_node
 
queue_h—d
;

67 
uloİ_timeout
 
»gi¡”_»cv_tim”
;

68 
uloİ_timeout
 
£nd_tim”
;

69 
±h»ad_mu‹x_t
 
mu‹x
;

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/socket.c

1 
	~"sh¬e.h
"

2 
	~"·r£r.h
"

4 
	#TCP_KEEPALIVE
 1

5 

	)

6 
sockaddr_š
 
	g£rv”_addr
;

8 
is_sock‘_cÚÃùed
(
fd
);

9 
sock‘_š™
();

10 
sock‘_ü—‹
();

11 
sock‘_cÚÃù
();

13 
	$sock‘_š™
()

15 
timev®
 
timeout
 = {3,0};

17 
	`şoudc_debug
("%s[%d]: EÁ” ", 
__func__
, 
__LINE__
);

19 iàĞ0 =ğ
	`sock‘_ü—‹
())

21 
	`sock‘_cÚÃù
();

26 if(1 =ğ
TCP_KEEPALIVE
)

28 
k“·live
 = 1;

29 
k“pidË
 = 30;

30 
k“pš‹rv®
 = 10;

31 
k“pcouÁ
 = 3;

33 
»s
 = 
	`£tsockİt
(
şoudc_mÚ™Ü_uloİ_fd
.
fd
, 
SOL_SOCKET
, 
SO_KEEPALIVE
, (*)&
k“·live
 , (keepalive));

34 ià(
»s
 < 0)

36 
	`³¼Ü
("setsockoptƒrror:");

39 
»s1
 = 
	`£tsockİt
(
şoudc_mÚ™Ü_uloİ_fd
.
fd
, 
SOL_TCP
, 
TCP_KEEPIDLE
, (*)&
k“pidË
 , (keepidle));

40 ià(
»s1
 < 0)

42 
	`³¼Ü
("setsockoptƒrror:");

46 
»s2
 = 
	`£tsockİt
(
şoudc_mÚ™Ü_uloİ_fd
.
fd
, 
SOL_TCP
, 
TCP_KEEPINTVL
, (*)&
k“pš‹rv®
 , (keepinterval));

47 ià(
»s2
 < 0)

49 
	`³¼Ü
("setsockoptƒrror:");

52 
»s3
 = 
	`£tsockİt
(
şoudc_mÚ™Ü_uloİ_fd
.
fd
, 
SOL_TCP
, 
TCP_KEEPCNT
, (*)&
k“pcouÁ
 , (keepcount));

53 ià(
»s3
 < 0)

55 
	`³¼Ü
("setsockoptƒrror:");

59 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

61 
	}
}

65 
	$sock‘_ü—‹
()

67 
	`şoudc_debug
("%s[%d]: EÁ” ", 
__func__
, 
__LINE__
);

70 ià((
şoudc_mÚ™Ü_uloİ_fd
.
fd
 = 
	`sock‘
(
AF_INET
,
SOCK_STREAM
,0)) < 0)

72 
	`³¼Ü
("socketƒrror:");

73 
	`¦“p
(10);

77 
	`şoudc_debug
("%s[%d]: sock‘ c¼—‹ sucûed, fd = %d", 
__func__
, 
__LINE__
, 
şoudc_mÚ™Ü_uloİ_fd
.
fd
);

78 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

82 
	}
}

84 
	$sock‘_cÚÃù
()

87 
couÁ
 = 0;

88 
	`şoudc_debug
("%s[%d]: EÁ” ", 
__func__
, 
__LINE__
);

89 
	`mem£t
(&
£rv”_addr
,0,(server_addr));

90 
£rv”_addr
.
sš_çmy
 = 
AF_INET
;

91 
£rv”_addr
.
sš_addr
.
s_addr
 = 
	`š‘_addr
(
şoudc_£rv”_
);

92 
£rv”_addr
.
sš_pÜt
 = 
	`htÚs
(
şoudc_£rv”_pÜt
);

96 
»t
 = 
	`cÚÃù
(
şoudc_mÚ™Ü_uloİ_fd
.
fd
, (
sockaddr
 *)&
£rv”_addr
, (server_addr));

97 ià(
»t
 < 0)

99 
	`³¼Ü
("connectƒrror:");

100 
couÁ
 = count + 1;

101 
	`¦“p
(10*
couÁ
);

105 
	`şoudc_debug
("%s[%d]: sock‘ cÚÃù sucûed,„‘ = %d", 
__func__
, 
__LINE__
, 
»t
);

106 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

110 
	}
}

114 
	$is_sock‘_cÚÃùed
(
fd
)

116 
”rÜ
 = 0;

117 
sockËn_t
 
Ën
 =  (
”rÜ
);

119 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

121 
»t
 = 
	`g‘sockİt
 (
fd
, 
SOL_SOCKET
, 
SO_ERROR
, &
”rÜ
, &
Ën
);

123 ià(
»t
 != 0)

125 
	`şoudc_debug
("çedØg‘ sock‘ƒ¼Ü code: %s", 
	`¡»¼Ü
(
»t
));

126 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

130 ià(
”rÜ
 != 0)

132 
	`şoudc_”rÜ
("sock‘ƒ¼Ü: %s", 
	`¡»¼Ü
(
”ºo
));

133 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

137 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

139 
	}
}

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/task_queue.c

1 
	~"sh¬e.h
"

2 
	~"·r£r.h
"

4 
li¡_node
 
	gqueue_h—d
;

5 
sk_queue_š™
(
li¡_node
 *
q_h—d
);

6 
sk_queue_’que
(
li¡_node
 *
q_h—d
, 
h‰p_v®ue
 *
»cv_d©a
);

7 
sk_queue_deque
(
li¡_node
 *
q_h—d
);

8 
sk_queue_Ëngth
(
li¡_node
 *
q_h—d
);

9 
sk_queue_is_em±y
(
li¡_node
 *
q_h—d
);

10 
sk_queue_´št
(
li¡_node
 *
q_h—d
);

13 
	$sk_queue_š™
(
li¡_node
 *
q_h—d
)

15 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

17 
	`mem£t
(
q_h—d
, 0, (
li¡_node
));

19 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

20 
	}
}

23 
	$sk_queue_’que
(
li¡_node
 *
q_h—d
, 
h‰p_v®ue
 *
»cv_d©a
)

25 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

27 
li¡_node
 *
q_tmp
 = 
q_h—d
;

29 
sk_d©a_node
* 
qn_±r
 = (sk_d©a_node*)
	`m®loc
((task_data_node));

31 if(
NULL
 =ğ
qn_±r
)

33 
	`şoudc_”rÜ
("%s[%d]: m®loøçed", 
__func__
, 
__LINE__
);

36 
	`mem£t
(
qn_±r
, 0, (
sk_d©a_node
));

38 
	`memıy
(&(
qn_±r
->
d©a
), 
»cv_d©a
, (qn_ptr->data));

41 
NULL
 !ğ
q_tmp
->
Ãxt
)

43 
q_tmp
 = q_tmp->
Ãxt
;

46 
q_tmp
->
Ãxt
 = &(
qn_±r
->
sk_li¡_node
);

48 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

50 
	}
}

53 
	$sk_queue_deque
(
li¡_node
 *
q_h—d
)

55 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

57 
sk_d©a_node
 *
qn_tmp_±r
;

58 
sk_d©a_node
 *
queue_node
;

60 ià(
NULL
 =ğ
q_h—d
->
Ãxt
)

62 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

69 
	`şoudc_½c_m‘hod_hªdË
(((
sk_d©a_node
*)(
q_h—d
->
Ãxt
))->
d©a
);

72 
qn_tmp_±r
 = 
q_h—d
->
Ãxt
;

73 
q_h—d
->
Ãxt
 = q_head->next->next;

74 
	`ä“
((
sk_d©a_node
*)(
qn_tmp_±r
));

77 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

79 
	}
}

82 
	$sk_queue_´št
(
li¡_node
 *
q_h—d
)

84 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

86 
li¡_node
 *
q_tmp
 = 
q_h—d
;

87 
NULL
 !ğ
q_tmp
->
Ãxt
)

89 
	`şoudc_debug
("%s[%d]:„egi¡”_¡©u ğ%d\n", 
__func__
, 
__LINE__
, ((
sk_d©a_node
*)(
q_tmp
->
Ãxt
))->
d©a
.
»gi¡”_¡©us
);

90 
q_tmp
 = q_tmp->
Ãxt
;

92 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

94 
	}
}

97 
	$sk_queue_Ëngth
(
li¡_node
 *
q_h—d
)

99 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

101 
couÁ
 = 0;

102 
li¡_node
 *
q_tmp
 = 
q_h—d
;

104 
NULL
 !ğ
q_tmp
->
Ãxt
)

106 
couÁ
 ++;

107 
q_tmp
 = q_tmp->
Ãxt
;

110 
	`şoudc_debug
("%s[%d]:ask_queue_Ëngth = %d\n", 
__func__
, 
__LINE__
, 
couÁ
);

111 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

112  
couÁ
;

113 
	}
}

116 
	$sk_queue_is_em±y
(
li¡_node
 *
q_h—d
)

118 if(
NULL
 =ğ
q_h—d
->
Ãxt
)

120  
EMPTY
;

124  
NOT_EMPTY
;

126 
	}
}

	@/home/james/code/iot_home_gw/mtk/package/fxagent/src/ubus.c

1 
	~"sh¬e.h
"

3 
şoudc_ubus_š™
();

4 
hªdË_logËv–_upd©e
(
ubus_cÚ‹xt
 *
ùx
, 
ubus_objeù
 *
obj
,

5 
ubus_»que¡_d©a
 *
»q
, cÚ¡ *
m‘hod
,

6 
blob_©Œ
 *
msg
);

8 
şoudc_d‘eù_»cv_»gi¡”_¡©us_timeout
(
uloİ_timeout
 *
t
);

10 
uloİ_timeout
 
	g»gi¡”_»cv_tim”
 = {

11 .
cb
 = 
şoudc_d‘eù_»cv_»gi¡”_¡©us_timeout
,

14 
şoudc_d‘eù_£nd_timeout
(
uloİ_timeout
 *
t
);

16 
uloİ_timeout
 
	g£nd_tim”
 = {

17 .
cb
 = 
şoudc_d‘eù_£nd_timeout
,

22 
	mLOGLEVEL
,

23 
	m__LOGLEVEL_MAX


26 
ubus_cÚ‹xt
 *
	gşoudc_ùx
;

28 cÚ¡ 
blobmsg_pŞicy
 
	ghªdË_logËv–_pŞicy
[] = {

29 [
LOGLEVEL
] = { .
Çme
 = "logËv–", .
	gty³
 = 
BLOBMSG_TYPE_STRING
 },

32 cÚ¡ 
ubus_m‘hod
 
	gşoudc_objeù_m‘hods
[] = {

34 
UBUS_METHOD
("logËv–", 
hªdË_logËv–_upd©e
, 
hªdË_logËv–_pŞicy
),

37 
ubus_objeù_ty³
 
	gşoudc_objeù_ty³
 =

38 
UBUS_OBJECT_TYPE
("şoudc", 
şoudc_objeù_m‘hods
);

40 
ubus_objeù
 
	gşoudc_objeù
 = {

41 .
Çme
 = "cloudc",

42 .
	gty³
 = &
şoudc_objeù_ty³
,

43 .
	gm‘hods
 = 
şoudc_objeù_m‘hods
,

44 .
	gn_m‘hods
 = 
ARRAY_SIZE
(
şoudc_objeù_m‘hods
),

47 
	$hªdË_logËv–_upd©e
(
ubus_cÚ‹xt
 *
ùx
, 
ubus_objeù
 *
obj
,

48 
ubus_»que¡_d©a
 *
»q
, cÚ¡ *
m‘hod
,

49 
blob_©Œ
 *
msg
)

51 
blob_©Œ
 *
tb
[
__LOGLEVEL_MAX
];

52 *
log_buf
 = 
NULL
;

53 
cmd
[128] = {0};

55 
	`şoudc_debug
("%s[%d]: EÁ” ", 
__func__
, 
__LINE__
);

56 
	`blobmsg_·r£
(
hªdË_logËv–_pŞicy
, 
	`ARRAY_SIZE
(hªdË_logËv–_pŞicy), 
tb
, 
	`blob_d©a
(
msg
), 
	`blob_Ën
(msg));

58 ià(
tb
[
LOGLEVEL
])

60 
log_buf
 = 
	`blobmsg_d©a
(
tb
[
LOGLEVEL
]);

62 iàĞ
NULL
 !ğ
	`¡rÿ£¡r
(
log_buf
, "debug"))

64 
şoudc_log_Ëv–_št
 = 
LOG_LEVEL_DEBUG
;

66 iàĞ
NULL
 !ğ
	`¡rÿ£¡r
(
log_buf
, "error"))

68 
şoudc_log_Ëv–_št
 = 
LOG_LEVEL_ERR
;

72 
	`şoudc_”rÜ
("%s[%d]:…¬am‘” should oÆy bdebug o¸”rÜ,…Ëa£ doubË check", 
__func__
, 
__LINE__
);

75 
	`¢´štf
(
cmd
, (cmd), "uc˜£ˆşoudc.glob®.logËv–=\"%s\"",
log_buf
);

76 
	`sy¡em
(
cmd
);

77 
	`sy¡em
("uci commit");

78 
	`şoudc_debug
("%s[%d]: cmd = %s\n", 
__func__
, 
__LINE__
, 
cmd
);

80 
	`şoudc_debug
("%s[%d]: cloudc_log_Ëv–_šˆğ%d", 
__func__
, 
__LINE__
, 
şoudc_log_Ëv–_št
);

85 
	`şoudc_debug
("%s[%d]: wrÚg…¬am‘”,¶—£ doubË check", 
__func__
, 
__LINE__
);

88 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

90 
	}
}

92 
	$şoudc_ubus_š™
()

94 
»t
 = -1;

95 cÚ¡ *
ubus_sock‘
 = 
NULL
;

97 
	`şoudc_debug
("%s[%d]: EÁ” ", 
__func__
, 
__LINE__
);

98 
	`uloİ_š™
();

101 
şoudc_ùx
 = 
	`ubus_cÚÃù
(
ubus_sock‘
);

103 ià(!
şoudc_ùx
)

105 
	`şoudc_”rÜ
(
¡d”r
, "Failedo connecto ubus");

111 
	`şoudc_debug
("%s[%d]: cÚÃùØubu sucûed, cloudc_ùx = %p", 
__func__
, 
__LINE__
, 
şoudc_ùx
);

115 
	`ubus_add_uloİ
(
şoudc_ùx
);

118 
»t
 = 
	`ubus_add_objeù
(
şoudc_ùx
, &
şoudc_objeù
);

120 ià(
»t
)

123 
	`şoudc_”rÜ
(
¡d”r
, "FaedØadd objeù: %s", 
	`ubus_¡»¼Ü
(
»t
));

127 
	`şoudc_debug
("%s[%d]: ubu add objeù sucûssfuÎy,„‘ = %d", 
__func__
, 
__LINE__
, 
»t
);

130 
	`şoudc_debug
("%s[%d]: Ex™ ", 
__func__
, 
__LINE__
);

133 
	}
}

135 
	$şoudc_d‘eù_»cv_»gi¡”_¡©us_timeout
(
uloİ_timeout
 *
t
)

137 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

138 ià((0 =ğ
­_»gi¡”_æag
) || (2 ==‡p_register_flag))

142 
	`şoudc_debug
("%s[%d]:„egi¡” sucûed o¸®»ad„egi¡”ed,‡p_»gi¡”_æag = %d ", 
__func__
, 
__LINE__
, 
­_»gi¡”_æag
);

143 
­_»gi¡”_æag
 = 1;

148 
	`şoudc_debug
("%s[%d]:„egi¡” faed,‚“dØ»gi¡”‡gaš,‡p_»gi¡”_æag = %d ", 
__func__
, 
__LINE__
, 
­_»gi¡”_æag
);

149 
	`­_»gi¡”
();

151 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

152 
	}
}

154 
	$şoudc_d‘eù_£nd_timeout
(
uloİ_timeout
 *
t
)

156 
	`şoudc_debug
("%s[%d]: EÁ”", 
__func__
, 
__LINE__
);

157 
	`şo£
(
şoudc_mÚ™Ü_uloİ_fd
.
fd
);

158 
	`sock‘_ü—‹
();

159 
	`sock‘_cÚÃù
();

161 
	`şoudc_debug
("%s[%d]: Ex™", 
__func__
, 
__LINE__
);

162 
	}
}

	@NewConfigClient.h

20 
	~<m­
>

21 
	~<veùÜ
>

22 
	~<¡ršg
>

23 
	~<¡dšt.h
>

25 
	~<®ljoyn/Mes§ge.h
>

26 
	~<®ljoyn/BusLi¡’”.h
>

27 
	~<®ljoyn/BusObjeù.h
>

28 
	~<®ljoyn/BusA‰achm’t.h
>

29 
	~<®ljoyn/MsgArg.h
>

30 
	~<qcc/SŒšg.h
>

32 
Çme¥aû
 
	gajn
 {

33 
Çme¥aû
 
	g£rviûs
 {

46 şas 
	cNewCÚfigCl›Á
 {

47 
	gpublic
:

51 
¡d
::
	tm­
<
	tqcc
::
	tSŒšg
, 
	tajn
::
	tMsgArg
> 
	tCÚfigu¿tiÚs
;

58 
NewCÚfigCl›Á
(cÚ¡ * 
š‹rçûName
, 
ajn
::
BusA‰achm’t
& 
bus
);

64 ~
NewCÚfigCl›Á
() { }

71 
QStus
 
FaùÜyRe£t
(cÚ¡ * 
busName
, cÚ¡ * 
objeùP©h
, cÚ¡ * 
š‹rçûName
, 
ajn
::
SessiÚId
 
£ssiÚId
 = 0);

78 
QStus
 
Re¡¬t
(cÚ¡ * 
busName
, cÚ¡ * 
objeùP©h
, cÚ¡ * 
š‹rçûName
, 
ajn
::
SessiÚId
 
£ssiÚId
 = 0);

88 
QStus
 
S‘Passcode
(cÚ¡ * 
busName
, cÚ¡ * 
d«mÚR—lm
, 
size_t
 
ÃwPasscodeSize
, cÚ¡ 
ušt8_t
* 
ÃwPasscode
, cÚ¡ * 
objeùP©h
, cÚ¡ * 
š‹rçûName
, 
ajn
::
SessiÚId
 
£ssiÚId
 = 0);

97 
QStus
 
G‘CÚfigu¿tiÚs
(cÚ¡ * 
busName
, cÚ¡ * 
ÏnguageTag
, 
CÚfigu¿tiÚs
& 
cÚfigs
, cÚ¡ * 
objeùP©h
, cÚ¡ * 
š‹rçûName
, 
ajn
::
SessiÚId
 
£ssiÚId
 = 0);

106 
QStus
 
Upd©eCÚfigu¿tiÚs
(cÚ¡ * 
busName
, cÚ¡ * 
ÏnguageTag
, cÚ¡ 
CÚfigu¿tiÚs
& 
cÚfigs
, cÚ¡ * 
objeùP©h
, cÚ¡ * 
š‹rçûName
, 
ajn
::
SessiÚId
 
£ssiÚId
 = 0);

115 
QStus
 
Re£tCÚfigu¿tiÚs
(cÚ¡ * 
busName
, cÚ¡ * 
ÏnguageTag
, cÚ¡ 
¡d
::
veùÜ
<
qcc
::
SŒšg
>& 
cÚfigNames
, cÚ¡ * 
objeùP©h
, cÚ¡ * 
š‹rçûName
, 
ajn
::
SessiÚId
 
£ssiÚId
 = 0);

124 
QStus
 
G‘V”siÚ
(cÚ¡ * 
busName
, & 
v”siÚ
, cÚ¡ * 
objeùP©h
, cÚ¡ * 
š‹rçûName
, 
ajn
::
SessiÚId
 
£ssiÚId
 = 0);

126 
	g´iv©e
:

130 
ajn
::
BusA‰achm’t
* 
m_BusA‰achm’t
;

	@cJSON.h

23 #iâdeà
cJSON__h


24 
	#cJSON__h


	)

26 #ifdeà
__ılu¥lus


32 
	#cJSON_F®£
 0

	)

33 
	#cJSON_True
 1

	)

34 
	#cJSON_NULL
 2

	)

35 
	#cJSON_Numb”
 3

	)

36 
	#cJSON_SŒšg
 4

	)

37 
	#cJSON_A¼ay
 5

	)

38 
	#cJSON_Objeù
 6

	)

40 
	#cJSON_IsReã»nû
 256

	)

41 
	#cJSON_SŒšgIsCÚ¡
 512

	)

44 
	scJSON
 {

45 
cJSON
 *
Ãxt
,*
´ev
;

46 
cJSON
 *
chd
;

48 
ty³
;

50 *
v®ue¡ršg
;

51 
v®uešt
;

52 
v®uedoubË
;

54 *
¡ršg
;

55 } 
	tcJSON
;

57 
	scJSON_Hooks
 {

58 *(*
m®loc_â
)(
size_t
 
sz
);

59 (*
ä“_â
)(*
±r
);

60 } 
	tcJSON_Hooks
;

63 
cJSON_In™Hooks
(
cJSON_Hooks
* 
hooks
);

67 
cJSON
 *
cJSON_P¬£
(cÚ¡ *
v®ue
);

69 *
cJSON_Pršt
(
cJSON
 *
™em
);

71 *
cJSON_PrštUnfÜm©‹d
(
cJSON
 *
™em
);

73 *
cJSON_PrštBufã»d
(
cJSON
 *
™em
,
´ebufãr
,
fmt
);

75 
cJSON_D–‘e
(
cJSON
 *
c
);

78 
cJSON_G‘A¼aySize
(
cJSON
 *
¬¿y
);

80 
cJSON
 *
cJSON_G‘A¼ayI‹m
(cJSON *
¬¿y
,
™em
);

82 
cJSON
 *
cJSON_G‘ObjeùI‹m
(cJSON *
objeù
,cÚ¡ *
¡ršg
);

85 cÚ¡ *
cJSON_G‘E¼ÜPŒ
();

88 
cJSON
 *
cJSON_C»©eNuÎ
();

89 
cJSON
 *
cJSON_C»©eTrue
();

90 
cJSON
 *
cJSON_C»©eF®£
();

91 
cJSON
 *
cJSON_C»©eBoŞ
(
b
);

92 
cJSON
 *
cJSON_C»©eNumb”
(
num
);

93 
cJSON
 *
cJSON_C»©eSŒšg
(cÚ¡ *
¡ršg
);

94 
cJSON
 *
cJSON_C»©eA¼ay
();

95 
cJSON
 *
cJSON_C»©eObjeù
();

98 
cJSON
 *
cJSON_C»©eIÁA¼ay
(cÚ¡ *
numb”s
,
couÁ
);

99 
cJSON
 *
cJSON_C»©eFlßtA¼ay
(cÚ¡ *
numb”s
,
couÁ
);

100 
cJSON
 *
cJSON_C»©eDoubËA¼ay
(cÚ¡ *
numb”s
,
couÁ
);

101 
cJSON
 *
cJSON_C»©eSŒšgA¼ay
(cÚ¡ **
¡ršgs
,
couÁ
);

104 
cJSON_AddI‹mToA¼ay
(
cJSON
 *
¬¿y
, cJSON *
™em
);

105 
cJSON_AddI‹mToObjeù
(
cJSON
 *
objeù
,cÚ¡ *
¡ršg
,cJSON *
™em
);

106 
cJSON_AddI‹mToObjeùCS
(
cJSON
 *
objeù
,cÚ¡ *
¡ršg
,cJSON *
™em
);

108 
cJSON_AddI‹mReã»nûToA¼ay
(
cJSON
 *
¬¿y
, cJSON *
™em
);

109 
cJSON_AddI‹mReã»nûToObjeù
(
cJSON
 *
objeù
,cÚ¡ *
¡ršg
,cJSON *
™em
);

112 
cJSON
 *
cJSON_D‘achI‹mFromA¼ay
(cJSON *
¬¿y
,
which
);

113 
cJSON_D–‘eI‹mFromA¼ay
(
cJSON
 *
¬¿y
,
which
);

114 
cJSON
 *
cJSON_D‘achI‹mFromObjeù
(cJSON *
objeù
,cÚ¡ *
¡ršg
);

115 
cJSON_D–‘eI‹mFromObjeù
(
cJSON
 *
objeù
,cÚ¡ *
¡ršg
);

118 
cJSON_In£¹I‹mInA¼ay
(
cJSON
 *
¬¿y
,
which
,cJSON *
Ãw™em
);

119 
cJSON_R•ÏûI‹mInA¼ay
(
cJSON
 *
¬¿y
,
which
,cJSON *
Ãw™em
);

120 
cJSON_R•ÏûI‹mInObjeù
(
cJSON
 *
objeù
,cÚ¡ *
¡ršg
,cJSON *
Ãw™em
);

123 
cJSON
 *
cJSON_Du¶iÿ‹
(cJSON *
™em
,
»cur£
);

129 
cJSON
 *
cJSON_P¬£W™hO±s
(cÚ¡ *
v®ue
,cÚ¡ **
»tuº_·r£_’d
,
»quœe_nuÎ_‹rmš©ed
);

131 
cJSON_Mšify
(*
jsÚ
);

134 
	#cJSON_AddNuÎToObjeù
(
objeù
,
Çme
è
	`cJSON_AddI‹mToObjeù
(objeù,‚ame, 
	`cJSON_C»©eNuÎ
())

	)

135 
	#cJSON_AddTrueToObjeù
(
objeù
,
Çme
è
	`cJSON_AddI‹mToObjeù
(objeù,‚ame, 
	`cJSON_C»©eTrue
())

	)

136 
	#cJSON_AddF®£ToObjeù
(
objeù
,
Çme
è
	`cJSON_AddI‹mToObjeù
(objeù,‚ame, 
	`cJSON_C»©eF®£
())

	)

137 
	#cJSON_AddBoŞToObjeù
(
objeù
,
Çme
,
b
è
	`cJSON_AddI‹mToObjeù
(objeù,‚ame, 
	`cJSON_C»©eBoŞ
(b))

	)

138 
	#cJSON_AddNumb”ToObjeù
(
objeù
,
Çme
,
n
è
	`cJSON_AddI‹mToObjeù
(objeù,‚ame, 
	`cJSON_C»©eNumb”
Ò))

	)

139 
	#cJSON_AddSŒšgToObjeù
(
objeù
,
Çme
,
s
è
	`cJSON_AddI‹mToObjeù
(objeù,‚ame, 
	`cJSON_C»©eSŒšg
(s))

	)

142 
	#cJSON_S‘IÁV®ue
(
objeù
,
v®
è((objeù)?(objeù)->
v®uešt
=(objeù)->
v®uedoubË
=(v®):(v®))

	)

143 
	#cJSON_S‘Numb”V®ue
(
objeù
,
v®
è((objeù)?(objeù)->
v®uešt
=(objeù)->
v®uedoubË
=(v®):(v®))

	)

145 #ifdeà
__ılu¥lus


	@cloudc_log.h

1 
	#LOG_EMERG
 0

	)

2 
	#LOG_ALERT
 1

	)

3 
	#LOG_CRIT
 2

	)

4 
	#LOG_ERR
 3

	)

5 
	#LOG_WARNING
 4

	)

6 
	#LOG_NOTICE
 5

	)

7 
	#LOG_INFO
 6

	)

8 
	#LOG_DEBUG
 7

	)

12 
	#şoudc_”rÜ
(
¬gs
...è
	`log_log
(
LOG_ERR
, 
__FUNCTION__
, 
__LINE__
,‡rgs)

	)

13 
	#şoudc_debug
(
¬gs
...è
	`log_log
(
LOG_DEBUG
, 
__FUNCTION__
, 
__LINE__
,‡rgs)

	)

15 
	#MAX_LOG_LINE_LENGTH
 512

	)

19 
	mLOG_LEVEL_ERR
 = 3,

20 
	mLOG_LEVEL_DEBUG
 = 7

21 } 
	tLOG_LEVEL
;

	@common/NotificationReceiverTestImpl.h

17 #iâdeà
NOTIFICATIONRECEIVERTESTIMPL_H_


18 
	#NOTIFICATIONRECEIVERTESTIMPL_H_


	)

20 
	~<veùÜ
>

21 
	~<®ljoyn/nÙifiÿtiÚ/NÙifiÿtiÚReûiv”.h
>

22 
	~<®ljoyn/nÙifiÿtiÚ/NÙifiÿtiÚ.h
>

23 #ifdeà
_WIN32


24 
	~<Wšdows.h
>

25 
	#±h»ad_mu‹x_t
 
CRITICAL_SECTION


	)

26 
	#±h»ad_cÚd_t
 
CONDITION_VARIABLE


	)

28 
	~<±h»ad.h
>

37 şas 
	cNÙifiÿtiÚReûiv”Te¡Im¶
 : 
public
 
ajn
::
£rviûs
::
NÙifiÿtiÚReûiv”
 {

38 
public
:

39 
	eNÙifiÿtiÚAùiÚ
 {

40 
ACTION_NOTHING
,

41 
	mACTION_DISMISS


47 
NÙifiÿtiÚReûiv”Te¡Im¶
(
boŞ
 
wa™FÜEx‹º®NÙifiÿtiÚAùiÚ
 = 
Œue
);

52 ~
NÙifiÿtiÚReûiv”Te¡Im¶
();

58 
Reûive
(
ajn
::
£rviûs
::
NÙifiÿtiÚ
 cÚ¡& 
nÙifiÿtiÚ
);

64 
£tAµliÿtiÚs
(
qcc
::
SŒšg
 cÚ¡& 
li¡OfAµs
);

71 
Dismiss
(cÚ¡ 
št32_t
 
msgId
, cÚ¡ 
qcc
::
SŒšg
 
­pId
);

77 
NÙifiÿtiÚAùiÚ
 
G‘NÙifiÿtiÚAùiÚ
();

85 
S‘NÙifiÿtiÚAùiÚ
(
NÙifiÿtiÚAùiÚ
 
nÙifiÿtiÚAùiÚ
);

87 
	g´iv©e
:

92 
¡d
::
veùÜ
<
qcc
::
SŒšg
> 
m_AµliÿtiÚs
;

96 
NÙifiÿtiÚAùiÚ
 
	gm_NÙifiÿtiÚAùiÚ
;

100 
±h»ad_mu‹x_t
 
	gm_Lock
;

106 
±h»ad_cÚd_t
 
	gm_CÚd™iÚ
;

113 
boŞ
 
	gm_Wa™FÜEx‹º®NÙifiÿtiÚAùiÚ
;

	@handle_sys_feature.h

1 
	#LEN_OF_CMD_HEAD
 20

	)

2 
	#IPK_INSTALLED
 0

	)

3 
	#IPK_UNINSTALLED
 1

	)

6 
	sFFe


8 cÚ¡ *
	mf’ame
;

9 
FILE
 *
	m¡»am
;

12 
	sk_qu”y_šfo_node


14 
	mk_qu”y_Çme
[
MAX_IPK_NAME_LEN
];

15 
k_qu”y_šfo_node
 *
	mpNext
;

16 }
	tIPK_QUERY_INFO_NODE
;

	@parser.h

2 
	#CMD_OPKG_UPDATE
 "İkg"

	)

3 
	#CMD_RSP_REGISTER
 "r¥_g©eway_Úlše"

	)

4 
	#CMD_INSTALL_IPK
 "š¡®l"

	)

5 
	#CMD_UNINSTALL_IPK
 "unš¡®l"

	)

6 
	#CMD_UPGRADE_IPK
 "upg¿de"

	)

7 
	#CMD_GET_INSTALL_IPK
 "qu”y_š¡®Ëd"

	)

8 
	#CMD_GET_RUNNING_IPK
 "qu”y_ruÂšg"

	)

10 
	#CMD_START_IPK_SERVICE
 "¡¬t"

	)

11 
	#CMD_STOP_IPK_SERVICE
 "¡İ"

	)

12 
	#CMD_ENABLE_IPK_SERVICE
 "’abË"

	)

13 
	#CMD_DISABLE_IPK_SERVICE
 "di§bË"

	)

15 
	#CMD_ALLJOYN_GET_OPERATION
 "g‘"

	)

16 
	#CMD_ALLJOYN_SET_OPERATION
 "£t"

	)

18 
	#CMD_ALLJOYN_UPDATE_DEVICEID
 "r¥_deviû_Úlše"

	)

20 
	#MAX_DEVICETYPE_LEN
 32

	)

21 
	#MAX_DEVICEID_LEN
 32

	)

22 
	#MAX_DEVICESN_LEN
 32

	)

23 
	#MAX_USERID_LEN
 32

	)

25 
	#NOT_EMPTY
 0

	)

26 
	#EMPTY
 -1

	)

27 
	#MAX_RPC_CMD_LEN
 32

	)

28 
	#MAX_OPKG_UPDATE_URL_LEN
 128

	)

30 
	#MAX_IPK_NAME_LEN
 32

	)

31 
	#MAX_NODE_VALUE_LEN
 32

	)

35 
	meRegi¡”
 = 1,

36 
	meIpkO³¿tiÚ
,

37 
	meQu”yO³¿tiÚ
,

38 
	meOpkgO³¿tiÚ
,

39 
	meS”viûO³¿tiÚ
,

40 
	meAÎjoynG‘O³¿tiÚ
,

41 
	meAÎjoynS‘O³¿tiÚ
,

42 
	meAÎjoynUpd©eDeviûId
,

43 
	meInv®idP¬am


44 }
	teOpTy³
;

46 
	sk_šfo


48 
	mİ_k_Çme
[
MAX_IPK_NAME_LEN
];

49 
	mnode_Çme_cÚv”t
[
MAX_IPK_NAME_LEN
];

50 
	mnode_v®ue
[
MAX_NODE_VALUE_LEN
];

51 
	m¡©us
;

52 
k_šfo
 *
	mÃxt
;

53 }
	tk_šfo
;

55 
	sh‰p_v®ue


57 
	m½c_æag
;

58 
	m»gi¡”_¡©us
;

59 
	m£rŸl_num
;

60 
	mİkg_upd©e_æag
;

61 
	m»®_k_num
;

62 
	m½c_cmd
[
MAX_RPC_CMD_LEN
];

63 
	mİkg_upd©e_u¾
[
MAX_OPKG_UPDATE_URL_LEN
];

64 
k_šfo
 *
	mk_Çme_h—d
;

65 
	mu£r_id
[
MAX_USERID_LEN
];

66 
	mdeviû_id
[
MAX_DEVICEID_LEN
];

67 
	mdeviû_¢
[
MAX_DEVICESN_LEN
];

68 
	mdeviû_ty³
[
MAX_DEVICETYPE_LEN
];

69 *
	mdevD©a
;

71 }
	th‰p_v®ue
;

74 
	sli¡_node


76 
li¡_node
 *
	m´e
;

77 
li¡_node
 *
	mÃxt
;

78 }
	gli¡_node
;

81 
	ssk_d©a_node


83 
li¡_node
 
	msk_li¡_node
;

84 
h‰p_v®ue
 
	md©a
;

85 }
	gsk_d©a_node
;

	@samples_common/AsyncSessionJoiner.h

17 #iâdeà
ASYNCSESSIONJOINER_H_


18 
	#ASYNCSESSIONJOINER_H_


	)

20 
	~<®ljoyn/BusA‰achm’t.h
>

22 (*
	tSessiÚJošedC®lback
)(
	tqcc
::
	tSŒšg
 cÚ¡& 
	tbusName
, 
	tajn
::
	tSessiÚId
 
	tid
);

27 şas 
	cAsyncSessiÚJoš”
 : 
public
 
ajn
::
BusA‰achm’t
::
JošSessiÚAsyncCB
 {

29 
public
:

35 
	`AsyncSessiÚJoš”
(cÚ¡ * 
Çme
, 
SessiÚJošedC®lback
 
ÿÎback
 = 0);

40 
vœtu®
 ~
	`AsyncSessiÚJoš”
();

49 
	`JošSessiÚCB
(
QStus
 
¡©us
, 
ajn
::
SessiÚId
 
id
, cÚ¡‡jn::
SessiÚO±s
& 
İts
, * 
cÚ‹xt
);

51 
´iv©e
:

53 
qcc
::
SŒšg
 
m_Bu¢ame
;

55 
SessiÚJošedC®lback
 
m_C®lback
;

	@samples_common/SessionListenerImpl.h

17 #iâdeà
SESSIONLISTENERIMPL_H_


18 
	#SESSIONLISTENERIMPL_H_


	)

20 
	~<®ljoyn/SessiÚLi¡’”.h
>

21 
	~<qcc/SŒšg.h
>

26 şas 
	cSessiÚLi¡’”Im¶
 : 
public
 
ajn
::
SessiÚLi¡’”
 {

27 
public
:

32 
SessiÚLi¡’”Im¶
(
qcc
::
SŒšg
 cÚ¡& 
šS”viûNAme
);

37 
	mvœtu®
 ~
SessiÚLi¡’”Im¶
();

43 
SessiÚLo¡
(
ajn
::
SessiÚId
 
£ssiÚId
);

45 
	m´iv©e
:

47 
qcc
::
SŒšg
 
£rviûName
;

	@samples_common/SrpKeyXListener.h

17 #iâdeà
SRPKEYLISTENER_H_


18 
	#SRPKEYLISTENER_H_


	)

20 
	~<®ljoyn/AuthLi¡’”.h
>

26 şas 
	cS½KeyXLi¡’”
 : 
public
 
ajn
::
AuthLi¡’”
 {

27 
public
:

31 
S½KeyXLi¡’”
();

36 
	mvœtu®
 ~
S½KeyXLi¡’”
();

42 
£tPassCode
(
qcc
::
SŒšg
 cÚ¡& 
·ssCode
);

48 
£tG‘PassCode
((*
g‘PassCode
)(
qcc
::
SŒšg
&));

60 
boŞ
 
	`Reque¡C»d’tŸls
(cÚ¡ * 
authMechªism
, cÚ¡ * 
authP“r
, 
ušt16_t
 
authCouÁ
, cÚ¡ * 
u£rId
,

61 
ušt16_t
 
üedMask
, 
C»d’tŸls
& 
üeds
);

69 
	`Auth’tiÿtiÚCom¶‘e
(cÚ¡ * 
authMechªism
, cÚ¡ * 
authP“r
, 
boŞ
 
sucûss
);

71 
´iv©e
:

72 
qcc
::
SŒšg
 
m_PassCode
;

74 (*
m_G‘PassCode
)(
qcc
::
SŒšg
&);

	@share.h

1 
	~<¡dio.h
>

2 
	~<¡ršg.h
>

3 
	~<”ºo.h
>

4 
	~<¡dlib.h
>

5 
	~<sys/sock‘.h
>

6 
	~<sys/ioùl.h
>

7 
	~<Ãtš‘/š.h
>

8 
	~<Ãtš‘/tı.h
>

9 
	~<lšux/Ãšk.h
>

10 
	~<”ºo.h
>

11 
	~<Ãtš‘/š.h
>

12 
	~<¬·/š‘.h
>

13 
	~<Ãtdb.h
>

14 
	~<sys/£ndfe.h
>

15 
	~<sys/ty³s.h
>

16 
	~<sys/¡©.h
>

17 
	~<fú.h
>

18 
	~<sys/time.h
>

19 
	~<uni¡d.h
>

20 
	~<libubox/u¡»am.h
>

21 
	~<libubus.h
>

22 
	~<sigÇl.h
>

23 
	~<libubox/blobmsg_jsÚ.h
>

24 
	~<uci.h
>

25 
	~"şoudc_log.h
"

27 
	#CLOUD_SERVER_MANAGE_IP
 "192.168.1.10"

	)

28 
	#CLOUD_SERVER_MANAGE_PORT
 3000

	)

29 
	#CLOUD_SERVER_MANAGE_IP
 "115.29.49.52"

	)

30 
	#CLOUD_SERVER_MANAGE_PORT
 80

	)

32 
	#RECV_MAX_BUF_LEN
 4096

	)

33 
	#SEND_MAX_BUF_LEN
 4096

	)

34 
	#RECV_TIME_OUT
 30

	)

35 
	#SEND_TIME_OUT
 30

	)

37 
	#MAX_INTERFACE_LEN
 128

	)

38 
	#MAX_OBJECTPATH_LEN
 128

	)

39 
	#MAX_DEVICETYPE_LEN
 32

	)

40 
	#MAX_DEVICEID_LEN
 32

	)

41 
	#MAX_DEVICESN_LEN
 32

	)

42 
	#MAX_ONLINESTATUS_LEN
 4

	)

43 
	#MAX_MANUFACTURE_LEN
 32

	)

44 
	#MAX_MODULENUMBER_LEN
 32

	)

45 
	#MAX_USERID_LEN
 32

	)

48 
	#MAX_DEVDATA_LEN
 512

	)

49 
	#MAX_MAC_LEN
 18

	)

50 
	#MAX_SN_LEN
 32

	)

51 
	#MAX_IP_LEN
 16

	)

53 
	#DATA_CONVERT_FILE_PATH
 "/‘c/cÚfig/D©aCÚv”t.xml"

	)

54 
	#DEVICE_DATABASE_PATH
 "/u¤/bš/deviû.db"

	)

56 
uloİ_fd
 
şoudc_mÚ™Ü_uloİ_fd
;

57 
sockaddr_š
 
£rv”_addr
;

58 
ubus_cÚ‹xt
 *
şoudc_ùx
;

60 
­_mac
[
MAX_MAC_LEN
] ;

61 
­_¢
[
MAX_SN_LEN
] ;

62 
şoudc_£rv”_
[
MAX_IP_LEN
];

63 
şoudc_£rv”_pÜt
;

64 
şoudc_log_Ëv–_št
;

65 
­_»gi¡”_æag
;

66 
li¡_node
 
queue_h—d
;

67 
uloİ_timeout
 
»gi¡”_»cv_tim”
;

68 
uloİ_timeout
 
£nd_tim”
;

69 
±h»ad_mu‹x_t
 
mu‹x
;

	@
1
.
0
48
3114
/home/james/code/iot_home_gw/mtk/package/fxagent/src/DataConvert.c
/home/james/code/iot_home_gw/mtk/package/fxagent/src/NewConfigClient.cc
/home/james/code/iot_home_gw/mtk/package/fxagent/src/NewConfigClient.h
/home/james/code/iot_home_gw/mtk/package/fxagent/src/alljoyConfigClient.cc
/home/james/code/iot_home_gw/mtk/package/fxagent/src/cJSON.c
/home/james/code/iot_home_gw/mtk/package/fxagent/src/cJSON.h
/home/james/code/iot_home_gw/mtk/package/fxagent/src/cloudc_log.c
/home/james/code/iot_home_gw/mtk/package/fxagent/src/cloudc_log.h
/home/james/code/iot_home_gw/mtk/package/fxagent/src/common/NotificationReceiverTestImpl.cc
/home/james/code/iot_home_gw/mtk/package/fxagent/src/common/NotificationReceiverTestImpl.h
/home/james/code/iot_home_gw/mtk/package/fxagent/src/handle_sys_feature.c
/home/james/code/iot_home_gw/mtk/package/fxagent/src/handle_sys_feature.h
/home/james/code/iot_home_gw/mtk/package/fxagent/src/listener.c
/home/james/code/iot_home_gw/mtk/package/fxagent/src/main.c
/home/james/code/iot_home_gw/mtk/package/fxagent/src/parser.c
/home/james/code/iot_home_gw/mtk/package/fxagent/src/parser.h
/home/james/code/iot_home_gw/mtk/package/fxagent/src/proto.c
/home/james/code/iot_home_gw/mtk/package/fxagent/src/pthread.c
/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/AboutDataStore.cc
/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/AboutDataStore.h
/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/AboutObjApi.cc
/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/AboutObjApi.h
/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/AnnounceHandlerImpl.cc
/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/AnnounceHandlerImpl.h
/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/AsyncSessionJoiner.cc
/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/AsyncSessionJoiner.h
/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/CommonBusListener.cc
/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/CommonBusListener.h
/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/CommonSampleUtil.cc
/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/CommonSampleUtil.h
/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/SessionListenerImpl.cc
/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/SessionListenerImpl.h
/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/SrpKeyXListener.cc
/home/james/code/iot_home_gw/mtk/package/fxagent/src/samples_common/SrpKeyXListener.h
/home/james/code/iot_home_gw/mtk/package/fxagent/src/share.h
/home/james/code/iot_home_gw/mtk/package/fxagent/src/socket.c
/home/james/code/iot_home_gw/mtk/package/fxagent/src/task_queue.c
/home/james/code/iot_home_gw/mtk/package/fxagent/src/ubus.c
NewConfigClient.h
cJSON.h
cloudc_log.h
common/NotificationReceiverTestImpl.h
handle_sys_feature.h
parser.h
samples_common/AsyncSessionJoiner.h
samples_common/SessionListenerImpl.h
samples_common/SrpKeyXListener.h
share.h
